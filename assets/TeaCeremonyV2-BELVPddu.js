import{r as e,j as s,C as t,O as n,m as a,E as r,o as i,F as l,T as o,u as c}from"./three-vendor-BoyHWg1a.js";import{d,u as x,a as m}from"./index-BZ3c0gis.js";import{a as h}from"./core-vendor-Csnc5NqJ.js";import{X as j,R as p,A as g,m as u,L as f,g as b,T as N,s as y,o as v}from"./ui-vendor-BCOa7pYq.js";const w=[{name:"æ˜å‰é¾™äº•",color:"#90EE90",icon:"ğŸƒ"},{name:"æ­¦å¤·å²©èŒ¶",color:"#8B4513",icon:"ğŸ”ï¸"},{name:"æ­£å±±å°ç§",color:"#CD853F",icon:"ğŸ”¥"},{name:"ç™½æ¯«é“¶é’ˆ",color:"#F5F5DC",icon:"â„ï¸"},{name:"æ™®æ´±å¤æ ‘",color:"#654321",icon:"ğŸŒ³"},{name:"é“è§‚éŸ³",color:"#DAA520",icon:"ğŸ””"},{name:"ç¢§èºæ˜¥",color:"#98FB98",icon:"ğŸŒ€"},{name:"å¤§çº¢è¢",color:"#8B0000",icon:"ğŸ‘˜"}],M=["åŠŸå¤«æ³¡","ç›–ç¢—å†²æ³¡","ç´«ç ‚å£¶æ³¡","ç»ç’ƒæ¯æ³¡","ç…®èŒ¶æ³•"],S=["æ¡‚èŠ±","ç«ç‘°","èŠèŠ±","æ¸æ","é™ˆçš®","è–„è·","èœ‚èœœ","çº¢æ£"],k=["èŒ¶é¦™æ»¡åº§","æ¸…å¿ƒæ˜å¿—","æ‚ ç„¶è‡ªå¾—","æ·¡æ³Šå®é™","ç¦…èŒ¶ä¸€å‘³","å“èŒ—æ‚Ÿé“"],C=["æ˜¥Â·ä¸‡ç‰©å¤è‹","å¤Â·æ¸…å‡‰æ¶ˆæš‘","ç§‹Â·é‡‘æ¡‚é£˜é¦™","å†¬Â·æ¸©æš–æš–å¿ƒ"];function P(){const e=Math.floor(1e6*Math.random()),s=w[e%w.length],t=M[(e>>3)%M.length],n=75+e%20,a=30+e%90,r=1+e%3,i=[];for(let l=0;l<r;l++)i.push(S[(e+7*l)%S.length]);return{seed:e,teaBase:s,brewMethod:t,temperature:n,steepTime:a,additions:i,blessing:k[(e>>4)%k.length],seasonMatch:C[(e>>2)%C.length],ecoScore:85+e%15}}function B({position:t,delay:n=0,onClick:a}){const r=e.useRef(null),[i,l]=e.useState(!1),[o,d]=e.useState(!1);return c(e=>{r.current&&!o&&(r.current.rotation.y=.1*Math.sin(e.clock.elapsedTime+n),r.current.rotation.z=.05*Math.cos(.5*e.clock.elapsedTime+n))}),o?null:s.jsxs("mesh",{ref:r,position:t,onClick:()=>{d(!0),null==a||a()},onPointerOver:()=>l(!0),onPointerOut:()=>l(!1),scale:i?1.3:1,children:[s.jsx("sphereGeometry",{args:[.08,8,8]}),s.jsx("meshStandardMaterial",{color:i?"#00FF00":"#228B22",emissive:i?"#00FF00":"#000000",emissiveIntensity:i?.3:0})]})}function I({position:t,onPickLeaf:n}){const a=e.useMemo(()=>{const e=[];for(let s=0;s<15;s++){const t=s/15*Math.PI*2,n=.3+.3*Math.random(),a=.3+.4*Math.random();e.push([Math.cos(t)*n,a,Math.sin(t)*n])}return e},[]);return s.jsxs("group",{position:t,children:[s.jsxs("mesh",{position:[0,.15,0],children:[s.jsx("cylinderGeometry",{args:[.05,.08,.3,8]}),s.jsx("meshStandardMaterial",{color:"#8B4513"})]}),s.jsxs("mesh",{position:[0,.4,0],children:[s.jsx("sphereGeometry",{args:[.5,16,16]}),s.jsx("meshStandardMaterial",{color:"#2E8B57",transparent:!0,opacity:.9})]}),a.map((e,t)=>s.jsx(B,{position:e,delay:.5*t,onClick:n},t))]})}function F({onPickLeaf:t,pickedCount:n}){const a=e.useMemo(()=>{const e=[];for(let s=0;s<4;s++)for(let t=0;t<5;t++)e.push([1.5*(t-2)+s%2*.75,.3*s-.5,1.2*(s-1.5)]);return e},[]);return s.jsxs("group",{children:[[0,1,2,3].map(e=>s.jsxs("mesh",{position:[0,.3*e-.7,1.2*(e-1.5)],rotation:[-Math.PI/2,0,0],children:[s.jsx("planeGeometry",{args:[10,1.5]}),s.jsx("meshStandardMaterial",{color:`hsl(${120+5*e}, 40%, ${35+5*e}%)`})]},e)),a.map((e,n)=>s.jsx(I,{position:e,onPickLeaf:t},n)),s.jsx(i,{position:[-3,2,-2],speed:.2,opacity:.3}),s.jsx(i,{position:[3,2.5,-3],speed:.1,opacity:.2}),s.jsx(l,{speed:2,floatIntensity:.5,children:s.jsx(o,{position:[0,3,0],fontSize:.3,color:"#2E8B57",anchorX:"center",anchorY:"middle",children:`å·²é‡‡æ‘˜: ${n}/10 ç‰‡èŒ¶å¶`})})]})}function G({brewing:t,teaColor:n}){const a=e.useRef(null);return c(e=>{a.current&&t&&(a.current.rotation.y=.1*Math.sin(2*e.clock.elapsedTime))}),s.jsxs("group",{ref:a,position:[0,0,0],children:[s.jsxs("mesh",{position:[0,.3,0],children:[s.jsx("sphereGeometry",{args:[.4,32,32]}),s.jsx("meshStandardMaterial",{color:"#8B4513",roughness:.3,metalness:.1})]}),s.jsxs("mesh",{position:[.4,.35,0],rotation:[0,0,-Math.PI/4],children:[s.jsx("cylinderGeometry",{args:[.05,.08,.3,8]}),s.jsx("meshStandardMaterial",{color:"#8B4513"})]}),s.jsxs("mesh",{position:[0,.7,0],children:[s.jsx("sphereGeometry",{args:[.15,16,16]}),s.jsx("meshStandardMaterial",{color:"#654321"})]}),s.jsxs("mesh",{position:[-.35,.4,0],rotation:[0,0,Math.PI/6],children:[s.jsx("torusGeometry",{args:[.15,.03,8,16,Math.PI]}),s.jsx("meshStandardMaterial",{color:"#8B4513"})]}),t&&s.jsxs("mesh",{position:[0,.3,0],children:[s.jsx("sphereGeometry",{args:[.35,32,32]}),s.jsx("meshStandardMaterial",{color:n,transparent:!0,opacity:.6})]}),t&&s.jsx(l,{speed:4,floatIntensity:1,children:s.jsxs("mesh",{position:[0,1,0],children:[s.jsx("sphereGeometry",{args:[.1,8,8]}),s.jsx("meshStandardMaterial",{color:"white",transparent:!0,opacity:.3})]})})]})}function L({recipe:e,progress:t}){return s.jsxs("group",{children:[s.jsxs("mesh",{position:[0,-.5,0],receiveShadow:!0,children:[s.jsx("boxGeometry",{args:[3,.1,2]}),s.jsx("meshStandardMaterial",{color:"#DEB887"})]}),s.jsx(G,{brewing:t>30,teaColor:e.teaBase.color}),[-.8,0,.8].map((n,a)=>s.jsxs("group",{position:[n,-.4,.6],children:[s.jsxs("mesh",{children:[s.jsx("cylinderGeometry",{args:[.1,.08,.15,16]}),s.jsx("meshStandardMaterial",{color:"#F5F5DC"})]}),t>60+10*a&&s.jsxs("mesh",{position:[0,.02,0],children:[s.jsx("cylinderGeometry",{args:[.08,.08,.1,16]}),s.jsx("meshStandardMaterial",{color:e.teaBase.color,transparent:!0,opacity:.8})]})]},a)),s.jsx(l,{speed:1,floatIntensity:.3,children:s.jsx(o,{position:[0,1.5,0],fontSize:.2,color:"#8B4513",anchorX:"center",children:e.blessing})})]})}function E({stage:e,recipe:t,pickedCount:i,onPickLeaf:l,brewProgress:o}){return s.jsxs(s.Fragment,{children:[s.jsx("ambientLight",{intensity:.5}),s.jsx("directionalLight",{position:[5,10,5],intensity:1,castShadow:!0}),s.jsx("pointLight",{position:[-5,5,-5],intensity:.5,color:"#FFE4B5"}),"garden"===e&&s.jsx(F,{onPickLeaf:l,pickedCount:i}),("brewing"===e||"complete"===e)&&s.jsx(L,{recipe:t,progress:o}),s.jsx(n,{enablePan:!1,minDistance:2,maxDistance:10,minPolarAngle:Math.PI/6,maxPolarAngle:Math.PI/2.5}),s.jsx(a,{sunPosition:[100,20,100]}),s.jsx(r,{preset:"forest"})]})}function T(){const n=h(),{unlockScene:a}=d(),{addPoints:r}=x(),{addCarbonSaving:i}=m(),[l,o]=e.useState(()=>P()),[c,w]=e.useState("intro"),[M,S]=e.useState(0),[k,C]=e.useState(0),[B,I]=e.useState(!1);e.useEffect(()=>{M>=10&&"garden"===c&&setTimeout(()=>w("brewing"),1e3)},[M,c]),e.useEffect(()=>{if("brewing"===c&&k<100){const e=setInterval(()=>{C(s=>s>=100?(clearInterval(e),w("complete"),I(!0),r({type:"experience",points:80,description:"å®ŒæˆèŒ¶é“ä»ªå¼ä½“éªŒ"}),i({type:"digital_experience",carbonSaved:800,description:"æœ‰æœºèŒ¶å›­ç¢³æ±‡è´¡çŒ®",experienceId:"tea_ceremony_v2"}),100):s+2)},100);return()=>clearInterval(e)}},[c,k,r,i]);const F=e.useCallback(()=>{S(e=>e+1)},[]);return s.jsxs("div",{className:"fixed inset-0 bg-gradient-to-b from-green-100 via-green-50 to-amber-50",children:[s.jsx("div",{className:"absolute top-0 left-0 right-0 z-20 p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("button",{onClick:()=>n(-1),className:"p-2 bg-white/80 backdrop-blur rounded-full shadow-lg",children:s.jsx(j,{className:"w-5 h-5 text-green-700"})}),s.jsxs("div",{className:"flex items-center gap-2 bg-white/80 backdrop-blur rounded-full px-4 py-2 shadow-lg",children:[s.jsx("span",{className:"text-2xl",children:l.teaBase.icon}),s.jsxs("div",{children:[s.jsx("div",{className:"font-bold text-green-800",children:l.teaBase.name}),s.jsxs("div",{className:"text-xs text-green-600",children:["#",l.seed.toString(16).toUpperCase()]})]})]}),s.jsx("button",{onClick:()=>{o(P())},className:"p-2 bg-white/80 backdrop-blur rounded-full shadow-lg",children:s.jsx(p,{className:"w-5 h-5 text-green-700"})})]})}),s.jsx(g,{children:"intro"===c&&s.jsx(u.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-30 flex items-center justify-center bg-gradient-to-b from-green-900/90 to-green-800/90 p-4",children:s.jsxs(u.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},className:"bg-white rounded-3xl p-8 max-w-md w-full shadow-2xl text-center",children:[s.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("span",{className:"text-4xl",children:l.teaBase.icon})}),s.jsx("h2",{className:"text-2xl font-bold text-green-800 mb-2",children:"ğŸµ ä½ çš„ä¸“å±èŒ¶é…æ–¹"}),s.jsx("p",{className:"text-green-600 mb-6",children:l.blessing}),s.jsxs("div",{className:"bg-green-50 rounded-2xl p-4 mb-6 text-left space-y-3",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-green-600",children:"èŒ¶åº•"}),s.jsx("span",{className:"font-bold text-green-800",children:l.teaBase.name})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-green-600",children:"å†²æ³¡æ³•"}),s.jsx("span",{className:"font-bold text-green-800",children:l.brewMethod})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-green-600",children:"æ°´æ¸©"}),s.jsxs("span",{className:"font-bold text-green-800",children:[l.temperature,"Â°C"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-green-600",children:"æµ¸æ³¡æ—¶é—´"}),s.jsxs("span",{className:"font-bold text-green-800",children:[l.steepTime,"ç§’"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-green-600",children:"æ·»åŠ "}),s.jsx("span",{className:"font-bold text-green-800",children:l.additions.join("ã€")})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-green-600",children:"é€‚åˆå­£èŠ‚"}),s.jsx("span",{className:"font-bold text-green-800",children:l.seasonMatch})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-green-600",children:"ç”Ÿæ€è¯„åˆ†"}),s.jsxs("span",{className:"font-bold text-eco-600",children:[l.ecoScore,"åˆ†"]})]})]}),s.jsxs("button",{onClick:()=>{w("garden")},className:"w-full py-4 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-2xl font-bold text-lg shadow-lg hover:shadow-xl transition-all",children:[s.jsx(f,{className:"w-5 h-5 inline mr-2"}),"å¼€å§‹é‡‡èŒ¶ä¹‹æ—…"]}),s.jsx("p",{className:"text-xs text-green-500 mt-4",children:"ğŸŒ¿ æœ‰æœºèŒ¶å›­ Â· é›¶å†œè¯ Â· ç¢³ä¸­å’Œ"})]})})}),"intro"!==c&&s.jsx("div",{className:"absolute inset-0",children:s.jsx(t,{shadows:!0,camera:{position:[0,3,6],fov:50},children:s.jsx(e.Suspense,{fallback:null,children:s.jsx(E,{stage:c,recipe:l,pickedCount:M,onPickLeaf:F,brewProgress:k})})})}),"intro"!==c&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 z-20 p-4",children:s.jsxs("div",{className:"bg-white/90 backdrop-blur rounded-2xl p-4 shadow-lg",children:["garden"===c&&s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-green-700 font-medium",children:"é‡‡èŒ¶è¿›åº¦"}),s.jsxs("span",{className:"text-green-800 font-bold",children:[M,"/10"]})]}),s.jsx("div",{className:"h-3 bg-green-100 rounded-full overflow-hidden",children:s.jsx(u.div,{className:"h-full bg-gradient-to-r from-green-400 to-green-600",initial:{width:0},animate:{width:M/10*100+"%"}})}),s.jsx("p",{className:"text-xs text-green-600 mt-2 text-center",children:"ğŸ‘† ç‚¹å‡»èŒ¶å¶é‡‡æ‘˜ Â· æ”¶é›†10ç‰‡å«©èŠ½"})]}),"brewing"===c&&s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-amber-700 font-medium",children:"æ³¡èŒ¶è¿›åº¦"}),s.jsxs("span",{className:"text-amber-800 font-bold",children:[k,"%"]})]}),s.jsx("div",{className:"h-3 bg-amber-100 rounded-full overflow-hidden",children:s.jsx(u.div,{className:"h-full bg-gradient-to-r from-amber-400 to-amber-600",initial:{width:0},animate:{width:`${k}%`}})}),s.jsxs("p",{className:"text-xs text-amber-600 mt-2 text-center",children:["ğŸ«– ",l.brewMethod," Â· ",l.temperature,"Â°C Â· ",l.steepTime,"ç§’"]})]})]})}),s.jsx(g,{children:B&&s.jsx(u.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:s.jsx(u.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},className:"bg-white rounded-3xl p-6 max-w-md w-full shadow-2xl",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(b,{className:"w-10 h-10 text-white"})}),s.jsx("h3",{className:"text-2xl font-bold text-green-800 mb-2",children:"ğŸµ èŒ¶é“ä»ªå¼å®Œæˆï¼"}),s.jsxs("p",{className:"text-green-600 mb-4",children:[l.teaBase.name," Â· ",l.blessing]}),s.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[s.jsxs("div",{className:"bg-green-50 rounded-xl p-3",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:"+80"}),s.jsx("div",{className:"text-xs text-green-500",children:"ç»¿è‰²ç§¯åˆ†"})]}),s.jsxs("div",{className:"bg-eco-50 rounded-xl p-3",children:[s.jsx("div",{className:"text-2xl font-bold text-eco-600",children:"800g"}),s.jsx("div",{className:"text-xs text-eco-500",children:"ç¢³å‡æ’"})]}),s.jsxs("div",{className:"bg-amber-50 rounded-xl p-3",children:[s.jsx("div",{className:"text-2xl font-bold text-amber-600",children:l.ecoScore}),s.jsx("div",{className:"text-xs text-amber-500",children:"ç”Ÿæ€è¯„åˆ†"})]})]}),s.jsxs("div",{className:"bg-green-50 rounded-xl p-4 mb-6 text-left",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(N,{className:"w-5 h-5 text-green-600"}),s.jsx("span",{className:"font-bold text-green-700",children:"æœ‰æœºèŒ¶å›­ç”Ÿæ€æ™ºæ…§"})]}),s.jsx("p",{className:"text-sm text-green-600",children:"ä¸€å…¬é¡·æœ‰æœºèŒ¶å›­æ¯å¹´å¯å›ºç¢³4.5å¨COâ‚‚ï¼Œç›¸å½“äºç§æ¤200æ£µæ ‘ã€‚ ä½ åˆšåˆšä½“éªŒçš„èŒ¶å¶æ¥è‡ªé›¶å†œè¯æœ‰æœºèŒ¶å›­ï¼"})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("button",{onClick:()=>{w("intro"),S(0),C(0),I(!1),o(P())},className:"flex-1 py-3 border-2 border-green-500 text-green-600 rounded-xl font-medium flex items-center justify-center gap-2",children:[s.jsx(y,{className:"w-4 h-4"}),"å†æ¥ä¸€æ¬¡"]}),s.jsxs("button",{onClick:()=>{a("tea_garden"),n("/create/polaroid?scene=tea_garden&design="+l.seed)},className:"flex-1 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-medium flex items-center justify-center gap-2",children:[s.jsx(v,{className:"w-4 h-4"}),"ç”Ÿæˆæ‹ç«‹å¾—"]})]})]})})})})]})}export{T as default};
