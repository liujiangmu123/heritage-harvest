import{r as e,j as t,C as s,F as a,O as r,i as n,u as i,S as l,D as o,k as c,H as d}from"./three-vendor-BoyHWg1a.js";import{d as x,a as m,u as h,C as p,B as g}from"./index-DkRoqGlp.js";import{a as u}from"./core-vendor-Csnc5NqJ.js";import{X as j,A as f,m as N,S as b,s as y,w as v,g as w,E as C,L as M,o as S,T as k}from"./ui-vendor-BCOa7pYq.js";const P={flower:{name:"çª—èŠ±",icon:"ğŸŒ¸",description:"ä¼ ç»Ÿçª—èŠ±å›¾æ¡ˆ"},zodiac:{name:"ç”Ÿè‚–",icon:"ğŸ‰",description:"åäºŒç”Ÿè‚–å‰ªçº¸"},blessing:{name:"ç¥ç¦",icon:"ç¦",description:"ç¦ç¦„å¯¿å–œ"},nature:{name:"è‡ªç„¶",icon:"ğŸƒ",description:"èŠ±é¸Ÿè™«é±¼"}},I=[{color:"#DC2626",name:"ä¸­å›½çº¢",gradient:"from-red-600 to-red-700"},{color:"#B91C1C",name:"æœ±ç ‚çº¢",gradient:"from-red-700 to-red-800"},{color:"#EA580C",name:"å‰ç¥¥æ©™",gradient:"from-orange-600 to-orange-700"},{color:"#CA8A04",name:"é‡‘é»„",gradient:"from-yellow-600 to-yellow-700"},{color:"#16A34A",name:"ç¿ ç»¿",gradient:"from-green-600 to-green-700"}],T=["ç¦æ»¡äººé—´","å¹³å®‰å–œä¹","ä¸‡äº‹å¦‚æ„","å¿ƒæƒ³äº‹æˆ","å‰ç¥¥å¦‚æ„","èŠ±å¼€å¯Œè´µ","é‡‘ç‰æ»¡å ‚","å¹´å¹´æœ‰ä½™","é¾™å‡¤å‘ˆç¥¥","äº”ç¦ä¸´é—¨","å¦‚æ„å‰ç¥¥","å¹¸ç¦ç¾æ»¡"],F=["é”¦ç»£ç¹èŠ±","ç¥¥äº‘ç‘å½©","å‡¤èˆä¹å¤©","é¾™è…¾å››æµ·","å–œé¹Šç™»æ","ç‰¡ä¸¹å¯Œè´µ","è²å¼€å¹¶è’‚","æ¢…å…°ç«¹èŠ","åŒå–œä¸´é—¨","ç¦å¯¿åŒå…¨","æ¾é¹¤å»¶å¹´","é±¼è·ƒé¾™é—¨"];function z(){const e=Math.floor(1e6*Math.random()),t=Object.keys(P),s=t[e%t.length],a=[4,6,8,12],r=a[e%a.length],i=1+e%5,l=I[e%I.length],o=F[e%F.length],c=T[(e>>4)%T.length],d=function(e,t,s){const a=[],r=t=>{const s=43758.5453*Math.sin(12.9898*t+78.233*e);return s-Math.floor(s)},i=2*Math.PI/t/2,l=8+Math.floor(4*s);for(let o=0;o<l;o++){const e=o/(l-1),t=e*i,c=.3+.6*e+.3*r(100*o)*s/5*Math.sin(e*Math.PI*(2+s)),d=.1*Math.sin(e*Math.PI*s);a.push(new n(Math.cos(t)*(c+d),Math.sin(t)*(c+d)))}return a}(e,r,i);return{seed:e,patternType:s,symmetry:r,complexity:i,paperColor:l.color,paperColorName:l.name,patternName:o,blessing:c,cutPoints:d}}function D({foldState:s,paperColor:a,cutProgress:r,design:d}){const x=e.useRef(null),[m,h]=e.useState(0);e.useEffect(()=>{if("unfolding"===s||"complete"===s){const e=setInterval(()=>{h(t=>t>=1?(clearInterval(e),1):t+.02)},30);return()=>clearInterval(e)}h(0)},[s]),i(e=>{x.current&&(x.current.position.y=.05*Math.sin(.5*e.clock.elapsedTime),"complete"===s&&(x.current.rotation.y=.2*e.clock.elapsedTime))});const p=e.useMemo(()=>{const e=new l,{cutPoints:t,symmetry:s}=d;if(t.length<2)return e;const a=[];for(let r=0;r<s;r++){const e=r/s*Math.PI*2,i=r%2==1,l=t.map(t=>{const s=i?-t.x:t.x,a=Math.cos(e),r=Math.sin(e);return new n(s*a-t.y*r,s*r+t.y*a)});i&&l.reverse(),a.push(...l)}return a.length>0&&(e.moveTo(a[0].x,a[0].y),a.forEach(t=>e.lineTo(t.x,t.y)),e.closePath()),e},[d]),g="cutting"===s?r:"unfolding"===s||"complete"===s?1:0;return t.jsxs("group",{ref:x,children:[t.jsxs("mesh",{position:[0,0,-.01],receiveShadow:!0,children:[t.jsx("planeGeometry",{args:[3,3]}),t.jsx("meshStandardMaterial",{color:a,side:o,roughness:.8})]}),g>0&&t.jsxs("group",{scale:m>0?1+.2*m:1,children:[t.jsxs("mesh",{position:[0,0,.01],castShadow:!0,children:[t.jsx("shapeGeometry",{args:[p]}),t.jsx("meshStandardMaterial",{color:a,side:o,roughness:.7,transparent:!0,opacity:.3+.7*g})]}),t.jsxs("mesh",{position:[0,0,.02],children:[t.jsx("shapeGeometry",{args:[p]}),t.jsx("meshBasicMaterial",{color:"#FFD700",side:o,transparent:!0,opacity:.3*m,wireframe:!0})]})]}),("folded"===s||"cutting"===s)&&t.jsx("group",{rotation:[0,0,Math.PI/d.symmetry],children:t.jsxs("mesh",{position:[.5,0,.05],rotation:[0,.1*Math.PI,0],castShadow:!0,children:[t.jsx("planeGeometry",{args:[1.5,1.5]}),t.jsx("meshStandardMaterial",{color:a,side:o,roughness:.75})]})}),"cutting"===s&&t.jsxs("group",{position:[Math.cos(r*Math.PI/d.symmetry)*(.3+.6*r),Math.sin(r*Math.PI/d.symmetry)*(.3+.6*r),.1],children:[t.jsxs("mesh",{children:[t.jsx("sphereGeometry",{args:[.05,16,16]}),t.jsx("meshBasicMaterial",{color:"#FFD700"})]}),t.jsx(c,{count:10,scale:.3,size:2,speed:.5,color:"#FFD700"})]})]})}function A({isComplete:s,design:a}){const r=e.useRef(null);return i(e=>{r.current&&s&&(r.current.rotation.z=.5*e.clock.elapsedTime)}),s?t.jsxs("group",{ref:r,children:[t.jsxs("mesh",{position:[0,0,-.1],children:[t.jsx("ringGeometry",{args:[1.6,1.8,64]}),t.jsx("meshBasicMaterial",{color:"#FFD700",transparent:!0,opacity:.5,side:o})]}),t.jsx(c,{count:100,scale:4,size:3,speed:.5,color:a.paperColor}),t.jsx(d,{center:!0,position:[0,-2,0],children:t.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center",children:[t.jsx("p",{className:"text-2xl font-bold text-red-600 mb-1",children:a.blessing}),t.jsx("p",{className:"text-sm text-red-400",children:a.patternName})]})})]}):null}function _({design:e,foldState:s,cutProgress:n}){return t.jsxs(t.Fragment,{children:[t.jsx("ambientLight",{intensity:.6}),t.jsx("directionalLight",{position:[5,5,5],intensity:.8,castShadow:!0}),t.jsx("pointLight",{position:[-3,3,3],intensity:.4,color:"#FFD700"}),t.jsx(a,{speed:2,rotationIntensity:.1,floatIntensity:.3,children:t.jsx(D,{foldState:s,paperColor:e.paperColor,cutProgress:n,design:e})}),t.jsx(A,{isComplete:"complete"===s,design:e}),t.jsx(r,{enableZoom:!0,enablePan:!1,minDistance:3,maxDistance:8,minPolarAngle:Math.PI/4,maxPolarAngle:Math.PI/1.5})]})}function G({currentStep:e,steps:s}){return t.jsx("div",{className:"flex items-center gap-2",children:s.map((a,r)=>t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold transition-all "+(r<e?"bg-green-500 text-white":r===e?"bg-red-500 text-white animate-pulse":"bg-gray-200 text-gray-400"),children:r<e?"âœ“":r+1}),r<s.length-1&&t.jsx("div",{className:"w-8 h-1 mx-1 rounded "+(r<e?"bg-green-500":"bg-gray-200")})]},r))})}function B(){var a;const r=u(),{unlockScene:n}=x(),{addCarbonSaving:i}=m(),[l,o]=e.useState(()=>z()),[c,d]=e.useState("intro"),[T,F]=e.useState(0),[D,A]=e.useState(!1),B="intro"===c?0:"folding"===c?1:"cutting"===c?2:3,E=e.useCallback(()=>{o(z())},[]),L=e.useCallback(()=>{d("folding"),setTimeout(()=>{d("cutting")},2e3)},[]),O=e.useCallback(()=>{"cutting"===c&&F(e=>{const t=Math.min(1,e+.02);return t>=1&&setTimeout(()=>{d("unfolding"),setTimeout(()=>{d("complete"),A(!0),h.getState().addPoints({type:"experience",points:50,description:`å®Œæˆå‰ªçº¸ä½œå“ï¼š${l.patternName}`,relatedId:"paper_cutting_v2"}),i({type:"digital_experience",carbonSaved:p.paper_cutting.baseSaving,description:"å‰ªçº¸è‰ºæœ¯ä½“éªŒ - ä¼ æ‰¿éé—æ™ºæ…§",experienceId:"paper_cutting_v2"})},3e3)},500),t})},[c,l.patternName,i]);e.useEffect(()=>{if("cutting"!==c)return;const e=setInterval(()=>{},50);return()=>clearInterval(e)},[c]);const R=e.useCallback(()=>{d("intro"),F(0),A(!1),E()},[E]),$="intro"===c?"flat":"folding"===c?"folded":"cutting"===c?"cutting":"unfolding"===c?"unfolding":"complete";return t.jsxs("div",{className:"relative w-full h-screen bg-gradient-to-b from-red-50 to-orange-50 overflow-hidden",children:[t.jsx("button",{onClick:()=>r(-1),className:"absolute top-4 left-4 z-20 p-2 bg-white/80 rounded-full shadow-lg",children:t.jsx(j,{className:"w-5 h-5 text-gray-600"})}),t.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-red-900/80 to-transparent z-10",children:t.jsxs("div",{className:"max-w-lg mx-auto text-center",children:[t.jsx("h2",{className:"text-xl font-bold text-white",children:"âœ‚ï¸ å‰ªçº¸è‰ºæœ¯"}),t.jsx("p",{className:"text-sm text-white/70",children:"é™•åŒ—éé— Â· åƒå¹´ä¼ æ‰¿"}),t.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[t.jsxs("span",{className:`px-3 py-1 bg-gradient-to-r ${(null==(a=I.find(e=>e.color===l.paperColor))?void 0:a.gradient)||"from-red-500 to-red-600"} rounded-full text-xs font-medium text-white`,children:[P[l.patternType].icon," ",l.patternName]}),t.jsxs("span",{className:"text-xs text-white/50",children:["#",l.seed.toString(16).toUpperCase()]})]}),t.jsx("div",{className:"flex justify-center mt-3",children:t.jsx(G,{currentStep:B,steps:["é€‰æ‹©å›¾æ¡ˆ","æŠ˜å çº¸å¼ ","å‰ªè£å›¾æ¡ˆ","å±•å¼€æ¬£èµ"]})})]})}),t.jsx("div",{className:"absolute inset-0 pt-32",onClick:O,onTouchStart:O,children:t.jsx(s,{shadows:!0,camera:{position:[0,0,5],fov:45},children:t.jsx(_,{design:l,foldState:$,cutProgress:T})})}),t.jsx(f,{children:"intro"===c&&t.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 flex items-center justify-center bg-black/40 z-30",children:t.jsxs(N.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-white rounded-3xl p-6 max-w-md mx-4 shadow-2xl",children:[t.jsxs("div",{className:"text-center mb-6",children:[t.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-gradient-to-br from-red-500 to-red-600 rounded-2xl flex items-center justify-center",children:t.jsx(b,{className:"w-10 h-10 text-white"})}),t.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-2",children:"å‰ªçº¸è‰ºæœ¯ä½“éªŒ"}),t.jsx("p",{className:"text-gray-500",children:"åˆ›é€ å±äºä½ çš„ç‹¬ç‰¹å‰ªçº¸ä½œå“"})]}),t.jsxs("div",{className:"bg-red-50 rounded-xl p-4 mb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("span",{className:"text-sm font-medium text-red-700",children:"ä½ çš„ä¸“å±è®¾è®¡"}),t.jsxs("button",{onClick:E,className:"text-xs text-red-500 hover:text-red-600 flex items-center gap-1",children:[t.jsx(y,{className:"w-3 h-3"})," æ¢ä¸€ä¸ª"]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[t.jsxs("div",{className:"bg-white rounded-lg p-2",children:[t.jsx("span",{className:"text-gray-500",children:"å›¾æ¡ˆ"}),t.jsx("p",{className:"font-bold text-red-600",children:l.patternName})]}),t.jsxs("div",{className:"bg-white rounded-lg p-2",children:[t.jsx("span",{className:"text-gray-500",children:"ç±»å‹"}),t.jsx("p",{className:"font-bold text-red-600",children:P[l.patternType].name})]}),t.jsxs("div",{className:"bg-white rounded-lg p-2",children:[t.jsx("span",{className:"text-gray-500",children:"å¯¹ç§°"}),t.jsxs("p",{className:"font-bold text-red-600",children:[l.symmetry,"è½´å¯¹ç§°"]})]}),t.jsxs("div",{className:"bg-white rounded-lg p-2",children:[t.jsx("span",{className:"text-gray-500",children:"ç¥ç¦"}),t.jsx("p",{className:"font-bold text-red-600",children:l.blessing})]})]})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"çº¸å¼ é¢œè‰²"}),t.jsx("div",{className:"flex gap-2",children:I.map((e,s)=>t.jsx("button",{onClick:()=>o(t=>({...t,paperColor:e.color,paperColorName:e.name})),className:"w-10 h-10 rounded-full border-2 transition-all "+(l.paperColor===e.color?"border-gray-800 scale-110":"border-transparent"),style:{backgroundColor:e.color},title:e.name},s))})]}),t.jsxs(g,{className:"w-full bg-gradient-to-r from-red-500 to-red-600 text-white",onClick:L,children:[t.jsx(v,{className:"w-4 h-4 mr-2"}),"å¼€å§‹åˆ›ä½œ"]}),t.jsx("p",{className:"text-xs text-gray-400 text-center mt-3",children:"ç‚¹å‡»å±å¹•è¿›è¡Œå‰ªè£"})]})})}),"cutting"===c&&t.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"absolute bottom-32 left-1/2 -translate-x-1/2 z-10",children:t.jsx("div",{className:"bg-white/90 backdrop-blur rounded-2xl px-6 py-3 shadow-lg",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(b,{className:"w-5 h-5 text-red-500 animate-pulse"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-800",children:"ç‚¹å‡»å±å¹•å‰ªè£"}),t.jsx("div",{className:"w-32 h-2 bg-gray-200 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-red-500 transition-all",style:{width:100*T+"%"}})})]})]})})}),"unfolding"===c&&t.jsx(N.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"absolute inset-0 flex items-center justify-center z-20 pointer-events-none",children:t.jsxs("div",{className:"text-center",children:[t.jsx(N.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},className:"w-16 h-16 mx-auto mb-4",children:t.jsx(w,{className:"w-full h-full text-yellow-500"})}),t.jsx("p",{className:"text-xl font-bold text-red-600",children:"å±•å¼€ä¸­..."})]})}),t.jsx(f,{children:D&&t.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 flex items-center justify-center bg-black/60 z-50 p-4",children:t.jsxs(N.div,{initial:{scale:.8,y:20},animate:{scale:1,y:0},className:"bg-white rounded-3xl p-6 max-w-md w-full",children:[t.jsxs("div",{className:"text-center mb-6",children:[t.jsx(N.div,{animate:{rotate:[0,10,-10,0],scale:[1,1.1,1]},transition:{duration:.5,repeat:2},className:"w-20 h-20 mx-auto mb-4 bg-gradient-to-br from-red-500 to-orange-500 rounded-2xl flex items-center justify-center",children:t.jsx(C,{className:"w-10 h-10 text-white"})}),t.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-2",children:"ğŸ‰ ä½œå“å®Œæˆï¼"}),t.jsxs("p",{className:"text-gray-500",children:[l.patternName," Â· ",l.blessing]})]}),t.jsx("div",{className:"bg-red-50 rounded-xl p-4 mb-4",children:t.jsxs("div",{className:"grid grid-cols-3 gap-3 text-center",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-2xl font-bold text-red-600",children:l.symmetry}),t.jsx("p",{className:"text-xs text-gray-500",children:"è½´å¯¹ç§°"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-2xl font-bold text-red-600",children:l.complexity}),t.jsx("p",{className:"text-xs text-gray-500",children:"å¤æ‚åº¦"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-2xl font-bold text-green-600",children:"+50"}),t.jsx("p",{className:"text-xs text-gray-500",children:"ç»¿è‰²ç§¯åˆ†"})]})]})}),t.jsxs("div",{className:"bg-green-50 rounded-xl p-3 mb-4 flex items-center gap-3",children:[t.jsx(M,{className:"w-8 h-8 text-green-500"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-green-700",children:"ä¼ ç»Ÿçº¸è‰º Â· ç»¿è‰²ç¯ä¿"}),t.jsx("p",{className:"text-xs text-green-600",children:"å¤©ç„¶ææ–™ï¼Œ6å‘¨å³å¯åˆ†è§£"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(g,{className:"w-full bg-gradient-to-r from-red-500 to-orange-500",onClick:()=>{n("paper_cutting"),r("/create/polaroid?scene=paper_cutting&design="+l.seed)},children:[t.jsx(S,{className:"w-4 h-4 mr-2"}),"ç”Ÿæˆä¸“å±æ‹ç«‹å¾—"]}),t.jsxs(g,{variant:"outline",className:"w-full",onClick:R,children:[t.jsx(y,{className:"w-4 h-4 mr-2"}),"å†åˆ›ä½œä¸€ä¸ª"]})]})]})})}),t.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-red-900/80 to-transparent z-10",children:t.jsx("div",{className:"max-w-lg mx-auto",children:t.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-xl p-3 flex items-start gap-3",children:[t.jsx(k,{className:"w-5 h-5 text-green-400 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"text-white/80 text-sm",children:[t.jsx("p",{className:"font-medium mb-1",children:"ğŸŒ¿ ä¼ ç»Ÿçº¸è‰º Â· ç»¿è‰²æ™ºæ…§"}),t.jsx("p",{className:"text-xs text-white/60",children:"ä¼ ç»Ÿæ‰‹å·¥çº¸ä½¿ç”¨ç«¹å­ã€æ¡‘çš®ç­‰å¤©ç„¶ææ–™ï¼Œå¯å›æ”¶åˆ©ç”¨7æ¬¡ä»¥ä¸Šï¼Œ ç›¸æ¯”å¡‘æ–™åˆ¶å“å‡å°‘65%ç¢³æ’æ”¾ã€‚"})]})]})})})]})}export{B as default};
