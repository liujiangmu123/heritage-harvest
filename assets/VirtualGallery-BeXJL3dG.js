import{c as Bn,r as be,j as H,L as Kr,V as Rn,A as Gn,m as Ln,X as Pn}from"./index-DNTNSv4A.js";import{u as Nt,s as On,_ as hn,e as In,a as wr,C as jn,O as Nn}from"./OrbitControls--00mctsD.js";import{C as Wn}from"./chevron-left-iTNgPbyR.js";import{R as zn}from"./rotate-ccw-B99-77Dq.js";import{I as Vn}from"./info-B4_OXgaz.js";import{P as Hn}from"./PerspectiveCamera-DJVWCxgF.js";import{E as Xn}from"./Environment-CVe7l8R0.js";import{M as Yn,a as Jn,R as Kn,U as Qn,S as Zn,b as Ht,c as qn,C as Xt,V as Je,d as gr,e as Ke,I as $n,f as ea,B as dn,g as ta,T as ra,L as ut,h as na,i as Vt,D as aa,P as Tr,j as oa,k as ia,N as sa,l as Ne,W as xr,H as vn,m as la,n as fa,o as ua,p as Qr,q as ca,r as ha,s as da,t as va,u as pa,v as ma,w as ga}from"./three.module-C2hvsvVY.js";import{H as xa}from"./Html-CsU2rVt3.js";import"./constants-Ck1MbfUW.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=Bn("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);function ba(){var c=Object.create(null);function r(t,e){var a=t.id,i=t.name,n=t.dependencies;n===void 0&&(n=[]);var o=t.init;o===void 0&&(o=function(){});var s=t.getTransferables;if(s===void 0&&(s=null),!c[a])try{n=n.map(function(f){return f&&f.isWorkerModule&&(r(f,function(h){if(h instanceof Error)throw h}),f=c[f.id].value),f}),o=u("<"+i+">.init",o),s&&(s=u("<"+i+">.getTransferables",s));var l=null;typeof o=="function"?l=o.apply(void 0,n):console.error("worker module init function failed to rehydrate"),c[a]={id:a,value:l,getTransferables:s},e(l)}catch(f){f&&f.noLog||console.error(f),e(f)}}function d(t,e){var a,i=t.id,n=t.args;(!c[i]||typeof c[i].value!="function")&&e(new Error("Worker module "+i+": not found or its 'init' did not return a function"));try{var o=(a=c[i]).value.apply(a,n);o&&typeof o.then=="function"?o.then(s,function(l){return e(l instanceof Error?l:new Error(""+l))}):s(o)}catch(l){e(l)}function s(l){try{var f=c[i].getTransferables&&c[i].getTransferables(l);(!f||!Array.isArray(f)||!f.length)&&(f=void 0),e(l,f)}catch(h){console.error(h),e(h)}}}function u(t,e){var a=void 0;self.troikaDefine=function(n){return a=n};var i=URL.createObjectURL(new Blob(["/** "+t.replace(/\*/g,"")+` **/

troikaDefine(
`+e+`
)`],{type:"application/javascript"}));try{importScripts(i)}catch(n){console.error(n)}return URL.revokeObjectURL(i),delete self.troikaDefine,a}self.addEventListener("message",function(t){var e=t.data,a=e.messageId,i=e.action,n=e.data;try{i==="registerModule"&&r(n,function(o){o instanceof Error?postMessage({messageId:a,success:!1,error:o.message}):postMessage({messageId:a,success:!0,result:{isCallable:typeof o=="function"}})}),i==="callModule"&&d(n,function(o,s){o instanceof Error?postMessage({messageId:a,success:!1,error:o.message}):postMessage({messageId:a,success:!0,result:o},s||void 0)})}catch(o){postMessage({messageId:a,success:!1,error:o.stack})}})}function _a(c){var r=function(){for(var d=[],u=arguments.length;u--;)d[u]=arguments[u];return r._getInitResult().then(function(t){if(typeof t=="function")return t.apply(void 0,d);throw new Error("Worker module function was called but `init` did not return a callable function")})};return r._getInitResult=function(){var d=c.dependencies,u=c.init;d=Array.isArray(d)?d.map(function(e){return e&&(e=e.onMainThread||e,e._getInitResult&&(e=e._getInitResult())),e}):[];var t=Promise.all(d).then(function(e){return u.apply(null,e)});return r._getInitResult=function(){return t},t},r}var pn=function(){var c=!1;if(typeof window<"u"&&typeof window.document<"u")try{var r=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));r.terminate(),c=!0}catch(d){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+d.message+"]")}return pn=function(){return c},c},Ua=0,Sa=0,vr=!1,wt=Object.create(null),Tt=Object.create(null),yr=Object.create(null);function ct(c){if((!c||typeof c.init!="function")&&!vr)throw new Error("requires `options.init` function");var r=c.dependencies,d=c.init,u=c.getTransferables,t=c.workerId,e=_a(c);t==null&&(t="#default");var a="workerModule"+ ++Ua,i=c.name||a,n=null;r=r&&r.map(function(s){return typeof s=="function"&&!s.workerModuleData&&(vr=!0,s=ct({workerId:t,name:"<"+i+"> function dependency: "+s.name,init:`function(){return (
`+Wt(s)+`
)}`}),vr=!1),s&&s.workerModuleData&&(s=s.workerModuleData),s});function o(){for(var s=[],l=arguments.length;l--;)s[l]=arguments[l];if(!pn())return e.apply(void 0,s);if(!n){n=Zr(t,"registerModule",o.workerModuleData);var f=function(){n=null,Tt[t].delete(f)};(Tt[t]||(Tt[t]=new Set)).add(f)}return n.then(function(h){var p=h.isCallable;if(p)return Zr(t,"callModule",{id:a,args:s});throw new Error("Worker module function was called but `init` did not return a callable function")})}return o.workerModuleData={isWorkerModule:!0,id:a,name:i,dependencies:r,init:Wt(d),getTransferables:u&&Wt(u)},o.onMainThread=e,o}function wa(c){Tt[c]&&Tt[c].forEach(function(r){r()}),wt[c]&&(wt[c].terminate(),delete wt[c])}function Wt(c){var r=c.toString();return!/^function/.test(r)&&/^\w+\s*\(/.test(r)&&(r="function "+r),r}function Ta(c){var r=wt[c];if(!r){var d=Wt(ba);r=wt[c]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+c.replace(/\*/g,"")+` **/

;(`+d+")()"],{type:"application/javascript"}))),r.onmessage=function(u){var t=u.data,e=t.messageId,a=yr[e];if(!a)throw new Error("WorkerModule response with empty or unknown messageId");delete yr[e],a(t)}}return r}function Zr(c,r,d){return new Promise(function(u,t){var e=++Sa;yr[e]=function(a){a.success?u(a.result):t(new Error("Error in worker "+r+" call: "+a.error))},Ta(c).postMessage({messageId:e,action:r,data:d})})}function mn(){var c=function(r){function d(O,A,v,x,_,M,T,j){var B=1-T;j.x=B*B*O+2*B*T*v+T*T*_,j.y=B*B*A+2*B*T*x+T*T*M}function u(O,A,v,x,_,M,T,j,B,I){var J=1-B;I.x=J*J*J*O+3*J*J*B*v+3*J*B*B*_+B*B*B*T,I.y=J*J*J*A+3*J*J*B*x+3*J*B*B*M+B*B*B*j}function t(O,A){for(var v=/([MLQCZ])([^MLQCZ]*)/g,x,_,M,T,j;x=v.exec(O);){var B=x[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(I){return parseFloat(I)});switch(x[1]){case"M":T=_=B[0],j=M=B[1];break;case"L":(B[0]!==T||B[1]!==j)&&A("L",T,j,T=B[0],j=B[1]);break;case"Q":{A("Q",T,j,T=B[2],j=B[3],B[0],B[1]);break}case"C":{A("C",T,j,T=B[4],j=B[5],B[0],B[1],B[2],B[3]);break}case"Z":(T!==_||j!==M)&&A("L",T,j,_,M);break}}}function e(O,A,v){v===void 0&&(v=16);var x={x:0,y:0};t(O,function(_,M,T,j,B,I,J,te,X){switch(_){case"L":A(M,T,j,B);break;case"Q":{for(var N=M,me=T,ce=1;ce<v;ce++)d(M,T,I,J,j,B,ce/(v-1),x),A(N,me,x.x,x.y),N=x.x,me=x.y;break}case"C":{for(var q=M,re=T,le=1;le<v;le++)u(M,T,I,J,te,X,j,B,le/(v-1),x),A(q,re,x.x,x.y),q=x.x,re=x.y;break}}})}var a="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",i="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",n=new WeakMap,o={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function s(O,A){var v=O.getContext?O.getContext("webgl",o):O,x=n.get(v);if(!x){let J=function(q){var re=M[q];if(!re&&(re=M[q]=v.getExtension(q),!re))throw new Error(q+" not supported");return re},te=function(q,re){var le=v.createShader(re);return v.shaderSource(le,q),v.compileShader(le),le},X=function(q,re,le,V){if(!T[q]){var ne={},$={},L=v.createProgram();v.attachShader(L,te(re,v.VERTEX_SHADER)),v.attachShader(L,te(le,v.FRAGMENT_SHADER)),v.linkProgram(L),T[q]={program:L,transaction:function(Z){v.useProgram(L),Z({setUniform:function(K,_e){for(var ae=[],ie=arguments.length-2;ie-- >0;)ae[ie]=arguments[ie+2];var ue=$[_e]||($[_e]=v.getUniformLocation(L,_e));v["uniform"+K].apply(v,[ue].concat(ae))},setAttribute:function(K,_e,ae,ie,ue){var ve=ne[K];ve||(ve=ne[K]={buf:v.createBuffer(),loc:v.getAttribLocation(L,K),data:null}),v.bindBuffer(v.ARRAY_BUFFER,ve.buf),v.vertexAttribPointer(ve.loc,_e,v.FLOAT,!1,0,0),v.enableVertexAttribArray(ve.loc),_?v.vertexAttribDivisor(ve.loc,ie):J("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(ve.loc,ie),ue!==ve.data&&(v.bufferData(v.ARRAY_BUFFER,ue,ae),ve.data=ue)}})}}}T[q].transaction(V)},N=function(q,re){B++;try{v.activeTexture(v.TEXTURE0+B);var le=j[q];le||(le=j[q]=v.createTexture(),v.bindTexture(v.TEXTURE_2D,le),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.NEAREST),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.NEAREST)),v.bindTexture(v.TEXTURE_2D,le),re(le,B)}finally{B--}},me=function(q,re,le){var V=v.createFramebuffer();I.push(V),v.bindFramebuffer(v.FRAMEBUFFER,V),v.activeTexture(v.TEXTURE0+re),v.bindTexture(v.TEXTURE_2D,q),v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,q,0);try{le(V)}finally{v.deleteFramebuffer(V),v.bindFramebuffer(v.FRAMEBUFFER,I[--I.length-1]||null)}},ce=function(){M={},T={},j={},B=-1,I.length=0};var _=typeof WebGL2RenderingContext<"u"&&v instanceof WebGL2RenderingContext,M={},T={},j={},B=-1,I=[];v.canvas.addEventListener("webglcontextlost",function(q){ce(),q.preventDefault()},!1),n.set(v,x={gl:v,isWebGL2:_,getExtension:J,withProgram:X,withTexture:N,withTextureFramebuffer:me,handleContextLoss:ce})}A(x)}function l(O,A,v,x,_,M,T,j){T===void 0&&(T=15),j===void 0&&(j=null),s(O,function(B){var I=B.gl,J=B.withProgram,te=B.withTexture;te("copy",function(X,N){I.texImage2D(I.TEXTURE_2D,0,I.RGBA,_,M,0,I.RGBA,I.UNSIGNED_BYTE,A),J("copy",a,i,function(me){var ce=me.setUniform,q=me.setAttribute;q("aUV",2,I.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),ce("1i","image",N),I.bindFramebuffer(I.FRAMEBUFFER,j||null),I.disable(I.BLEND),I.colorMask(T&8,T&4,T&2,T&1),I.viewport(v,x,_,M),I.scissor(v,x,_,M),I.drawArrays(I.TRIANGLES,0,3)})})})}function f(O,A,v){var x=O.width,_=O.height;s(O,function(M){var T=M.gl,j=new Uint8Array(x*_*4);T.readPixels(0,0,x,_,T.RGBA,T.UNSIGNED_BYTE,j),O.width=A,O.height=v,l(T,j,0,0,x,_)})}var h=Object.freeze({__proto__:null,withWebGLContext:s,renderImageData:l,resizeWebGLCanvasWithoutClearing:f});function p(O,A,v,x,_,M){M===void 0&&(M=1);var T=new Uint8Array(O*A),j=x[2]-x[0],B=x[3]-x[1],I=[];e(v,function(q,re,le,V){I.push({x1:q,y1:re,x2:le,y2:V,minX:Math.min(q,le),minY:Math.min(re,V),maxX:Math.max(q,le),maxY:Math.max(re,V)})}),I.sort(function(q,re){return q.maxX-re.maxX});for(var J=0;J<O;J++)for(var te=0;te<A;te++){var X=me(x[0]+j*(J+.5)/O,x[1]+B*(te+.5)/A),N=Math.pow(1-Math.abs(X)/_,M)/2;X<0&&(N=1-N),N=Math.max(0,Math.min(255,Math.round(N*255))),T[te*O+J]=N}return T;function me(q,re){for(var le=1/0,V=1/0,ne=I.length;ne--;){var $=I[ne];if($.maxX+V<=q)break;if(q+V>$.minX&&re-V<$.maxY&&re+V>$.minY){var L=G(q,re,$.x1,$.y1,$.x2,$.y2);L<le&&(le=L,V=Math.sqrt(le))}}return ce(q,re)&&(V=-V),V}function ce(q,re){for(var le=0,V=I.length;V--;){var ne=I[V];if(ne.maxX<=q)break;var $=ne.y1>re!=ne.y2>re&&q<(ne.x2-ne.x1)*(re-ne.y1)/(ne.y2-ne.y1)+ne.x1;$&&(le+=ne.y1<ne.y2?1:-1)}return le!==0}}function m(O,A,v,x,_,M,T,j,B,I){M===void 0&&(M=1),j===void 0&&(j=0),B===void 0&&(B=0),I===void 0&&(I=0),g(O,A,v,x,_,M,T,null,j,B,I)}function g(O,A,v,x,_,M,T,j,B,I,J){M===void 0&&(M=1),B===void 0&&(B=0),I===void 0&&(I=0),J===void 0&&(J=0);for(var te=p(O,A,v,x,_,M),X=new Uint8Array(te.length*4),N=0;N<te.length;N++)X[N*4+J]=te[N];l(T,X,B,I,O,A,1<<3-J,j)}function G(O,A,v,x,_,M){var T=_-v,j=M-x,B=T*T+j*j,I=B?Math.max(0,Math.min(1,((O-v)*T+(A-x)*j)/B)):0,J=O-(v+I*T),te=A-(x+I*j);return J*J+te*te}var w=Object.freeze({__proto__:null,generate:p,generateIntoCanvas:m,generateIntoFramebuffer:g}),F="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",b="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",U="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",R=new Float32Array([0,0,2,0,0,2]),S=null,D=!1,P={},E=new WeakMap;function Y(O){if(!D&&!W(O))throw new Error("WebGL generation not supported")}function y(O,A,v,x,_,M,T){if(M===void 0&&(M=1),T===void 0&&(T=null),!T&&(T=S,!T)){var j=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!j)throw new Error("OffscreenCanvas or DOM canvas not supported");T=S=j.getContext("webgl",{depth:!1})}Y(T);var B=new Uint8Array(O*A*4);s(T,function(X){var N=X.gl,me=X.withTexture,ce=X.withTextureFramebuffer;me("readable",function(q,re){N.texImage2D(N.TEXTURE_2D,0,N.RGBA,O,A,0,N.RGBA,N.UNSIGNED_BYTE,null),ce(q,re,function(le){k(O,A,v,x,_,M,N,le,0,0,0),N.readPixels(0,0,O,A,N.RGBA,N.UNSIGNED_BYTE,B)})})});for(var I=new Uint8Array(O*A),J=0,te=0;J<B.length;J+=4)I[te++]=B[J];return I}function C(O,A,v,x,_,M,T,j,B,I){M===void 0&&(M=1),j===void 0&&(j=0),B===void 0&&(B=0),I===void 0&&(I=0),k(O,A,v,x,_,M,T,null,j,B,I)}function k(O,A,v,x,_,M,T,j,B,I,J){M===void 0&&(M=1),B===void 0&&(B=0),I===void 0&&(I=0),J===void 0&&(J=0),Y(T);var te=[];e(v,function(X,N,me,ce){te.push(X,N,me,ce)}),te=new Float32Array(te),s(T,function(X){var N=X.gl,me=X.isWebGL2,ce=X.getExtension,q=X.withProgram,re=X.withTexture,le=X.withTextureFramebuffer,V=X.handleContextLoss;if(re("rawDistances",function(ne,$){(O!==ne._lastWidth||A!==ne._lastHeight)&&N.texImage2D(N.TEXTURE_2D,0,N.RGBA,ne._lastWidth=O,ne._lastHeight=A,0,N.RGBA,N.UNSIGNED_BYTE,null),q("main",F,b,function(L){var de=L.setAttribute,Z=L.setUniform,oe=!me&&ce("ANGLE_instanced_arrays"),K=!me&&ce("EXT_blend_minmax");de("aUV",2,N.STATIC_DRAW,0,R),de("aLineSegment",4,N.DYNAMIC_DRAW,1,te),Z.apply(void 0,["4f","uGlyphBounds"].concat(x)),Z("1f","uMaxDistance",_),Z("1f","uExponent",M),le(ne,$,function(_e){N.enable(N.BLEND),N.colorMask(!0,!0,!0,!0),N.viewport(0,0,O,A),N.scissor(0,0,O,A),N.blendFunc(N.ONE,N.ONE),N.blendEquationSeparate(N.FUNC_ADD,me?N.MAX:K.MAX_EXT),N.clear(N.COLOR_BUFFER_BIT),me?N.drawArraysInstanced(N.TRIANGLES,0,3,te.length/4):oe.drawArraysInstancedANGLE(N.TRIANGLES,0,3,te.length/4)})}),q("post",a,U,function(L){L.setAttribute("aUV",2,N.STATIC_DRAW,0,R),L.setUniform("1i","tex",$),N.bindFramebuffer(N.FRAMEBUFFER,j),N.disable(N.BLEND),N.colorMask(J===0,J===1,J===2,J===3),N.viewport(B,I,O,A),N.scissor(B,I,O,A),N.drawArrays(N.TRIANGLES,0,3)})}),N.isContextLost())throw V(),new Error("webgl context lost")})}function W(O){var A=!O||O===S?P:O.canvas||O,v=E.get(A);if(v===void 0){D=!0;var x=null;try{var _=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],M=y(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,O);v=M&&_.length===M.length&&M.every(function(T,j){return T===_[j]}),v||(x="bad trial run results",console.info(_,M))}catch(T){v=!1,x=T.message}x&&console.warn("WebGL SDF generation not supported:",x),D=!1,E.set(A,v)}return v}var z=Object.freeze({__proto__:null,generate:y,generateIntoCanvas:C,generateIntoFramebuffer:k,isSupported:W});function Q(O,A,v,x,_,M){_===void 0&&(_=Math.max(x[2]-x[0],x[3]-x[1])/2),M===void 0&&(M=1);try{return y.apply(z,arguments)}catch(T){return console.info("WebGL SDF generation failed, falling back to JS",T),p.apply(w,arguments)}}function ee(O,A,v,x,_,M,T,j,B,I){_===void 0&&(_=Math.max(x[2]-x[0],x[3]-x[1])/2),M===void 0&&(M=1),j===void 0&&(j=0),B===void 0&&(B=0),I===void 0&&(I=0);try{return C.apply(z,arguments)}catch(J){return console.info("WebGL SDF generation failed, falling back to JS",J),m.apply(w,arguments)}}return r.forEachPathCommand=t,r.generate=Q,r.generateIntoCanvas=ee,r.javascript=w,r.pathToLineSegments=e,r.webgl=z,r.webglUtils=h,Object.defineProperty(r,"__esModule",{value:!0}),r}({});return c}function ka(){var c=function(r){var d={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},u={},t={};u.L=1,t[1]="L",Object.keys(d).forEach(function(V,ne){u[V]=1<<ne+1,t[u[V]]=V}),Object.freeze(u);var e=u.LRI|u.RLI|u.FSI,a=u.L|u.R|u.AL,i=u.B|u.S|u.WS|u.ON|u.FSI|u.LRI|u.RLI|u.PDI,n=u.BN|u.RLE|u.LRE|u.RLO|u.LRO|u.PDF,o=u.S|u.WS|u.B|e|u.PDI|n,s=null;function l(){if(!s){s=new Map;var V=function($){if(d.hasOwnProperty($)){var L=0;d[$].split(",").forEach(function(de){var Z=de.split("+"),oe=Z[0],K=Z[1];oe=parseInt(oe,36),K=K?parseInt(K,36):0,s.set(L+=oe,u[$]);for(var _e=0;_e<K;_e++)s.set(++L,u[$])})}};for(var ne in d)V(ne)}}function f(V){return l(),s.get(V.codePointAt(0))||u.L}function h(V){return t[f(V)]}var p={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function m(V,ne){var $=36,L=0,de=new Map,Z=ne&&new Map,oe;return V.split(",").forEach(function K(_e){if(_e.indexOf("+")!==-1)for(var ae=+_e;ae--;)K(oe);else{oe=_e;var ie=_e.split(">"),ue=ie[0],ve=ie[1];ue=String.fromCodePoint(L+=parseInt(ue,$)),ve=String.fromCodePoint(L+=parseInt(ve,$)),de.set(ue,ve),ne&&Z.set(ve,ue)}}),{map:de,reverseMap:Z}}var g,G,w;function F(){if(!g){var V=m(p.pairs,!0),ne=V.map,$=V.reverseMap;g=ne,G=$,w=m(p.canonical,!1).map}}function b(V){return F(),g.get(V)||null}function U(V){return F(),G.get(V)||null}function R(V){return F(),w.get(V)||null}var S=u.L,D=u.R,P=u.EN,E=u.ES,Y=u.ET,y=u.AN,C=u.CS,k=u.B,W=u.S,z=u.ON,Q=u.BN,ee=u.NSM,O=u.AL,A=u.LRO,v=u.RLO,x=u.LRE,_=u.RLE,M=u.PDF,T=u.LRI,j=u.RLI,B=u.FSI,I=u.PDI;function J(V,ne){for(var $=125,L=new Uint32Array(V.length),de=0;de<V.length;de++)L[de]=f(V[de]);var Z=new Map;function oe(Oe,Ve){var Ie=L[Oe];L[Oe]=Ve,Z.set(Ie,Z.get(Ie)-1),Ie&i&&Z.set(i,Z.get(i)-1),Z.set(Ve,(Z.get(Ve)||0)+1),Ve&i&&Z.set(i,(Z.get(i)||0)+1)}for(var K=new Uint8Array(V.length),_e=new Map,ae=[],ie=null,ue=0;ue<V.length;ue++)ie||ae.push(ie={start:ue,end:V.length-1,level:ne==="rtl"?1:ne==="ltr"?0:Yr(ue,!1)}),L[ue]&k&&(ie.end=ue,ie=null);for(var ve=_|x|v|A|e|I|M|k,we=function(Oe){return Oe+(Oe&1?1:2)},Me=function(Oe){return Oe+(Oe&1?2:1)},ge=0;ge<ae.length;ge++){ie=ae[ge];var xe=[{_level:ie.level,_override:0,_isolate:0}],fe=void 0,Ce=0,ke=0,Pe=0;Z.clear();for(var Te=ie.start;Te<=ie.end;Te++){var he=L[Te];if(fe=xe[xe.length-1],Z.set(he,(Z.get(he)||0)+1),he&i&&Z.set(i,(Z.get(i)||0)+1),he&ve)if(he&(_|x)){K[Te]=fe._level;var Ue=(he===_?Me:we)(fe._level);Ue<=$&&!Ce&&!ke?xe.push({_level:Ue,_override:0,_isolate:0}):Ce||ke++}else if(he&(v|A)){K[Te]=fe._level;var Qe=(he===v?Me:we)(fe._level);Qe<=$&&!Ce&&!ke?xe.push({_level:Qe,_override:he&v?D:S,_isolate:0}):Ce||ke++}else if(he&e){he&B&&(he=Yr(Te+1,!0)===1?j:T),K[Te]=fe._level,fe._override&&oe(Te,fe._override);var Se=(he===j?Me:we)(fe._level);Se<=$&&Ce===0&&ke===0?(Pe++,xe.push({_level:Se,_override:0,_isolate:1,_isolInitIndex:Te})):Ce++}else if(he&I){if(Ce>0)Ce--;else if(Pe>0){for(ke=0;!xe[xe.length-1]._isolate;)xe.pop();var ye=xe[xe.length-1]._isolInitIndex;ye!=null&&(_e.set(ye,Te),_e.set(Te,ye)),xe.pop(),Pe--}fe=xe[xe.length-1],K[Te]=fe._level,fe._override&&oe(Te,fe._override)}else he&M?(Ce===0&&(ke>0?ke--:!fe._isolate&&xe.length>1&&(xe.pop(),fe=xe[xe.length-1])),K[Te]=fe._level):he&k&&(K[Te]=ie.level);else K[Te]=fe._level,fe._override&&he!==Q&&oe(Te,fe._override)}for(var Ee=[],Fe=null,pe=ie.start;pe<=ie.end;pe++){var De=L[pe];if(!(De&n)){var Ge=K[pe],Re=De&e,Ae=De===I;Fe&&Ge===Fe._level?(Fe._end=pe,Fe._endsWithIsolInit=Re):Ee.push(Fe={_start:pe,_end:pe,_level:Ge,_startsWithPDI:Ae,_endsWithIsolInit:Re})}}for(var We=[],Ze=0;Ze<Ee.length;Ze++){var Xe=Ee[Ze];if(!Xe._startsWithPDI||Xe._startsWithPDI&&!_e.has(Xe._start)){for(var qe=[Fe=Xe],tt=void 0;Fe&&Fe._endsWithIsolInit&&(tt=_e.get(Fe._end))!=null;)for(var Ye=Ze+1;Ye<Ee.length;Ye++)if(Ee[Ye]._start===tt){qe.push(Fe=Ee[Ye]);break}for(var Le=[],rt=0;rt<qe.length;rt++)for(var Fr=qe[rt],Jt=Fr._start;Jt<=Fr._end;Jt++)Le.push(Jt);for(var Fn=K[Le[0]],Dr=ie.level,kt=Le[0]-1;kt>=0;kt--)if(!(L[kt]&n)){Dr=K[kt];break}var Kt=Le[Le.length-1],Dn=K[Kt],Mr=ie.level;if(!(L[Kt]&e)){for(var Ft=Kt+1;Ft<=ie.end;Ft++)if(!(L[Ft]&n)){Mr=K[Ft];break}}We.push({_seqIndices:Le,_sosType:Math.max(Dr,Fn)%2?D:S,_eosType:Math.max(Mr,Dn)%2?D:S})}}for(var Qt=0;Qt<We.length;Qt++){var Zt=We[Qt],se=Zt._seqIndices,ht=Zt._sosType,Mn=Zt._eosType,ot=K[se[0]]&1?D:S;if(Z.get(ee))for(var Dt=0;Dt<se.length;Dt++){var Cr=se[Dt];if(L[Cr]&ee){for(var qt=ht,Mt=Dt-1;Mt>=0;Mt--)if(!(L[se[Mt]]&n)){qt=L[se[Mt]];break}oe(Cr,qt&(e|I)?z:qt)}}if(Z.get(P))for(var Ct=0;Ct<se.length;Ct++){var Er=se[Ct];if(L[Er]&P)for(var Et=Ct-1;Et>=-1;Et--){var Ar=Et===-1?ht:L[se[Et]];if(Ar&a){Ar===O&&oe(Er,y);break}}}if(Z.get(O))for(var $t=0;$t<se.length;$t++){var Br=se[$t];L[Br]&O&&oe(Br,D)}if(Z.get(E)||Z.get(C))for(var dt=1;dt<se.length-1;dt++){var er=se[dt];if(L[er]&(E|C)){for(var it=0,tr=0,rr=dt-1;rr>=0&&(it=L[se[rr]],!!(it&n));rr--);for(var nr=dt+1;nr<se.length&&(tr=L[se[nr]],!!(tr&n));nr++);it===tr&&(L[er]===E?it===P:it&(P|y))&&oe(er,it)}}if(Z.get(P))for(var He=0;He<se.length;He++){var Cn=se[He];if(L[Cn]&P){for(var At=He-1;At>=0&&L[se[At]]&(Y|n);At--)oe(se[At],P);for(He++;He<se.length&&L[se[He]]&(Y|n|P);He++)L[se[He]]!==P&&oe(se[He],P)}}if(Z.get(Y)||Z.get(E)||Z.get(C))for(var vt=0;vt<se.length;vt++){var Rr=se[vt];if(L[Rr]&(Y|E|C)){oe(Rr,z);for(var Bt=vt-1;Bt>=0&&L[se[Bt]]&n;Bt--)oe(se[Bt],z);for(var Rt=vt+1;Rt<se.length&&L[se[Rt]]&n;Rt++)oe(se[Rt],z)}}if(Z.get(P))for(var ar=0,Gr=ht;ar<se.length;ar++){var Lr=se[ar],or=L[Lr];or&P?Gr===S&&oe(Lr,S):or&a&&(Gr=or)}if(Z.get(i)){var pt=D|P|y,Pr=pt|S,Gt=[];{for(var st=[],lt=0;lt<se.length;lt++)if(L[se[lt]]&i){var mt=V[se[lt]],Or=void 0;if(b(mt)!==null)if(st.length<63)st.push({char:mt,seqIndex:lt});else break;else if((Or=U(mt))!==null)for(var gt=st.length-1;gt>=0;gt--){var ir=st[gt].char;if(ir===Or||ir===U(R(mt))||b(R(ir))===mt){Gt.push([st[gt].seqIndex,lt]),st.length=gt;break}}}Gt.sort(function(Oe,Ve){return Oe[0]-Ve[0]})}for(var sr=0;sr<Gt.length;sr++){for(var Ir=Gt[sr],Lt=Ir[0],lr=Ir[1],jr=!1,ze=0,fr=Lt+1;fr<lr;fr++){var Nr=se[fr];if(L[Nr]&Pr){jr=!0;var Wr=L[Nr]&pt?D:S;if(Wr===ot){ze=Wr;break}}}if(jr&&!ze){ze=ht;for(var ur=Lt-1;ur>=0;ur--){var zr=se[ur];if(L[zr]&Pr){var Vr=L[zr]&pt?D:S;Vr!==ot?ze=Vr:ze=ot;break}}}if(ze){if(L[se[Lt]]=L[se[lr]]=ze,ze!==ot){for(var xt=Lt+1;xt<se.length;xt++)if(!(L[se[xt]]&n)){f(V[se[xt]])&ee&&(L[se[xt]]=ze);break}}if(ze!==ot){for(var yt=lr+1;yt<se.length;yt++)if(!(L[se[yt]]&n)){f(V[se[yt]])&ee&&(L[se[yt]]=ze);break}}}}for(var $e=0;$e<se.length;$e++)if(L[se[$e]]&i){for(var Hr=$e,cr=$e,hr=ht,bt=$e-1;bt>=0;bt--)if(L[se[bt]]&n)Hr=bt;else{hr=L[se[bt]]&pt?D:S;break}for(var Xr=Mn,_t=$e+1;_t<se.length;_t++)if(L[se[_t]]&(i|n))cr=_t;else{Xr=L[se[_t]]&pt?D:S;break}for(var dr=Hr;dr<=cr;dr++)L[se[dr]]=hr===Xr?hr:ot;$e=cr}}}for(var je=ie.start;je<=ie.end;je++){var En=K[je],Pt=L[je];if(En&1?Pt&(S|P|y)&&K[je]++:Pt&D?K[je]++:Pt&(y|P)&&(K[je]+=2),Pt&n&&(K[je]=je===0?ie.level:K[je-1]),je===ie.end||f(V[je])&(W|k))for(var Ot=je;Ot>=0&&f(V[Ot])&o;Ot--)K[Ot]=ie.level}}return{levels:K,paragraphs:ae};function Yr(Oe,Ve){for(var Ie=Oe;Ie<V.length;Ie++){var et=L[Ie];if(et&(D|O))return 1;if(et&(k|S)||Ve&&et===I)return 0;if(et&e){var Jr=An(Ie);Ie=Jr===-1?V.length:Jr}}return 0}function An(Oe){for(var Ve=1,Ie=Oe+1;Ie<V.length;Ie++){var et=L[Ie];if(et&k)break;if(et&I){if(--Ve===0)return Ie}else et&e&&Ve++}return-1}}var te="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",X;function N(){if(!X){var V=m(te,!0),ne=V.map,$=V.reverseMap;$.forEach(function(L,de){ne.set(de,L)}),X=ne}}function me(V){return N(),X.get(V)||null}function ce(V,ne,$,L){var de=V.length;$=Math.max(0,$==null?0:+$),L=Math.min(de-1,L==null?de-1:+L);for(var Z=new Map,oe=$;oe<=L;oe++)if(ne[oe]&1){var K=me(V[oe]);K!==null&&Z.set(oe,K)}return Z}function q(V,ne,$,L){var de=V.length;$=Math.max(0,$==null?0:+$),L=Math.min(de-1,L==null?de-1:+L);var Z=[];return ne.paragraphs.forEach(function(oe){var K=Math.max($,oe.start),_e=Math.min(L,oe.end);if(K<_e){for(var ae=ne.levels.slice(K,_e+1),ie=_e;ie>=K&&f(V[ie])&o;ie--)ae[ie]=oe.level;for(var ue=oe.level,ve=1/0,we=0;we<ae.length;we++){var Me=ae[we];Me>ue&&(ue=Me),Me<ve&&(ve=Me|1)}for(var ge=ue;ge>=ve;ge--)for(var xe=0;xe<ae.length;xe++)if(ae[xe]>=ge){for(var fe=xe;xe+1<ae.length&&ae[xe+1]>=ge;)xe++;xe>fe&&Z.push([fe+K,xe+K])}}}),Z}function re(V,ne,$,L){var de=le(V,ne,$,L),Z=[].concat(V);return de.forEach(function(oe,K){Z[K]=(ne.levels[oe]&1?me(V[oe]):null)||V[oe]}),Z.join("")}function le(V,ne,$,L){for(var de=q(V,ne,$,L),Z=[],oe=0;oe<V.length;oe++)Z[oe]=oe;return de.forEach(function(K){for(var _e=K[0],ae=K[1],ie=Z.slice(_e,ae+1),ue=ie.length;ue--;)Z[ae-ue]=ie[ue]}),Z}return r.closingToOpeningBracket=U,r.getBidiCharType=f,r.getBidiCharTypeName=h,r.getCanonicalBracket=R,r.getEmbeddingLevels=J,r.getMirroredCharacter=me,r.getMirroredCharactersMap=ce,r.getReorderSegments=q,r.getReorderedIndices=le,r.getReorderedString=re,r.openingToClosingBracket=b,Object.defineProperty(r,"__esModule",{value:!0}),r}({});return c}const gn=/\bvoid\s+main\s*\(\s*\)\s*{/g;function br(c){const r=/^[ \t]*#include +<([\w\d./]+)>/gm;function d(u,t){let e=Zn[t];return e?br(e):u}return c.replace(r,d)}const Be=[];for(let c=0;c<256;c++)Be[c]=(c<16?"0":"")+c.toString(16);function Fa(){const c=Math.random()*4294967295|0,r=Math.random()*4294967295|0,d=Math.random()*4294967295|0,u=Math.random()*4294967295|0;return(Be[c&255]+Be[c>>8&255]+Be[c>>16&255]+Be[c>>24&255]+"-"+Be[r&255]+Be[r>>8&255]+"-"+Be[r>>16&15|64]+Be[r>>24&255]+"-"+Be[d&63|128]+Be[d>>8&255]+"-"+Be[d>>16&255]+Be[d>>24&255]+Be[u&255]+Be[u>>8&255]+Be[u>>16&255]+Be[u>>24&255]).toUpperCase()}const nt=Object.assign||function(){let c=arguments[0];for(let r=1,d=arguments.length;r<d;r++){let u=arguments[r];if(u)for(let t in u)Object.prototype.hasOwnProperty.call(u,t)&&(c[t]=u[t])}return c},Da=Date.now(),qr=new WeakMap,$r=new Map;let Ma=1e10;function _r(c,r){const d=Ba(r);let u=qr.get(c);if(u||qr.set(c,u=Object.create(null)),u[d])return new u[d];const t=`_onBeforeCompile${d}`,e=function(o,s){c.onBeforeCompile.call(this,o,s);const l=this.customProgramCacheKey()+"|"+o.vertexShader+"|"+o.fragmentShader;let f=$r[l];if(!f){const h=Ca(this,o,r,d);f=$r[l]=h}o.vertexShader=f.vertexShader,o.fragmentShader=f.fragmentShader,nt(o.uniforms,this.uniforms),r.timeUniform&&(o.uniforms[r.timeUniform]={get value(){return Date.now()-Da}}),this[t]&&this[t](o)},a=function(){return i(r.chained?c:c.clone())},i=function(o){const s=Object.create(o,n);return Object.defineProperty(s,"baseMaterial",{value:c}),Object.defineProperty(s,"id",{value:Ma++}),s.uuid=Fa(),s.uniforms=nt({},o.uniforms,r.uniforms),s.defines=nt({},o.defines,r.defines),s.defines[`TROIKA_DERIVED_MATERIAL_${d}`]="",s.extensions=nt({},o.extensions,r.extensions),s._listeners=void 0,s},n={constructor:{value:a},isDerivedMaterial:{value:!0},type:{get:()=>c.type,set:o=>{c.type=o}},isDerivedFrom:{writable:!0,configurable:!0,value:function(o){const s=this.baseMaterial;return o===s||s.isDerivedMaterial&&s.isDerivedFrom(o)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return c.customProgramCacheKey()+"|"+d}},onBeforeCompile:{get(){return e},set(o){this[t]=o}},copy:{writable:!0,configurable:!0,value:function(o){return c.copy.call(this,o),!c.isShaderMaterial&&!c.isDerivedMaterial&&(nt(this.extensions,o.extensions),nt(this.defines,o.defines),nt(this.uniforms,Qn.clone(o.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const o=new c.constructor;return i(o).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let o=this._depthMaterial;return o||(o=this._depthMaterial=_r(c.isDerivedMaterial?c.getDepthMaterial():new Jn({depthPacking:Kn}),r),o.defines.IS_DEPTH_MATERIAL="",o.uniforms=this.uniforms),o}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let o=this._distanceMaterial;return o||(o=this._distanceMaterial=_r(c.isDerivedMaterial?c.getDistanceMaterial():new Yn,r),o.defines.IS_DISTANCE_MATERIAL="",o.uniforms=this.uniforms),o}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:o,_distanceMaterial:s}=this;o&&o.dispose(),s&&s.dispose(),c.dispose.call(this)}}};return u[d]=a,new a}function Ca(c,{vertexShader:r,fragmentShader:d},u,t){let{vertexDefs:e,vertexMainIntro:a,vertexMainOutro:i,vertexTransform:n,fragmentDefs:o,fragmentMainIntro:s,fragmentMainOutro:l,fragmentColorTransform:f,customRewriter:h,timeUniform:p}=u;if(e=e||"",a=a||"",i=i||"",o=o||"",s=s||"",l=l||"",(n||h)&&(r=br(r)),(f||h)&&(d=d.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),d=br(d)),h){let m=h({vertexShader:r,fragmentShader:d});r=m.vertexShader,d=m.fragmentShader}if(f){let m=[];d=d.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,g=>(m.push(g),"")),l=`${f}
${m.join(`
`)}
${l}`}if(p){const m=`
uniform float ${p};
`;e=m+e,o=m+o}return n&&(r=`vec3 troika_position_${t};
vec3 troika_normal_${t};
vec2 troika_uv_${t};
${r}
`,e=`${e}
void troikaVertexTransform${t}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${n}
}
`,a=`
troika_position_${t} = vec3(position);
troika_normal_${t} = vec3(normal);
troika_uv_${t} = vec2(uv);
troikaVertexTransform${t}(troika_position_${t}, troika_normal_${t}, troika_uv_${t});
${a}
`,r=r.replace(/\b(position|normal|uv)\b/g,(m,g,G,w)=>/\battribute\s+vec[23]\s+$/.test(w.substr(0,G))?g:`troika_${g}_${t}`),c.map&&c.map.channel>0||(r=r.replace(/\bMAP_UV\b/g,`troika_uv_${t}`))),r=en(r,t,e,a,i),d=en(d,t,o,s,l),{vertexShader:r,fragmentShader:d}}function en(c,r,d,u,t){return(u||t||d)&&(c=c.replace(gn,`
${d}
void troikaOrigMain${r}() {`),c+=`
void main() {
  ${u}
  troikaOrigMain${r}();
  ${t}
}`),c}function Ea(c,r){return c==="uniforms"?void 0:typeof r=="function"?r.toString():r}let Aa=0;const tn=new Map;function Ba(c){const r=JSON.stringify(c,Ea);let d=tn.get(r);return d==null&&tn.set(r,d=++Aa),d}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function Ra(){return typeof window>"u"&&(self.window=self),function(c){var r={parse:function(t){var e=r._bin,a=new Uint8Array(t);if(e.readASCII(a,0,4)=="ttcf"){var i=4;e.readUshort(a,i),i+=2,e.readUshort(a,i),i+=2;var n=e.readUint(a,i);i+=4;for(var o=[],s=0;s<n;s++){var l=e.readUint(a,i);i+=4,o.push(r._readFont(a,l))}return o}return[r._readFont(a,0)]},_readFont:function(t,e){var a=r._bin,i=e;a.readFixed(t,e),e+=4;var n=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2;for(var o=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],s={_data:t,_offset:i},l={},f=0;f<n;f++){var h=a.readASCII(t,e,4);e+=4,a.readUint(t,e),e+=4;var p=a.readUint(t,e);e+=4;var m=a.readUint(t,e);e+=4,l[h]={offset:p,length:m}}for(f=0;f<o.length;f++){var g=o[f];l[g]&&(s[g.trim()]=r[g.trim()].parse(t,l[g].offset,l[g].length,s))}return s},_tabOffset:function(t,e,a){for(var i=r._bin,n=i.readUshort(t,a+4),o=a+12,s=0;s<n;s++){var l=i.readASCII(t,o,4);o+=4,i.readUint(t,o),o+=4;var f=i.readUint(t,o);if(o+=4,i.readUint(t,o),o+=4,l==e)return f}return 0}};r._bin={readFixed:function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<8|t[e+3])/65540},readF2dot14:function(t,e){return r._bin.readShort(t,e)/16384},readInt:function(t,e){return r._bin._view(t).getInt32(e)},readInt8:function(t,e){return r._bin._view(t).getInt8(e)},readShort:function(t,e){return r._bin._view(t).getInt16(e)},readUshort:function(t,e){return r._bin._view(t).getUint16(e)},readUshorts:function(t,e,a){for(var i=[],n=0;n<a;n++)i.push(r._bin.readUshort(t,e+2*n));return i},readUint:function(t,e){return r._bin._view(t).getUint32(e)},readUint64:function(t,e){return 4294967296*r._bin.readUint(t,e)+r._bin.readUint(t,e+4)},readASCII:function(t,e,a){for(var i="",n=0;n<a;n++)i+=String.fromCharCode(t[e+n]);return i},readUnicode:function(t,e,a){for(var i="",n=0;n<a;n++){var o=t[e++]<<8|t[e++];i+=String.fromCharCode(o)}return i},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(t,e,a){var i=r._bin._tdec;return i&&e==0&&a==t.length?i.decode(t):r._bin.readASCII(t,e,a)},readBytes:function(t,e,a){for(var i=[],n=0;n<a;n++)i.push(t[e+n]);return i},readASCIIArray:function(t,e,a){for(var i=[],n=0;n<a;n++)i.push(String.fromCharCode(t[e+n]));return i},_view:function(t){return t._dataView||(t._dataView=t.buffer?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(new Uint8Array(t).buffer))}},r._lctf={},r._lctf.parse=function(t,e,a,i,n){var o=r._bin,s={},l=e;o.readFixed(t,e),e+=4;var f=o.readUshort(t,e);e+=2;var h=o.readUshort(t,e);e+=2;var p=o.readUshort(t,e);return e+=2,s.scriptList=r._lctf.readScriptList(t,l+f),s.featureList=r._lctf.readFeatureList(t,l+h),s.lookupList=r._lctf.readLookupList(t,l+p,n),s},r._lctf.readLookupList=function(t,e,a){var i=r._bin,n=e,o=[],s=i.readUshort(t,e);e+=2;for(var l=0;l<s;l++){var f=i.readUshort(t,e);e+=2;var h=r._lctf.readLookupTable(t,n+f,a);o.push(h)}return o},r._lctf.readLookupTable=function(t,e,a){var i=r._bin,n=e,o={tabs:[]};o.ltype=i.readUshort(t,e),e+=2,o.flag=i.readUshort(t,e),e+=2;var s=i.readUshort(t,e);e+=2;for(var l=o.ltype,f=0;f<s;f++){var h=i.readUshort(t,e);e+=2;var p=a(t,l,n+h,o);o.tabs.push(p)}return o},r._lctf.numOfOnes=function(t){for(var e=0,a=0;a<32;a++)t>>>a&1&&e++;return e},r._lctf.readClassDef=function(t,e){var a=r._bin,i=[],n=a.readUshort(t,e);if(e+=2,n==1){var o=a.readUshort(t,e);e+=2;var s=a.readUshort(t,e);e+=2;for(var l=0;l<s;l++)i.push(o+l),i.push(o+l),i.push(a.readUshort(t,e)),e+=2}if(n==2){var f=a.readUshort(t,e);for(e+=2,l=0;l<f;l++)i.push(a.readUshort(t,e)),e+=2,i.push(a.readUshort(t,e)),e+=2,i.push(a.readUshort(t,e)),e+=2}return i},r._lctf.getInterval=function(t,e){for(var a=0;a<t.length;a+=3){var i=t[a],n=t[a+1];if(t[a+2],i<=e&&e<=n)return a}return-1},r._lctf.readCoverage=function(t,e){var a=r._bin,i={};i.fmt=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);return e+=2,i.fmt==1&&(i.tab=a.readUshorts(t,e,n)),i.fmt==2&&(i.tab=a.readUshorts(t,e,3*n)),i},r._lctf.coverageIndex=function(t,e){var a=t.tab;if(t.fmt==1)return a.indexOf(e);if(t.fmt==2){var i=r._lctf.getInterval(a,e);if(i!=-1)return a[i+2]+(e-a[i])}return-1},r._lctf.readFeatureList=function(t,e){var a=r._bin,i=e,n=[],o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var l=a.readASCII(t,e,4);e+=4;var f=a.readUshort(t,e);e+=2;var h=r._lctf.readFeatureTable(t,i+f);h.tag=l.trim(),n.push(h)}return n},r._lctf.readFeatureTable=function(t,e){var a=r._bin,i=e,n={},o=a.readUshort(t,e);e+=2,o>0&&(n.featureParams=i+o);var s=a.readUshort(t,e);e+=2,n.tab=[];for(var l=0;l<s;l++)n.tab.push(a.readUshort(t,e+2*l));return n},r._lctf.readScriptList=function(t,e){var a=r._bin,i=e,n={},o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var l=a.readASCII(t,e,4);e+=4;var f=a.readUshort(t,e);e+=2,n[l.trim()]=r._lctf.readScriptTable(t,i+f)}return n},r._lctf.readScriptTable=function(t,e){var a=r._bin,i=e,n={},o=a.readUshort(t,e);e+=2,o>0&&(n.default=r._lctf.readLangSysTable(t,i+o));var s=a.readUshort(t,e);e+=2;for(var l=0;l<s;l++){var f=a.readASCII(t,e,4);e+=4;var h=a.readUshort(t,e);e+=2,n[f.trim()]=r._lctf.readLangSysTable(t,i+h)}return n},r._lctf.readLangSysTable=function(t,e){var a=r._bin,i={};a.readUshort(t,e),e+=2,i.reqFeature=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);return e+=2,i.features=a.readUshorts(t,e,n),i},r.CFF={},r.CFF.parse=function(t,e,a){var i=r._bin;(t=new Uint8Array(t.buffer,e,a))[e=0],t[++e],t[++e],t[++e],e++;var n=[];e=r.CFF.readIndex(t,e,n);for(var o=[],s=0;s<n.length-1;s++)o.push(i.readASCII(t,e+n[s],n[s+1]-n[s]));e+=n[n.length-1];var l=[];e=r.CFF.readIndex(t,e,l);var f=[];for(s=0;s<l.length-1;s++)f.push(r.CFF.readDict(t,e+l[s],e+l[s+1]));e+=l[l.length-1];var h=f[0],p=[];e=r.CFF.readIndex(t,e,p);var m=[];for(s=0;s<p.length-1;s++)m.push(i.readASCII(t,e+p[s],p[s+1]-p[s]));if(e+=p[p.length-1],r.CFF.readSubrs(t,e,h),h.CharStrings){e=h.CharStrings,p=[],e=r.CFF.readIndex(t,e,p);var g=[];for(s=0;s<p.length-1;s++)g.push(i.readBytes(t,e+p[s],p[s+1]-p[s]));h.CharStrings=g}if(h.ROS){e=h.FDArray;var G=[];for(e=r.CFF.readIndex(t,e,G),h.FDArray=[],s=0;s<G.length-1;s++){var w=r.CFF.readDict(t,e+G[s],e+G[s+1]);r.CFF._readFDict(t,w,m),h.FDArray.push(w)}e+=G[G.length-1],e=h.FDSelect,h.FDSelect=[];var F=t[e];if(e++,F!=3)throw F;var b=i.readUshort(t,e);for(e+=2,s=0;s<b+1;s++)h.FDSelect.push(i.readUshort(t,e),t[e+2]),e+=3}return h.Encoding&&(h.Encoding=r.CFF.readEncoding(t,h.Encoding,h.CharStrings.length)),h.charset&&(h.charset=r.CFF.readCharset(t,h.charset,h.CharStrings.length)),r.CFF._readFDict(t,h,m),h},r.CFF._readFDict=function(t,e,a){var i;for(var n in e.Private&&(i=e.Private[1],e.Private=r.CFF.readDict(t,i,i+e.Private[0]),e.Private.Subrs&&r.CFF.readSubrs(t,i+e.Private.Subrs,e.Private)),e)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(n)!=-1&&(e[n]=a[e[n]-426+35])},r.CFF.readSubrs=function(t,e,a){var i=r._bin,n=[];e=r.CFF.readIndex(t,e,n);var o,s=n.length;o=s<1240?107:s<33900?1131:32768,a.Bias=o,a.Subrs=[];for(var l=0;l<n.length-1;l++)a.Subrs.push(i.readBytes(t,e+n[l],n[l+1]-n[l]))},r.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],r.CFF.glyphByUnicode=function(t,e){for(var a=0;a<t.charset.length;a++)if(t.charset[a]==e)return a;return-1},r.CFF.glyphBySE=function(t,e){return e<0||e>255?-1:r.CFF.glyphByUnicode(t,r.CFF.tableSE[e])},r.CFF.readEncoding=function(t,e,a){r._bin;var i=[".notdef"],n=t[e];if(e++,n!=0)throw"error: unknown encoding format: "+n;var o=t[e];e++;for(var s=0;s<o;s++)i.push(t[e+s]);return i},r.CFF.readCharset=function(t,e,a){var i=r._bin,n=[".notdef"],o=t[e];if(e++,o==0)for(var s=0;s<a;s++){var l=i.readUshort(t,e);e+=2,n.push(l)}else{if(o!=1&&o!=2)throw"error: format: "+o;for(;n.length<a;){l=i.readUshort(t,e),e+=2;var f=0;for(o==1?(f=t[e],e++):(f=i.readUshort(t,e),e+=2),s=0;s<=f;s++)n.push(l),l++}}return n},r.CFF.readIndex=function(t,e,a){var i=r._bin,n=i.readUshort(t,e)+1,o=t[e+=2];if(e++,o==1)for(var s=0;s<n;s++)a.push(t[e+s]);else if(o==2)for(s=0;s<n;s++)a.push(i.readUshort(t,e+2*s));else if(o==3)for(s=0;s<n;s++)a.push(16777215&i.readUint(t,e+3*s-1));else if(n!=1)throw"unsupported offset size: "+o+", count: "+n;return(e+=n*o)-1},r.CFF.getCharString=function(t,e,a){var i=r._bin,n=t[e],o=t[e+1];t[e+2],t[e+3],t[e+4];var s=1,l=null,f=null;n<=20&&(l=n,s=1),n==12&&(l=100*n+o,s=2),21<=n&&n<=27&&(l=n,s=1),n==28&&(f=i.readShort(t,e+1),s=3),29<=n&&n<=31&&(l=n,s=1),32<=n&&n<=246&&(f=n-139,s=1),247<=n&&n<=250&&(f=256*(n-247)+o+108,s=2),251<=n&&n<=254&&(f=256*-(n-251)-o-108,s=2),n==255&&(f=i.readInt(t,e+1)/65535,s=5),a.val=f??"o"+l,a.size=s},r.CFF.readCharString=function(t,e,a){for(var i=e+a,n=r._bin,o=[];e<i;){var s=t[e],l=t[e+1];t[e+2],t[e+3],t[e+4];var f=1,h=null,p=null;s<=20&&(h=s,f=1),s==12&&(h=100*s+l,f=2),s!=19&&s!=20||(h=s,f=2),21<=s&&s<=27&&(h=s,f=1),s==28&&(p=n.readShort(t,e+1),f=3),29<=s&&s<=31&&(h=s,f=1),32<=s&&s<=246&&(p=s-139,f=1),247<=s&&s<=250&&(p=256*(s-247)+l+108,f=2),251<=s&&s<=254&&(p=256*-(s-251)-l-108,f=2),s==255&&(p=n.readInt(t,e+1)/65535,f=5),o.push(p??"o"+h),e+=f}return o},r.CFF.readDict=function(t,e,a){for(var i=r._bin,n={},o=[];e<a;){var s=t[e],l=t[e+1];t[e+2],t[e+3],t[e+4];var f=1,h=null,p=null;if(s==28&&(p=i.readShort(t,e+1),f=3),s==29&&(p=i.readInt(t,e+1),f=5),32<=s&&s<=246&&(p=s-139,f=1),247<=s&&s<=250&&(p=256*(s-247)+l+108,f=2),251<=s&&s<=254&&(p=256*-(s-251)-l-108,f=2),s==255)throw p=i.readInt(t,e+1)/65535,f=5,"unknown number";if(s==30){var m=[];for(f=1;;){var g=t[e+f];f++;var G=g>>4,w=15&g;if(G!=15&&m.push(G),w!=15&&m.push(w),w==15)break}for(var F="",b=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],U=0;U<m.length;U++)F+=b[m[U]];p=parseFloat(F)}s<=21&&(h=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],f=1,s==12&&(h=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][l],f=2)),h!=null?(n[h]=o.length==1?o[0]:o,o=[]):o.push(p),e+=f}return n},r.cmap={},r.cmap.parse=function(t,e,a){t=new Uint8Array(t.buffer,e,a),e=0;var i=r._bin,n={};i.readUshort(t,e),e+=2;var o=i.readUshort(t,e);e+=2;var s=[];n.tables=[];for(var l=0;l<o;l++){var f=i.readUshort(t,e);e+=2;var h=i.readUshort(t,e);e+=2;var p=i.readUint(t,e);e+=4;var m="p"+f+"e"+h,g=s.indexOf(p);if(g==-1){var G;g=n.tables.length,s.push(p);var w=i.readUshort(t,p);w==0?G=r.cmap.parse0(t,p):w==4?G=r.cmap.parse4(t,p):w==6?G=r.cmap.parse6(t,p):w==12?G=r.cmap.parse12(t,p):console.debug("unknown format: "+w,f,h,p),n.tables.push(G)}if(n[m]!=null)throw"multiple tables for one platform+encoding";n[m]=g}return n},r.cmap.parse0=function(t,e){var a=r._bin,i={};i.format=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,i.map=[];for(var o=0;o<n-6;o++)i.map.push(t[e+o]);return i},r.cmap.parse4=function(t,e){var a=r._bin,i=e,n={};n.format=a.readUshort(t,e),e+=2;var o=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2;var s=a.readUshort(t,e);e+=2;var l=s/2;n.searchRange=a.readUshort(t,e),e+=2,n.entrySelector=a.readUshort(t,e),e+=2,n.rangeShift=a.readUshort(t,e),e+=2,n.endCount=a.readUshorts(t,e,l),e+=2*l,e+=2,n.startCount=a.readUshorts(t,e,l),e+=2*l,n.idDelta=[];for(var f=0;f<l;f++)n.idDelta.push(a.readShort(t,e)),e+=2;for(n.idRangeOffset=a.readUshorts(t,e,l),e+=2*l,n.glyphIdArray=[];e<i+o;)n.glyphIdArray.push(a.readUshort(t,e)),e+=2;return n},r.cmap.parse6=function(t,e){var a=r._bin,i={};i.format=a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,i.firstCode=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2,i.glyphIdArray=[];for(var o=0;o<n;o++)i.glyphIdArray.push(a.readUshort(t,e)),e+=2;return i},r.cmap.parse12=function(t,e){var a=r._bin,i={};i.format=a.readUshort(t,e),e+=2,e+=2,a.readUint(t,e),e+=4,a.readUint(t,e),e+=4;var n=a.readUint(t,e);e+=4,i.groups=[];for(var o=0;o<n;o++){var s=e+12*o,l=a.readUint(t,s+0),f=a.readUint(t,s+4),h=a.readUint(t,s+8);i.groups.push([l,f,h])}return i},r.glyf={},r.glyf.parse=function(t,e,a,i){for(var n=[],o=0;o<i.maxp.numGlyphs;o++)n.push(null);return n},r.glyf._parseGlyf=function(t,e){var a=r._bin,i=t._data,n=r._tabOffset(i,"glyf",t._offset)+t.loca[e];if(t.loca[e]==t.loca[e+1])return null;var o={};if(o.noc=a.readShort(i,n),n+=2,o.xMin=a.readShort(i,n),n+=2,o.yMin=a.readShort(i,n),n+=2,o.xMax=a.readShort(i,n),n+=2,o.yMax=a.readShort(i,n),n+=2,o.xMin>=o.xMax||o.yMin>=o.yMax)return null;if(o.noc>0){o.endPts=[];for(var s=0;s<o.noc;s++)o.endPts.push(a.readUshort(i,n)),n+=2;var l=a.readUshort(i,n);if(n+=2,i.length-n<l)return null;o.instructions=a.readBytes(i,n,l),n+=l;var f=o.endPts[o.noc-1]+1;for(o.flags=[],s=0;s<f;s++){var h=i[n];if(n++,o.flags.push(h),(8&h)!=0){var p=i[n];n++;for(var m=0;m<p;m++)o.flags.push(h),s++}}for(o.xs=[],s=0;s<f;s++){var g=(2&o.flags[s])!=0,G=(16&o.flags[s])!=0;g?(o.xs.push(G?i[n]:-i[n]),n++):G?o.xs.push(0):(o.xs.push(a.readShort(i,n)),n+=2)}for(o.ys=[],s=0;s<f;s++)g=(4&o.flags[s])!=0,G=(32&o.flags[s])!=0,g?(o.ys.push(G?i[n]:-i[n]),n++):G?o.ys.push(0):(o.ys.push(a.readShort(i,n)),n+=2);var w=0,F=0;for(s=0;s<f;s++)w+=o.xs[s],F+=o.ys[s],o.xs[s]=w,o.ys[s]=F}else{var b;o.parts=[];do{b=a.readUshort(i,n),n+=2;var U={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(o.parts.push(U),U.glyphIndex=a.readUshort(i,n),n+=2,1&b){var R=a.readShort(i,n);n+=2;var S=a.readShort(i,n);n+=2}else R=a.readInt8(i,n),n++,S=a.readInt8(i,n),n++;2&b?(U.m.tx=R,U.m.ty=S):(U.p1=R,U.p2=S),8&b?(U.m.a=U.m.d=a.readF2dot14(i,n),n+=2):64&b?(U.m.a=a.readF2dot14(i,n),n+=2,U.m.d=a.readF2dot14(i,n),n+=2):128&b&&(U.m.a=a.readF2dot14(i,n),n+=2,U.m.b=a.readF2dot14(i,n),n+=2,U.m.c=a.readF2dot14(i,n),n+=2,U.m.d=a.readF2dot14(i,n),n+=2)}while(32&b);if(256&b){var D=a.readUshort(i,n);for(n+=2,o.instr=[],s=0;s<D;s++)o.instr.push(i[n]),n++}}return o},r.GDEF={},r.GDEF.parse=function(t,e,a,i){var n=e;e+=4;var o=r._bin.readUshort(t,e);return{glyphClassDef:o===0?null:r._lctf.readClassDef(t,n+o)}},r.GPOS={},r.GPOS.parse=function(t,e,a,i){return r._lctf.parse(t,e,a,i,r.GPOS.subt)},r.GPOS.subt=function(t,e,a,i){var n=r._bin,o=a,s={};if(s.fmt=n.readUshort(t,a),a+=2,e==1||e==2||e==3||e==7||e==8&&s.fmt<=2){var l=n.readUshort(t,a);a+=2,s.coverage=r._lctf.readCoverage(t,l+o)}if(e==1&&s.fmt==1){var f=n.readUshort(t,a);a+=2,f!=0&&(s.pos=r.GPOS.readValueRecord(t,a,f))}else if(e==2&&s.fmt>=1&&s.fmt<=2){f=n.readUshort(t,a),a+=2;var h=n.readUshort(t,a);a+=2;var p=r._lctf.numOfOnes(f),m=r._lctf.numOfOnes(h);if(s.fmt==1){s.pairsets=[];var g=n.readUshort(t,a);a+=2;for(var G=0;G<g;G++){var w=o+n.readUshort(t,a);a+=2;var F=n.readUshort(t,w);w+=2;for(var b=[],U=0;U<F;U++){var R=n.readUshort(t,w);w+=2,f!=0&&(y=r.GPOS.readValueRecord(t,w,f),w+=2*p),h!=0&&(C=r.GPOS.readValueRecord(t,w,h),w+=2*m),b.push({gid2:R,val1:y,val2:C})}s.pairsets.push(b)}}if(s.fmt==2){var S=n.readUshort(t,a);a+=2;var D=n.readUshort(t,a);a+=2;var P=n.readUshort(t,a);a+=2;var E=n.readUshort(t,a);for(a+=2,s.classDef1=r._lctf.readClassDef(t,o+S),s.classDef2=r._lctf.readClassDef(t,o+D),s.matrix=[],G=0;G<P;G++){var Y=[];for(U=0;U<E;U++){var y=null,C=null;f!=0&&(y=r.GPOS.readValueRecord(t,a,f),a+=2*p),h!=0&&(C=r.GPOS.readValueRecord(t,a,h),a+=2*m),Y.push({val1:y,val2:C})}s.matrix.push(Y)}}}else if(e==4&&s.fmt==1)s.markCoverage=r._lctf.readCoverage(t,n.readUshort(t,a)+o),s.baseCoverage=r._lctf.readCoverage(t,n.readUshort(t,a+2)+o),s.markClassCount=n.readUshort(t,a+4),s.markArray=r.GPOS.readMarkArray(t,n.readUshort(t,a+6)+o),s.baseArray=r.GPOS.readBaseArray(t,n.readUshort(t,a+8)+o,s.markClassCount);else if(e==6&&s.fmt==1)s.mark1Coverage=r._lctf.readCoverage(t,n.readUshort(t,a)+o),s.mark2Coverage=r._lctf.readCoverage(t,n.readUshort(t,a+2)+o),s.markClassCount=n.readUshort(t,a+4),s.mark1Array=r.GPOS.readMarkArray(t,n.readUshort(t,a+6)+o),s.mark2Array=r.GPOS.readBaseArray(t,n.readUshort(t,a+8)+o,s.markClassCount);else{if(e==9&&s.fmt==1){var k=n.readUshort(t,a);a+=2;var W=n.readUint(t,a);if(a+=4,i.ltype==9)i.ltype=k;else if(i.ltype!=k)throw"invalid extension substitution";return r.GPOS.subt(t,i.ltype,o+W)}console.debug("unsupported GPOS table LookupType",e,"format",s.fmt)}return s},r.GPOS.readValueRecord=function(t,e,a){var i=r._bin,n=[];return n.push(1&a?i.readShort(t,e):0),e+=1&a?2:0,n.push(2&a?i.readShort(t,e):0),e+=2&a?2:0,n.push(4&a?i.readShort(t,e):0),e+=4&a?2:0,n.push(8&a?i.readShort(t,e):0),e+=8&a?2:0,n},r.GPOS.readBaseArray=function(t,e,a){var i=r._bin,n=[],o=e,s=i.readUshort(t,e);e+=2;for(var l=0;l<s;l++){for(var f=[],h=0;h<a;h++)f.push(r.GPOS.readAnchorRecord(t,o+i.readUshort(t,e))),e+=2;n.push(f)}return n},r.GPOS.readMarkArray=function(t,e){var a=r._bin,i=[],n=e,o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var l=r.GPOS.readAnchorRecord(t,a.readUshort(t,e+2)+n);l.markClass=a.readUshort(t,e),i.push(l),e+=4}return i},r.GPOS.readAnchorRecord=function(t,e){var a=r._bin,i={};return i.fmt=a.readUshort(t,e),i.x=a.readShort(t,e+2),i.y=a.readShort(t,e+4),i},r.GSUB={},r.GSUB.parse=function(t,e,a,i){return r._lctf.parse(t,e,a,i,r.GSUB.subt)},r.GSUB.subt=function(t,e,a,i){var n=r._bin,o=a,s={};if(s.fmt=n.readUshort(t,a),a+=2,e!=1&&e!=2&&e!=4&&e!=5&&e!=6)return null;if(e==1||e==2||e==4||e==5&&s.fmt<=2||e==6&&s.fmt<=2){var l=n.readUshort(t,a);a+=2,s.coverage=r._lctf.readCoverage(t,o+l)}if(e==1&&s.fmt>=1&&s.fmt<=2){if(s.fmt==1)s.delta=n.readShort(t,a),a+=2;else if(s.fmt==2){var f=n.readUshort(t,a);a+=2,s.newg=n.readUshorts(t,a,f),a+=2*s.newg.length}}else if(e==2&&s.fmt==1){f=n.readUshort(t,a),a+=2,s.seqs=[];for(var h=0;h<f;h++){var p=n.readUshort(t,a)+o;a+=2;var m=n.readUshort(t,p);s.seqs.push(n.readUshorts(t,p+2,m))}}else if(e==4)for(s.vals=[],f=n.readUshort(t,a),a+=2,h=0;h<f;h++){var g=n.readUshort(t,a);a+=2,s.vals.push(r.GSUB.readLigatureSet(t,o+g))}else if(e==5&&s.fmt==2){if(s.fmt==2){var G=n.readUshort(t,a);a+=2,s.cDef=r._lctf.readClassDef(t,o+G),s.scset=[];var w=n.readUshort(t,a);for(a+=2,h=0;h<w;h++){var F=n.readUshort(t,a);a+=2,s.scset.push(F==0?null:r.GSUB.readSubClassSet(t,o+F))}}}else if(e==6&&s.fmt==3){if(s.fmt==3){for(h=0;h<3;h++){f=n.readUshort(t,a),a+=2;for(var b=[],U=0;U<f;U++)b.push(r._lctf.readCoverage(t,o+n.readUshort(t,a+2*U)));a+=2*f,h==0&&(s.backCvg=b),h==1&&(s.inptCvg=b),h==2&&(s.ahedCvg=b)}f=n.readUshort(t,a),a+=2,s.lookupRec=r.GSUB.readSubstLookupRecords(t,a,f)}}else{if(e==7&&s.fmt==1){var R=n.readUshort(t,a);a+=2;var S=n.readUint(t,a);if(a+=4,i.ltype==9)i.ltype=R;else if(i.ltype!=R)throw"invalid extension substitution";return r.GSUB.subt(t,i.ltype,o+S)}console.debug("unsupported GSUB table LookupType",e,"format",s.fmt)}return s},r.GSUB.readSubClassSet=function(t,e){var a=r._bin.readUshort,i=e,n=[],o=a(t,e);e+=2;for(var s=0;s<o;s++){var l=a(t,e);e+=2,n.push(r.GSUB.readSubClassRule(t,i+l))}return n},r.GSUB.readSubClassRule=function(t,e){var a=r._bin.readUshort,i={},n=a(t,e),o=a(t,e+=2);e+=2,i.input=[];for(var s=0;s<n-1;s++)i.input.push(a(t,e)),e+=2;return i.substLookupRecords=r.GSUB.readSubstLookupRecords(t,e,o),i},r.GSUB.readSubstLookupRecords=function(t,e,a){for(var i=r._bin.readUshort,n=[],o=0;o<a;o++)n.push(i(t,e),i(t,e+2)),e+=4;return n},r.GSUB.readChainSubClassSet=function(t,e){var a=r._bin,i=e,n=[],o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var l=a.readUshort(t,e);e+=2,n.push(r.GSUB.readChainSubClassRule(t,i+l))}return n},r.GSUB.readChainSubClassRule=function(t,e){for(var a=r._bin,i={},n=["backtrack","input","lookahead"],o=0;o<n.length;o++){var s=a.readUshort(t,e);e+=2,o==1&&s--,i[n[o]]=a.readUshorts(t,e,s),e+=2*i[n[o]].length}return s=a.readUshort(t,e),e+=2,i.subst=a.readUshorts(t,e,2*s),e+=2*i.subst.length,i},r.GSUB.readLigatureSet=function(t,e){var a=r._bin,i=e,n=[],o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var l=a.readUshort(t,e);e+=2,n.push(r.GSUB.readLigature(t,i+l))}return n},r.GSUB.readLigature=function(t,e){var a=r._bin,i={chain:[]};i.nglyph=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2;for(var o=0;o<n-1;o++)i.chain.push(a.readUshort(t,e)),e+=2;return i},r.head={},r.head.parse=function(t,e,a){var i=r._bin,n={};return i.readFixed(t,e),e+=4,n.fontRevision=i.readFixed(t,e),e+=4,i.readUint(t,e),e+=4,i.readUint(t,e),e+=4,n.flags=i.readUshort(t,e),e+=2,n.unitsPerEm=i.readUshort(t,e),e+=2,n.created=i.readUint64(t,e),e+=8,n.modified=i.readUint64(t,e),e+=8,n.xMin=i.readShort(t,e),e+=2,n.yMin=i.readShort(t,e),e+=2,n.xMax=i.readShort(t,e),e+=2,n.yMax=i.readShort(t,e),e+=2,n.macStyle=i.readUshort(t,e),e+=2,n.lowestRecPPEM=i.readUshort(t,e),e+=2,n.fontDirectionHint=i.readShort(t,e),e+=2,n.indexToLocFormat=i.readShort(t,e),e+=2,n.glyphDataFormat=i.readShort(t,e),e+=2,n},r.hhea={},r.hhea.parse=function(t,e,a){var i=r._bin,n={};return i.readFixed(t,e),e+=4,n.ascender=i.readShort(t,e),e+=2,n.descender=i.readShort(t,e),e+=2,n.lineGap=i.readShort(t,e),e+=2,n.advanceWidthMax=i.readUshort(t,e),e+=2,n.minLeftSideBearing=i.readShort(t,e),e+=2,n.minRightSideBearing=i.readShort(t,e),e+=2,n.xMaxExtent=i.readShort(t,e),e+=2,n.caretSlopeRise=i.readShort(t,e),e+=2,n.caretSlopeRun=i.readShort(t,e),e+=2,n.caretOffset=i.readShort(t,e),e+=2,e+=8,n.metricDataFormat=i.readShort(t,e),e+=2,n.numberOfHMetrics=i.readUshort(t,e),e+=2,n},r.hmtx={},r.hmtx.parse=function(t,e,a,i){for(var n=r._bin,o={aWidth:[],lsBearing:[]},s=0,l=0,f=0;f<i.maxp.numGlyphs;f++)f<i.hhea.numberOfHMetrics&&(s=n.readUshort(t,e),e+=2,l=n.readShort(t,e),e+=2),o.aWidth.push(s),o.lsBearing.push(l);return o},r.kern={},r.kern.parse=function(t,e,a,i){var n=r._bin,o=n.readUshort(t,e);if(e+=2,o==1)return r.kern.parseV1(t,e-2,a,i);var s=n.readUshort(t,e);e+=2;for(var l={glyph1:[],rval:[]},f=0;f<s;f++){e+=2,a=n.readUshort(t,e),e+=2;var h=n.readUshort(t,e);e+=2;var p=h>>>8;if((p&=15)!=0)throw"unknown kern table format: "+p;e=r.kern.readFormat0(t,e,l)}return l},r.kern.parseV1=function(t,e,a,i){var n=r._bin;n.readFixed(t,e),e+=4;var o=n.readUint(t,e);e+=4;for(var s={glyph1:[],rval:[]},l=0;l<o;l++){n.readUint(t,e),e+=4;var f=n.readUshort(t,e);e+=2,n.readUshort(t,e),e+=2;var h=f>>>8;if((h&=15)!=0)throw"unknown kern table format: "+h;e=r.kern.readFormat0(t,e,s)}return s},r.kern.readFormat0=function(t,e,a){var i=r._bin,n=-1,o=i.readUshort(t,e);e+=2,i.readUshort(t,e),e+=2,i.readUshort(t,e),e+=2,i.readUshort(t,e),e+=2;for(var s=0;s<o;s++){var l=i.readUshort(t,e);e+=2;var f=i.readUshort(t,e);e+=2;var h=i.readShort(t,e);e+=2,l!=n&&(a.glyph1.push(l),a.rval.push({glyph2:[],vals:[]}));var p=a.rval[a.rval.length-1];p.glyph2.push(f),p.vals.push(h),n=l}return e},r.loca={},r.loca.parse=function(t,e,a,i){var n=r._bin,o=[],s=i.head.indexToLocFormat,l=i.maxp.numGlyphs+1;if(s==0)for(var f=0;f<l;f++)o.push(n.readUshort(t,e+(f<<1))<<1);if(s==1)for(f=0;f<l;f++)o.push(n.readUint(t,e+(f<<2)));return o},r.maxp={},r.maxp.parse=function(t,e,a){var i=r._bin,n={},o=i.readUint(t,e);return e+=4,n.numGlyphs=i.readUshort(t,e),e+=2,o==65536&&(n.maxPoints=i.readUshort(t,e),e+=2,n.maxContours=i.readUshort(t,e),e+=2,n.maxCompositePoints=i.readUshort(t,e),e+=2,n.maxCompositeContours=i.readUshort(t,e),e+=2,n.maxZones=i.readUshort(t,e),e+=2,n.maxTwilightPoints=i.readUshort(t,e),e+=2,n.maxStorage=i.readUshort(t,e),e+=2,n.maxFunctionDefs=i.readUshort(t,e),e+=2,n.maxInstructionDefs=i.readUshort(t,e),e+=2,n.maxStackElements=i.readUshort(t,e),e+=2,n.maxSizeOfInstructions=i.readUshort(t,e),e+=2,n.maxComponentElements=i.readUshort(t,e),e+=2,n.maxComponentDepth=i.readUshort(t,e),e+=2),n},r.name={},r.name.parse=function(t,e,a){var i=r._bin,n={};i.readUshort(t,e),e+=2;var o=i.readUshort(t,e);e+=2,i.readUshort(t,e);for(var s,l=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],f=e+=2,h=0;h<o;h++){var p=i.readUshort(t,e);e+=2;var m=i.readUshort(t,e);e+=2;var g=i.readUshort(t,e);e+=2;var G=i.readUshort(t,e);e+=2;var w=i.readUshort(t,e);e+=2;var F=i.readUshort(t,e);e+=2;var b,U=l[G],R=f+12*o+F;if(p==0)b=i.readUnicode(t,R,w/2);else if(p==3&&m==0)b=i.readUnicode(t,R,w/2);else if(m==0)b=i.readASCII(t,R,w);else if(m==1)b=i.readUnicode(t,R,w/2);else if(m==3)b=i.readUnicode(t,R,w/2);else{if(p!=1)throw"unknown encoding "+m+", platformID: "+p;b=i.readASCII(t,R,w),console.debug("reading unknown MAC encoding "+m+" as ASCII")}var S="p"+p+","+g.toString(16);n[S]==null&&(n[S]={}),n[S][U!==void 0?U:G]=b,n[S]._lang=g}for(var D in n)if(n[D].postScriptName!=null&&n[D]._lang==1033)return n[D];for(var D in n)if(n[D].postScriptName!=null&&n[D]._lang==0)return n[D];for(var D in n)if(n[D].postScriptName!=null&&n[D]._lang==3084)return n[D];for(var D in n)if(n[D].postScriptName!=null)return n[D];for(var D in n){s=D;break}return console.debug("returning name table with languageID "+n[s]._lang),n[s]},r["OS/2"]={},r["OS/2"].parse=function(t,e,a){var i=r._bin.readUshort(t,e);e+=2;var n={};if(i==0)r["OS/2"].version0(t,e,n);else if(i==1)r["OS/2"].version1(t,e,n);else if(i==2||i==3||i==4)r["OS/2"].version2(t,e,n);else{if(i!=5)throw"unknown OS/2 table version: "+i;r["OS/2"].version5(t,e,n)}return n},r["OS/2"].version0=function(t,e,a){var i=r._bin;return a.xAvgCharWidth=i.readShort(t,e),e+=2,a.usWeightClass=i.readUshort(t,e),e+=2,a.usWidthClass=i.readUshort(t,e),e+=2,a.fsType=i.readUshort(t,e),e+=2,a.ySubscriptXSize=i.readShort(t,e),e+=2,a.ySubscriptYSize=i.readShort(t,e),e+=2,a.ySubscriptXOffset=i.readShort(t,e),e+=2,a.ySubscriptYOffset=i.readShort(t,e),e+=2,a.ySuperscriptXSize=i.readShort(t,e),e+=2,a.ySuperscriptYSize=i.readShort(t,e),e+=2,a.ySuperscriptXOffset=i.readShort(t,e),e+=2,a.ySuperscriptYOffset=i.readShort(t,e),e+=2,a.yStrikeoutSize=i.readShort(t,e),e+=2,a.yStrikeoutPosition=i.readShort(t,e),e+=2,a.sFamilyClass=i.readShort(t,e),e+=2,a.panose=i.readBytes(t,e,10),e+=10,a.ulUnicodeRange1=i.readUint(t,e),e+=4,a.ulUnicodeRange2=i.readUint(t,e),e+=4,a.ulUnicodeRange3=i.readUint(t,e),e+=4,a.ulUnicodeRange4=i.readUint(t,e),e+=4,a.achVendID=[i.readInt8(t,e),i.readInt8(t,e+1),i.readInt8(t,e+2),i.readInt8(t,e+3)],e+=4,a.fsSelection=i.readUshort(t,e),e+=2,a.usFirstCharIndex=i.readUshort(t,e),e+=2,a.usLastCharIndex=i.readUshort(t,e),e+=2,a.sTypoAscender=i.readShort(t,e),e+=2,a.sTypoDescender=i.readShort(t,e),e+=2,a.sTypoLineGap=i.readShort(t,e),e+=2,a.usWinAscent=i.readUshort(t,e),e+=2,a.usWinDescent=i.readUshort(t,e),e+=2},r["OS/2"].version1=function(t,e,a){var i=r._bin;return e=r["OS/2"].version0(t,e,a),a.ulCodePageRange1=i.readUint(t,e),e+=4,a.ulCodePageRange2=i.readUint(t,e),e+=4},r["OS/2"].version2=function(t,e,a){var i=r._bin;return e=r["OS/2"].version1(t,e,a),a.sxHeight=i.readShort(t,e),e+=2,a.sCapHeight=i.readShort(t,e),e+=2,a.usDefault=i.readUshort(t,e),e+=2,a.usBreak=i.readUshort(t,e),e+=2,a.usMaxContext=i.readUshort(t,e),e+=2},r["OS/2"].version5=function(t,e,a){var i=r._bin;return e=r["OS/2"].version2(t,e,a),a.usLowerOpticalPointSize=i.readUshort(t,e),e+=2,a.usUpperOpticalPointSize=i.readUshort(t,e),e+=2},r.post={},r.post.parse=function(t,e,a){var i=r._bin,n={};return n.version=i.readFixed(t,e),e+=4,n.italicAngle=i.readFixed(t,e),e+=4,n.underlinePosition=i.readShort(t,e),e+=2,n.underlineThickness=i.readShort(t,e),e+=2,n},r==null&&(r={}),r.U==null&&(r.U={}),r.U.codeToGlyph=function(t,e){var a=t.cmap,i=-1;if(a.p0e4!=null?i=a.p0e4:a.p3e1!=null?i=a.p3e1:a.p1e0!=null?i=a.p1e0:a.p0e3!=null&&(i=a.p0e3),i==-1)throw"no familiar platform and encoding!";var n=a.tables[i];if(n.format==0)return e>=n.map.length?0:n.map[e];if(n.format==4){for(var o=-1,s=0;s<n.endCount.length;s++)if(e<=n.endCount[s]){o=s;break}return o==-1||n.startCount[o]>e?0:65535&(n.idRangeOffset[o]!=0?n.glyphIdArray[e-n.startCount[o]+(n.idRangeOffset[o]>>1)-(n.idRangeOffset.length-o)]:e+n.idDelta[o])}if(n.format==12){if(e>n.groups[n.groups.length-1][1])return 0;for(s=0;s<n.groups.length;s++){var l=n.groups[s];if(l[0]<=e&&e<=l[1])return l[2]+(e-l[0])}return 0}throw"unknown cmap table format "+n.format},r.U.glyphToPath=function(t,e){var a={cmds:[],crds:[]};if(t.SVG&&t.SVG.entries[e]){var i=t.SVG.entries[e];return i==null?a:(typeof i=="string"&&(i=r.SVG.toPath(i),t.SVG.entries[e]=i),i)}if(t.CFF){var n={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:t.CFF.Private?t.CFF.Private.defaultWidthX:0,open:!1},o=t.CFF,s=t.CFF.Private;if(o.ROS){for(var l=0;o.FDSelect[l+2]<=e;)l+=2;s=o.FDArray[o.FDSelect[l+1]].Private}r.U._drawCFF(t.CFF.CharStrings[e],n,o,s,a)}else t.glyf&&r.U._drawGlyf(e,t,a);return a},r.U._drawGlyf=function(t,e,a){var i=e.glyf[t];i==null&&(i=e.glyf[t]=r.glyf._parseGlyf(e,t)),i!=null&&(i.noc>-1?r.U._simpleGlyph(i,a):r.U._compoGlyph(i,e,a))},r.U._simpleGlyph=function(t,e){for(var a=0;a<t.noc;a++){for(var i=a==0?0:t.endPts[a-1]+1,n=t.endPts[a],o=i;o<=n;o++){var s=o==i?n:o-1,l=o==n?i:o+1,f=1&t.flags[o],h=1&t.flags[s],p=1&t.flags[l],m=t.xs[o],g=t.ys[o];if(o==i)if(f){if(!h){r.U.P.moveTo(e,m,g);continue}r.U.P.moveTo(e,t.xs[s],t.ys[s])}else h?r.U.P.moveTo(e,t.xs[s],t.ys[s]):r.U.P.moveTo(e,(t.xs[s]+m)/2,(t.ys[s]+g)/2);f?h&&r.U.P.lineTo(e,m,g):p?r.U.P.qcurveTo(e,m,g,t.xs[l],t.ys[l]):r.U.P.qcurveTo(e,m,g,(m+t.xs[l])/2,(g+t.ys[l])/2)}r.U.P.closePath(e)}},r.U._compoGlyph=function(t,e,a){for(var i=0;i<t.parts.length;i++){var n={cmds:[],crds:[]},o=t.parts[i];r.U._drawGlyf(o.glyphIndex,e,n);for(var s=o.m,l=0;l<n.crds.length;l+=2){var f=n.crds[l],h=n.crds[l+1];a.crds.push(f*s.a+h*s.b+s.tx),a.crds.push(f*s.c+h*s.d+s.ty)}for(l=0;l<n.cmds.length;l++)a.cmds.push(n.cmds[l])}},r.U._getGlyphClass=function(t,e){var a=r._lctf.getInterval(e,t);return a==-1?0:e[a+2]},r.U._applySubs=function(t,e,a,i){for(var n=t.length-e-1,o=0;o<a.tabs.length;o++)if(a.tabs[o]!=null){var s,l=a.tabs[o];if(!l.coverage||(s=r._lctf.coverageIndex(l.coverage,t[e]))!=-1){if(a.ltype==1)t[e],l.fmt==1?t[e]=t[e]+l.delta:t[e]=l.newg[s];else if(a.ltype==4)for(var f=l.vals[s],h=0;h<f.length;h++){var p=f[h],m=p.chain.length;if(!(m>n)){for(var g=!0,G=0,w=0;w<m;w++){for(;t[e+G+(1+w)]==-1;)G++;p.chain[w]!=t[e+G+(1+w)]&&(g=!1)}if(g){for(t[e]=p.nglyph,w=0;w<m+G;w++)t[e+w+1]=-1;break}}}else if(a.ltype==5&&l.fmt==2)for(var F=r._lctf.getInterval(l.cDef,t[e]),b=l.cDef[F+2],U=l.scset[b],R=0;R<U.length;R++){var S=U[R],D=S.input;if(!(D.length>n)){for(g=!0,w=0;w<D.length;w++){var P=r._lctf.getInterval(l.cDef,t[e+1+w]);if(F==-1&&l.cDef[P+2]!=D[w]){g=!1;break}}if(g){var E=S.substLookupRecords;for(h=0;h<E.length;h+=2)E[h],E[h+1]}}}else if(a.ltype==6&&l.fmt==3){if(!r.U._glsCovered(t,l.backCvg,e-l.backCvg.length)||!r.U._glsCovered(t,l.inptCvg,e)||!r.U._glsCovered(t,l.ahedCvg,e+l.inptCvg.length))continue;var Y=l.lookupRec;for(R=0;R<Y.length;R+=2){F=Y[R];var y=i[Y[R+1]];r.U._applySubs(t,e+F,y,i)}}}}},r.U._glsCovered=function(t,e,a){for(var i=0;i<e.length;i++)if(r._lctf.coverageIndex(e[i],t[a+i])==-1)return!1;return!0},r.U.glyphsToPath=function(t,e,a){for(var i={cmds:[],crds:[]},n=0,o=0;o<e.length;o++){var s=e[o];if(s!=-1){for(var l=o<e.length-1&&e[o+1]!=-1?e[o+1]:0,f=r.U.glyphToPath(t,s),h=0;h<f.crds.length;h+=2)i.crds.push(f.crds[h]+n),i.crds.push(f.crds[h+1]);for(a&&i.cmds.push(a),h=0;h<f.cmds.length;h++)i.cmds.push(f.cmds[h]);a&&i.cmds.push("X"),n+=t.hmtx.aWidth[s],o<e.length-1&&(n+=r.U.getPairAdjustment(t,s,l))}}return i},r.U.P={},r.U.P.moveTo=function(t,e,a){t.cmds.push("M"),t.crds.push(e,a)},r.U.P.lineTo=function(t,e,a){t.cmds.push("L"),t.crds.push(e,a)},r.U.P.curveTo=function(t,e,a,i,n,o,s){t.cmds.push("C"),t.crds.push(e,a,i,n,o,s)},r.U.P.qcurveTo=function(t,e,a,i,n){t.cmds.push("Q"),t.crds.push(e,a,i,n)},r.U.P.closePath=function(t){t.cmds.push("Z")},r.U._drawCFF=function(t,e,a,i,n){for(var o=e.stack,s=e.nStems,l=e.haveWidth,f=e.width,h=e.open,p=0,m=e.x,g=e.y,G=0,w=0,F=0,b=0,U=0,R=0,S=0,D=0,P=0,E=0,Y={val:0,size:0};p<t.length;){r.CFF.getCharString(t,p,Y);var y=Y.val;if(p+=Y.size,y=="o1"||y=="o18")o.length%2!=0&&!l&&(f=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,l=!0;else if(y=="o3"||y=="o23")o.length%2!=0&&!l&&(f=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,l=!0;else if(y=="o4")o.length>1&&!l&&(f=o.shift()+i.nominalWidthX,l=!0),h&&r.U.P.closePath(n),g+=o.pop(),r.U.P.moveTo(n,m,g),h=!0;else if(y=="o5")for(;o.length>0;)m+=o.shift(),g+=o.shift(),r.U.P.lineTo(n,m,g);else if(y=="o6"||y=="o7")for(var C=o.length,k=y=="o6",W=0;W<C;W++){var z=o.shift();k?m+=z:g+=z,k=!k,r.U.P.lineTo(n,m,g)}else if(y=="o8"||y=="o24"){C=o.length;for(var Q=0;Q+6<=C;)G=m+o.shift(),w=g+o.shift(),F=G+o.shift(),b=w+o.shift(),m=F+o.shift(),g=b+o.shift(),r.U.P.curveTo(n,G,w,F,b,m,g),Q+=6;y=="o24"&&(m+=o.shift(),g+=o.shift(),r.U.P.lineTo(n,m,g))}else{if(y=="o11")break;if(y=="o1234"||y=="o1235"||y=="o1236"||y=="o1237")y=="o1234"&&(w=g,F=(G=m+o.shift())+o.shift(),E=b=w+o.shift(),R=b,D=g,m=(S=(U=(P=F+o.shift())+o.shift())+o.shift())+o.shift(),r.U.P.curveTo(n,G,w,F,b,P,E),r.U.P.curveTo(n,U,R,S,D,m,g)),y=="o1235"&&(G=m+o.shift(),w=g+o.shift(),F=G+o.shift(),b=w+o.shift(),P=F+o.shift(),E=b+o.shift(),U=P+o.shift(),R=E+o.shift(),S=U+o.shift(),D=R+o.shift(),m=S+o.shift(),g=D+o.shift(),o.shift(),r.U.P.curveTo(n,G,w,F,b,P,E),r.U.P.curveTo(n,U,R,S,D,m,g)),y=="o1236"&&(G=m+o.shift(),w=g+o.shift(),F=G+o.shift(),E=b=w+o.shift(),R=b,S=(U=(P=F+o.shift())+o.shift())+o.shift(),D=R+o.shift(),m=S+o.shift(),r.U.P.curveTo(n,G,w,F,b,P,E),r.U.P.curveTo(n,U,R,S,D,m,g)),y=="o1237"&&(G=m+o.shift(),w=g+o.shift(),F=G+o.shift(),b=w+o.shift(),P=F+o.shift(),E=b+o.shift(),U=P+o.shift(),R=E+o.shift(),S=U+o.shift(),D=R+o.shift(),Math.abs(S-m)>Math.abs(D-g)?m=S+o.shift():g=D+o.shift(),r.U.P.curveTo(n,G,w,F,b,P,E),r.U.P.curveTo(n,U,R,S,D,m,g));else if(y=="o14"){if(o.length>0&&!l&&(f=o.shift()+a.nominalWidthX,l=!0),o.length==4){var ee=o.shift(),O=o.shift(),A=o.shift(),v=o.shift(),x=r.CFF.glyphBySE(a,A),_=r.CFF.glyphBySE(a,v);r.U._drawCFF(a.CharStrings[x],e,a,i,n),e.x=ee,e.y=O,r.U._drawCFF(a.CharStrings[_],e,a,i,n)}h&&(r.U.P.closePath(n),h=!1)}else if(y=="o19"||y=="o20")o.length%2!=0&&!l&&(f=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,l=!0,p+=s+7>>3;else if(y=="o21")o.length>2&&!l&&(f=o.shift()+i.nominalWidthX,l=!0),g+=o.pop(),m+=o.pop(),h&&r.U.P.closePath(n),r.U.P.moveTo(n,m,g),h=!0;else if(y=="o22")o.length>1&&!l&&(f=o.shift()+i.nominalWidthX,l=!0),m+=o.pop(),h&&r.U.P.closePath(n),r.U.P.moveTo(n,m,g),h=!0;else if(y=="o25"){for(;o.length>6;)m+=o.shift(),g+=o.shift(),r.U.P.lineTo(n,m,g);G=m+o.shift(),w=g+o.shift(),F=G+o.shift(),b=w+o.shift(),m=F+o.shift(),g=b+o.shift(),r.U.P.curveTo(n,G,w,F,b,m,g)}else if(y=="o26")for(o.length%2&&(m+=o.shift());o.length>0;)G=m,w=g+o.shift(),m=F=G+o.shift(),g=(b=w+o.shift())+o.shift(),r.U.P.curveTo(n,G,w,F,b,m,g);else if(y=="o27")for(o.length%2&&(g+=o.shift());o.length>0;)w=g,F=(G=m+o.shift())+o.shift(),b=w+o.shift(),m=F+o.shift(),g=b,r.U.P.curveTo(n,G,w,F,b,m,g);else if(y=="o10"||y=="o29"){var M=y=="o10"?i:a;if(o.length==0)console.debug("error: empty stack");else{var T=o.pop(),j=M.Subrs[T+M.Bias];e.x=m,e.y=g,e.nStems=s,e.haveWidth=l,e.width=f,e.open=h,r.U._drawCFF(j,e,a,i,n),m=e.x,g=e.y,s=e.nStems,l=e.haveWidth,f=e.width,h=e.open}}else if(y=="o30"||y=="o31"){var B=o.length,I=(Q=0,y=="o31");for(Q+=B-(C=-3&B);Q<C;)I?(w=g,F=(G=m+o.shift())+o.shift(),g=(b=w+o.shift())+o.shift(),C-Q==5?(m=F+o.shift(),Q++):m=F,I=!1):(G=m,w=g+o.shift(),F=G+o.shift(),b=w+o.shift(),m=F+o.shift(),C-Q==5?(g=b+o.shift(),Q++):g=b,I=!0),r.U.P.curveTo(n,G,w,F,b,m,g),Q+=4}else{if((y+"").charAt(0)=="o")throw console.debug("Unknown operation: "+y,t),y;o.push(y)}}}e.x=m,e.y=g,e.nStems=s,e.haveWidth=l,e.width=f,e.open=h};var d=r,u={Typr:d};return c.Typr=d,c.default=u,Object.defineProperty(c,"__esModule",{value:!0}),c}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function Ga(){return function(c){var r=Uint8Array,d=Uint16Array,u=Uint32Array,t=new r([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e=new r([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new r([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i=function(y,C){for(var k=new d(31),W=0;W<31;++W)k[W]=C+=1<<y[W-1];var z=new u(k[30]);for(W=1;W<30;++W)for(var Q=k[W];Q<k[W+1];++Q)z[Q]=Q-k[W]<<5|W;return[k,z]},n=i(t,2),o=n[0],s=n[1];o[28]=258,s[258]=28;for(var l=i(e,0)[0],f=new d(32768),h=0;h<32768;++h){var p=(43690&h)>>>1|(21845&h)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,f[h]=((65280&p)>>>8|(255&p)<<8)>>>1}var m=function(y,C,k){for(var W=y.length,z=0,Q=new d(C);z<W;++z)++Q[y[z]-1];var ee,O=new d(C);for(z=0;z<C;++z)O[z]=O[z-1]+Q[z-1]<<1;{ee=new d(1<<C);var A=15-C;for(z=0;z<W;++z)if(y[z])for(var v=z<<4|y[z],x=C-y[z],_=O[y[z]-1]++<<x,M=_|(1<<x)-1;_<=M;++_)ee[f[_]>>>A]=v}return ee},g=new r(288);for(h=0;h<144;++h)g[h]=8;for(h=144;h<256;++h)g[h]=9;for(h=256;h<280;++h)g[h]=7;for(h=280;h<288;++h)g[h]=8;var G=new r(32);for(h=0;h<32;++h)G[h]=5;var w=m(g,9),F=m(G,5),b=function(y){for(var C=y[0],k=1;k<y.length;++k)y[k]>C&&(C=y[k]);return C},U=function(y,C,k){var W=C/8|0;return(y[W]|y[W+1]<<8)>>(7&C)&k},R=function(y,C){var k=C/8|0;return(y[k]|y[k+1]<<8|y[k+2]<<16)>>(7&C)},S=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],D=function(y,C,k){var W=new Error(C||S[y]);if(W.code=y,Error.captureStackTrace&&Error.captureStackTrace(W,D),!k)throw W;return W},P=function(y,C,k){var W=y.length;if(!W||k&&!k.l&&W<5)return C||new r(0);var z=!C||k,Q=!k||k.i;k||(k={}),C||(C=new r(3*W));var ee,O=function(fe){var Ce=C.length;if(fe>Ce){var ke=new r(Math.max(2*Ce,fe));ke.set(C),C=ke}},A=k.f||0,v=k.p||0,x=k.b||0,_=k.l,M=k.d,T=k.m,j=k.n,B=8*W;do{if(!_){k.f=A=U(y,v,1);var I=U(y,v+1,3);if(v+=3,!I){var J=y[($=((ee=v)/8|0)+(7&ee&&1)+4)-4]|y[$-3]<<8,te=$+J;if(te>W){Q&&D(0);break}z&&O(x+J),C.set(y.subarray($,te),x),k.b=x+=J,k.p=v=8*te;continue}if(I==1)_=w,M=F,T=9,j=5;else if(I==2){var X=U(y,v,31)+257,N=U(y,v+10,15)+4,me=X+U(y,v+5,31)+1;v+=14;for(var ce=new r(me),q=new r(19),re=0;re<N;++re)q[a[re]]=U(y,v+3*re,7);v+=3*N;var le=b(q),V=(1<<le)-1,ne=m(q,le);for(re=0;re<me;){var $,L=ne[U(y,v,V)];if(v+=15&L,($=L>>>4)<16)ce[re++]=$;else{var de=0,Z=0;for($==16?(Z=3+U(y,v,3),v+=2,de=ce[re-1]):$==17?(Z=3+U(y,v,7),v+=3):$==18&&(Z=11+U(y,v,127),v+=7);Z--;)ce[re++]=de}}var oe=ce.subarray(0,X),K=ce.subarray(X);T=b(oe),j=b(K),_=m(oe,T),M=m(K,j)}else D(1);if(v>B){Q&&D(0);break}}z&&O(x+131072);for(var _e=(1<<T)-1,ae=(1<<j)-1,ie=v;;ie=v){var ue=(de=_[R(y,v)&_e])>>>4;if((v+=15&de)>B){Q&&D(0);break}if(de||D(2),ue<256)C[x++]=ue;else{if(ue==256){ie=v,_=null;break}var ve=ue-254;if(ue>264){var we=t[re=ue-257];ve=U(y,v,(1<<we)-1)+o[re],v+=we}var Me=M[R(y,v)&ae],ge=Me>>>4;if(Me||D(3),v+=15&Me,K=l[ge],ge>3&&(we=e[ge],K+=R(y,v)&(1<<we)-1,v+=we),v>B){Q&&D(0);break}z&&O(x+131072);for(var xe=x+ve;x<xe;x+=4)C[x]=C[x-K],C[x+1]=C[x+1-K],C[x+2]=C[x+2-K],C[x+3]=C[x+3-K];x=xe}}k.l=_,k.p=ie,k.b=x,_&&(A=1,k.m=T,k.d=M,k.n=j)}while(!A);return x==C.length?C:function(fe,Ce,ke){(ke==null||ke>fe.length)&&(ke=fe.length);var Pe=new(fe instanceof d?d:fe instanceof u?u:r)(ke-Ce);return Pe.set(fe.subarray(Ce,ke)),Pe}(C,0,x)},E=new r(0),Y=typeof TextDecoder<"u"&&new TextDecoder;try{Y.decode(E,{stream:!0})}catch{}return c.convert_streams=function(y){var C=new DataView(y),k=0;function W(){var X=C.getUint16(k);return k+=2,X}function z(){var X=C.getUint32(k);return k+=4,X}function Q(X){J.setUint16(te,X),te+=2}function ee(X){J.setUint32(te,X),te+=4}for(var O={signature:z(),flavor:z(),length:z(),numTables:W(),reserved:W(),totalSfntSize:z(),majorVersion:W(),minorVersion:W(),metaOffset:z(),metaLength:z(),metaOrigLength:z(),privOffset:z(),privLength:z()},A=0;Math.pow(2,A)<=O.numTables;)A++;A--;for(var v=16*Math.pow(2,A),x=16*O.numTables-v,_=12,M=[],T=0;T<O.numTables;T++)M.push({tag:z(),offset:z(),compLength:z(),origLength:z(),origChecksum:z()}),_+=16;var j,B=new Uint8Array(12+16*M.length+M.reduce(function(X,N){return X+N.origLength+4},0)),I=B.buffer,J=new DataView(I),te=0;return ee(O.flavor),Q(O.numTables),Q(v),Q(A),Q(x),M.forEach(function(X){ee(X.tag),ee(X.origChecksum),ee(_),ee(X.origLength),X.outOffset=_,(_+=X.origLength)%4!=0&&(_+=4-_%4)}),M.forEach(function(X){var N,me=y.slice(X.offset,X.offset+X.compLength);if(X.compLength!=X.origLength){var ce=new Uint8Array(X.origLength);N=new Uint8Array(me,2),P(N,ce)}else ce=new Uint8Array(me);B.set(ce,X.outOffset);var q=0;(_=X.outOffset+X.origLength)%4!=0&&(q=4-_%4),B.set(new Uint8Array(q).buffer,X.outOffset+X.origLength),j=_+q}),I.slice(0,j)},Object.defineProperty(c,"__esModule",{value:!0}),c}({}).convert_streams}function La(c,r){const d={M:2,L:2,Q:4,C:6,Z:0},u={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},t=1,e=2,a=4,i=8,n=16,o=32;let s;function l(S){if(!s){const D={R:e,L:t,D:a,C:n,U:o,T:i};s=new Map;for(let P in u){let E=0;u[P].split(",").forEach(Y=>{let[y,C]=Y.split("+");y=parseInt(y,36),C=C?parseInt(C,36):0,s.set(E+=y,D[P]);for(let k=C;k--;)s.set(++E,D[P])})}}return s.get(S)||o}const f=1,h=2,p=3,m=4,g=[null,"isol","init","fina","medi"];function G(S){const D=new Uint8Array(S.length);let P=o,E=f,Y=-1;for(let y=0;y<S.length;y++){const C=S.codePointAt(y);let k=l(C)|0,W=f;k&i||(P&(t|a|n)?k&(e|a|n)?(W=p,(E===f||E===p)&&D[Y]++):k&(t|o)&&(E===h||E===m)&&D[Y]--:P&(e|o)&&(E===h||E===m)&&D[Y]--,E=D[y]=W,P=k,Y=y,C>65535&&y++)}return D}function w(S,D){const P=[];for(let Y=0;Y<D.length;Y++){const y=D.codePointAt(Y);y>65535&&Y++,P.push(c.U.codeToGlyph(S,y))}const E=S.GSUB;if(E){const{lookupList:Y,featureList:y}=E;let C;const k=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,W=[];y.forEach(z=>{if(k.test(z.tag))for(let Q=0;Q<z.tab.length;Q++){if(W[z.tab[Q]])continue;W[z.tab[Q]]=!0;const ee=Y[z.tab[Q]],O=/^(isol|init|fina|medi)$/.test(z.tag);O&&!C&&(C=G(D));for(let A=0;A<P.length;A++)(!C||!O||g[C[A]]===z.tag)&&c.U._applySubs(P,A,ee,Y)}})}return P}function F(S,D){const P=new Int16Array(D.length*3);let E=0;for(;E<D.length;E++){const k=D[E];if(k===-1)continue;P[E*3+2]=S.hmtx.aWidth[k];const W=S.GPOS;if(W){const z=W.lookupList;for(let Q=0;Q<z.length;Q++){const ee=z[Q];for(let O=0;O<ee.tabs.length;O++){const A=ee.tabs[O];if(ee.ltype===1){if(c._lctf.coverageIndex(A.coverage,k)!==-1&&A.pos){C(A.pos,E);break}}else if(ee.ltype===2){let v=null,x=Y();if(x!==-1){const _=c._lctf.coverageIndex(A.coverage,D[x]);if(_!==-1){if(A.fmt===1){const M=A.pairsets[_];for(let T=0;T<M.length;T++)M[T].gid2===k&&(v=M[T])}else if(A.fmt===2){const M=c.U._getGlyphClass(D[x],A.classDef1),T=c.U._getGlyphClass(k,A.classDef2);v=A.matrix[M][T]}if(v){v.val1&&C(v.val1,x),v.val2&&C(v.val2,E);break}}}}else if(ee.ltype===4){const v=c._lctf.coverageIndex(A.markCoverage,k);if(v!==-1){const x=Y(y),_=x===-1?-1:c._lctf.coverageIndex(A.baseCoverage,D[x]);if(_!==-1){const M=A.markArray[v],T=A.baseArray[_][M.markClass];P[E*3]=T.x-M.x+P[x*3]-P[x*3+2],P[E*3+1]=T.y-M.y+P[x*3+1];break}}}else if(ee.ltype===6){const v=c._lctf.coverageIndex(A.mark1Coverage,k);if(v!==-1){const x=Y();if(x!==-1){const _=D[x];if(b(S,_)===3){const M=c._lctf.coverageIndex(A.mark2Coverage,_);if(M!==-1){const T=A.mark1Array[v],j=A.mark2Array[M][T.markClass];P[E*3]=j.x-T.x+P[x*3]-P[x*3+2],P[E*3+1]=j.y-T.y+P[x*3+1];break}}}}}}}}else if(S.kern&&!S.cff){const z=Y();if(z!==-1){const Q=S.kern.glyph1.indexOf(D[z]);if(Q!==-1){const ee=S.kern.rval[Q].glyph2.indexOf(k);ee!==-1&&(P[z*3+2]+=S.kern.rval[Q].vals[ee])}}}}return P;function Y(k){for(let W=E-1;W>=0;W--)if(D[W]!==-1&&(!k||k(D[W])))return W;return-1}function y(k){return b(S,k)===1}function C(k,W){for(let z=0;z<3;z++)P[W*3+z]+=k[z]||0}}function b(S,D){const P=S.GDEF&&S.GDEF.glyphClassDef;return P?c.U._getGlyphClass(D,P):0}function U(...S){for(let D=0;D<S.length;D++)if(typeof S[D]=="number")return S[D]}function R(S){const D=Object.create(null),P=S["OS/2"],E=S.hhea,Y=S.head.unitsPerEm,y=U(P&&P.sTypoAscender,E&&E.ascender,Y),C={unitsPerEm:Y,ascender:y,descender:U(P&&P.sTypoDescender,E&&E.descender,0),capHeight:U(P&&P.sCapHeight,y),xHeight:U(P&&P.sxHeight,y),lineGap:U(P&&P.sTypoLineGap,E&&E.lineGap),supportsCodePoint(k){return c.U.codeToGlyph(S,k)>0},forEachGlyph(k,W,z,Q){let ee=0;const O=1/C.unitsPerEm*W,A=w(S,k);let v=0;const x=F(S,A);return A.forEach((_,M)=>{if(_!==-1){let T=D[_];if(!T){const{cmds:j,crds:B}=c.U.glyphToPath(S,_);let I="",J=0;for(let ce=0,q=j.length;ce<q;ce++){const re=d[j[ce]];I+=j[ce];for(let le=1;le<=re;le++)I+=(le>1?",":"")+B[J++]}let te,X,N,me;if(B.length){te=X=1/0,N=me=-1/0;for(let ce=0,q=B.length;ce<q;ce+=2){let re=B[ce],le=B[ce+1];re<te&&(te=re),le<X&&(X=le),re>N&&(N=re),le>me&&(me=le)}}else te=N=X=me=0;T=D[_]={index:_,advanceWidth:S.hmtx.aWidth[_],xMin:te,yMin:X,xMax:N,yMax:me,path:I}}Q.call(null,T,ee+x[M*3]*O,x[M*3+1]*O,v),ee+=x[M*3+2]*O,z&&(ee+=z*W)}v+=k.codePointAt(v)>65535?2:1}),ee}};return C}return function(D){const P=new Uint8Array(D,0,4),E=c._bin.readASCII(P,0,4);if(E==="wOFF")D=r(D);else if(E==="wOF2")throw new Error("woff2 fonts not supported");return R(c.parse(D)[0])}}const Pa=ct({name:"Typr Font Parser",dependencies:[Ra,Ga,La],init(c,r,d){const u=c(),t=r();return d(u,t)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function Oa(){return function(c){var r=function(){this.buckets=new Map};r.prototype.add=function(F){var b=F>>5;this.buckets.set(b,(this.buckets.get(b)||0)|1<<(31&F))},r.prototype.has=function(F){var b=this.buckets.get(F>>5);return b!==void 0&&(b&1<<(31&F))!=0},r.prototype.serialize=function(){var F=[];return this.buckets.forEach(function(b,U){F.push((+U).toString(36)+":"+b.toString(36))}),F.join(",")},r.prototype.deserialize=function(F){var b=this;this.buckets.clear(),F.split(",").forEach(function(U){var R=U.split(":");b.buckets.set(parseInt(R[0],36),parseInt(R[1],36))})};var d=Math.pow(2,8),u=d-1,t=~u;function e(F){var b=function(R){return R&t}(F).toString(16),U=function(R){return(R&t)+d-1}(F).toString(16);return"codepoint-index/plane"+(F>>16)+"/"+b+"-"+U+".json"}function a(F,b){var U=F&u,R=b.codePointAt(U/6|0);return((R=(R||48)-48)&1<<U%6)!=0}function i(F,b){var U;(U=F,U.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(R){return R.split("-").map(function(S){return parseInt(S.trim(),16)})})).forEach(function(R){var S=R[0],D=R[1];D===void 0&&(D=S),b(S,D)})}function n(F,b){i(F,function(U,R){for(var S=U;S<=R;S++)b(S)})}var o={},s={},l=new WeakMap,f="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function h(F){var b=l.get(F);return b||(b=new r,n(F.ranges,function(U){return b.add(U)}),l.set(F,b)),b}var p,m=new Map;function g(F,b,U){return F[b]?b:F[U]?U:function(R){for(var S in R)return S}(F)}function G(F,b){var U=b;if(!F.includes(U)){U=1/0;for(var R=0;R<F.length;R++)Math.abs(F[R]-b)<Math.abs(U-b)&&(U=F[R])}return U}function w(F){return p||(p=new Set,n("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(b){p.add(b)})),p.has(F)}return c.CodePointSet=r,c.clearCache=function(){o={},s={}},c.getFontsForString=function(F,b){b===void 0&&(b={});var U,R=b.lang;R===void 0&&(R=new RegExp("\\p{Script=Hangul}","u").test(U=F)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(U)?"ja":"en");var S=b.category;S===void 0&&(S="sans-serif");var D=b.style;D===void 0&&(D="normal");var P=b.weight;P===void 0&&(P=400);var E=(b.dataUrl||f).replace(/\/$/g,""),Y=new Map,y=new Uint8Array(F.length),C={},k={},W=new Array(F.length),z=new Map,Q=!1;function ee(v){var x=m.get(v);return x||(x=fetch(E+"/"+v).then(function(_){if(!_.ok)throw new Error(_.statusText);return _.json().then(function(M){if(!Array.isArray(M)||M[0]!==1)throw new Error("Incorrect schema version; need 1, got "+M[0]);return M[1]})}).catch(function(_){if(E!==f)return Q||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+E+'", trying default CDN. '+_.message),Q=!0),E=f,m.delete(v),ee(v);throw _}),m.set(v,x)),x}for(var O=function(v){var x=F.codePointAt(v),_=e(x);W[v]=_,o[_]||z.has(_)||z.set(_,ee(_).then(function(M){o[_]=M})),x>65535&&(v++,A=v)},A=0;A<F.length;A++)O(A);return Promise.all(z.values()).then(function(){z.clear();for(var v=function(_){var M=F.codePointAt(_),T=null,j=o[W[_]],B=void 0;for(var I in j){var J=k[I];if(J===void 0&&(J=k[I]=new RegExp(I).test(R||"en")),J){for(var te in B=I,j[I])if(a(M,j[I][te])){T=te;break}break}}if(!T){e:for(var X in j)if(X!==B){for(var N in j[X])if(a(M,j[X][N])){T=N;break e}}}T||(console.debug("No font coverage for U+"+M.toString(16)),T="latin"),W[_]=T,s[T]||z.has(T)||z.set(T,ee("font-meta/"+T+".json").then(function(me){s[T]=me})),M>65535&&(_++,x=_)},x=0;x<F.length;x++)v(x);return Promise.all(z.values())}).then(function(){for(var v,x=null,_=0;_<F.length;_++){var M=F.codePointAt(_);if(x&&(w(M)||h(x).has(M)))y[_]=y[_-1];else{x=s[W[_]];var T=C[x.id];if(!T){var j=x.typeforms,B=g(j,S,"sans-serif"),I=g(j[B],D,"normal"),J=G((v=j[B])===null||v===void 0?void 0:v[I],P);T=C[x.id]=E+"/font-files/"+x.id+"/"+B+"."+I+"."+J+".woff"}var te=Y.get(T);te==null&&(te=Y.size,Y.set(T,te)),y[_]=te}M>65535&&(_++,y[_]=y[_-1])}return{fontUrls:Array.from(Y.keys()),chars:y}})},Object.defineProperty(c,"__esModule",{value:!0}),c}({})}function Ia(c,r){const d=Object.create(null),u=Object.create(null);function t(a,i){const n=o=>{console.error(`Failure loading font ${a}`,o)};try{const o=new XMLHttpRequest;o.open("get",a,!0),o.responseType="arraybuffer",o.onload=function(){if(o.status>=400)n(new Error(o.statusText));else if(o.status>0)try{const s=c(o.response);s.src=a,i(s)}catch(s){n(s)}},o.onerror=n,o.send()}catch(o){n(o)}}function e(a,i){let n=d[a];n?i(n):u[a]?u[a].push(i):(u[a]=[i],t(a,o=>{o.src=a,d[a]=o,u[a].forEach(s=>s(o)),delete u[a]}))}return function(a,i,{lang:n,fonts:o=[],style:s="normal",weight:l="normal",unicodeFontsURL:f}={}){const h=new Uint8Array(a.length),p=[];a.length||w();const m=new Map,g=[];if(s!=="italic"&&(s="normal"),typeof l!="number"&&(l=l==="bold"?700:400),o&&!Array.isArray(o)&&(o=[o]),o=o.slice().filter(b=>!b.lang||b.lang.test(n)).reverse(),o.length){let S=0;(function D(P=0){for(let E=P,Y=a.length;E<Y;E++){const y=a.codePointAt(E);if(S===1&&p[h[E-1]].supportsCodePoint(y)||E>0&&/\s/.test(a[E]))h[E]=h[E-1],S===2&&(g[g.length-1][1]=E);else for(let C=h[E],k=o.length;C<=k;C++)if(C===k){const W=S===2?g[g.length-1]:g[g.length]=[E,E];W[1]=E,S=2}else{h[E]=C;const{src:W,unicodeRange:z}=o[C];if(!z||F(y,z)){const Q=d[W];if(!Q){e(W,()=>{D(E)});return}if(Q.supportsCodePoint(y)){let ee=m.get(Q);typeof ee!="number"&&(ee=p.length,p.push(Q),m.set(Q,ee)),h[E]=ee,S=1;break}}}y>65535&&E+1<Y&&(h[E+1]=h[E],E++,S===2&&(g[g.length-1][1]=E))}G()})()}else g.push([0,a.length-1]),G();function G(){if(g.length){const b=g.map(U=>a.substring(U[0],U[1]+1)).join(`
`);r.getFontsForString(b,{lang:n||void 0,style:s,weight:l,dataUrl:f}).then(({fontUrls:U,chars:R})=>{const S=p.length;let D=0;g.forEach(E=>{for(let Y=0,y=E[1]-E[0];Y<=y;Y++)h[E[0]+Y]=R[D++]+S;D++});let P=0;U.forEach((E,Y)=>{e(E,y=>{p[Y+S]=y,++P===U.length&&w()})})})}else w()}function w(){i({chars:h,fonts:p})}function F(b,U){for(let R=0;R<U.length;R++){const[S,D=S]=U[R];if(S<=b&&b<=D)return!0}return!1}}}const ja=ct({name:"FontResolver",dependencies:[Ia,Pa,Oa],init(c,r,d){return c(r,d())}});function Na(c,r){const u=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,t="[^\\S\\u00A0]",e=new RegExp(`${t}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function a({text:p,lang:m,fonts:g,style:G,weight:w,preResolvedFonts:F,unicodeFontsURL:b},U){const R=({chars:S,fonts:D})=>{let P,E;const Y=[];for(let y=0;y<S.length;y++)S[y]!==E?(E=S[y],Y.push(P={start:y,end:y,fontObj:D[S[y]]})):P.end=y;U(Y)};F?R(F):c(p,R,{lang:m,fonts:g,style:G,weight:w,unicodeFontsURL:b})}function i({text:p="",font:m,lang:g,sdfGlyphSize:G=64,fontSize:w=400,fontWeight:F=1,fontStyle:b="normal",letterSpacing:U=0,lineHeight:R="normal",maxWidth:S=1/0,direction:D,textAlign:P="left",textIndent:E=0,whiteSpace:Y="normal",overflowWrap:y="normal",anchorX:C=0,anchorY:k=0,metricsOnly:W=!1,unicodeFontsURL:z,preResolvedFonts:Q=null,includeCaretPositions:ee=!1,chunkedBoundsSize:O=8192,colorRanges:A=null},v){const x=l(),_={fontLoad:0,typesetting:0};p.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),p=p.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),w=+w,U=+U,S=+S,R=R||"normal",E=+E,a({text:p,lang:g,style:b,weight:F,fonts:typeof m=="string"?[{src:m}]:m,unicodeFontsURL:z,preResolvedFonts:Q},M=>{_.fontLoad=l()-x;const T=isFinite(S);let j=null,B=null,I=null,J=null,te=null,X=null,N=null,me=null,ce=0,q=0,re=Y!=="nowrap";const le=new Map,V=l();let ne=E,$=0,L=new f;const de=[L];M.forEach(ae=>{const{fontObj:ie}=ae,{ascender:ue,descender:ve,unitsPerEm:we,lineGap:Me,capHeight:ge,xHeight:xe}=ie;let fe=le.get(ie);if(!fe){const he=w/we,Ue=R==="normal"?(ue-ve+Me)*he:R*w,Qe=(Ue-(ue-ve)*he)/2,Se=Math.min(Ue,(ue-ve)*he),ye=(ue+ve)/2*he+Se/2;fe={index:le.size,src:ie.src,fontObj:ie,fontSizeMult:he,unitsPerEm:we,ascender:ue*he,descender:ve*he,capHeight:ge*he,xHeight:xe*he,lineHeight:Ue,baseline:-Qe-ue*he,caretTop:ye,caretBottom:ye-Se},le.set(ie,fe)}const{fontSizeMult:Ce}=fe,ke=p.slice(ae.start,ae.end+1);let Pe,Te;ie.forEachGlyph(ke,w,U,(he,Ue,Qe,Se)=>{Ue+=$,Se+=ae.start,Pe=Ue,Te=he;const ye=p.charAt(Se),Ee=he.advanceWidth*Ce,Fe=L.count;let pe;if("isEmpty"in he||(he.isWhitespace=!!ye&&new RegExp(t).test(ye),he.canBreakAfter=!!ye&&e.test(ye),he.isEmpty=he.xMin===he.xMax||he.yMin===he.yMax||u.test(ye)),!he.isWhitespace&&!he.isEmpty&&q++,re&&T&&!he.isWhitespace&&Ue+Ee+ne>S&&Fe){if(L.glyphAt(Fe-1).glyphObj.canBreakAfter)pe=new f,ne=-Ue;else for(let Ge=Fe;Ge--;)if(Ge===0&&y==="break-word"){pe=new f,ne=-Ue;break}else if(L.glyphAt(Ge).glyphObj.canBreakAfter){pe=L.splitAt(Ge+1);const Re=pe.glyphAt(0).x;ne-=Re;for(let Ae=pe.count;Ae--;)pe.glyphAt(Ae).x-=Re;break}pe&&(L.isSoftWrapped=!0,L=pe,de.push(L),ce=S)}let De=L.glyphAt(L.count);De.glyphObj=he,De.x=Ue+ne,De.y=Qe,De.width=Ee,De.charIndex=Se,De.fontData=fe,ye===`
`&&(L=new f,de.push(L),ne=-(Ue+Ee+U*w)+E)}),$=Pe+Te.advanceWidth*Ce+U*w});let Z=0;de.forEach(ae=>{let ie=!0;for(let ue=ae.count;ue--;){const ve=ae.glyphAt(ue);ie&&!ve.glyphObj.isWhitespace&&(ae.width=ve.x+ve.width,ae.width>ce&&(ce=ae.width),ie=!1);let{lineHeight:we,capHeight:Me,xHeight:ge,baseline:xe}=ve.fontData;we>ae.lineHeight&&(ae.lineHeight=we);const fe=xe-ae.baseline;fe<0&&(ae.baseline+=fe,ae.cap+=fe,ae.ex+=fe),ae.cap=Math.max(ae.cap,ae.baseline+Me),ae.ex=Math.max(ae.ex,ae.baseline+ge)}ae.baseline-=Z,ae.cap-=Z,ae.ex-=Z,Z+=ae.lineHeight});let oe=0,K=0;if(C&&(typeof C=="number"?oe=-C:typeof C=="string"&&(oe=-ce*(C==="left"?0:C==="center"?.5:C==="right"?1:o(C)))),k&&(typeof k=="number"?K=-k:typeof k=="string"&&(K=k==="top"?0:k==="top-baseline"?-de[0].baseline:k==="top-cap"?-de[0].cap:k==="top-ex"?-de[0].ex:k==="middle"?Z/2:k==="bottom"?Z:k==="bottom-baseline"?-de[de.length-1].baseline:o(k)*Z)),!W){const ae=r.getEmbeddingLevels(p,D);j=new Uint16Array(q),B=new Uint8Array(q),I=new Float32Array(q*2),J={},N=[1/0,1/0,-1/0,-1/0],me=[],ee&&(X=new Float32Array(p.length*4)),A&&(te=new Uint8Array(q*3));let ie=0,ue=-1,ve=-1,we,Me;if(de.forEach((ge,xe)=>{let{count:fe,width:Ce}=ge;if(fe>0){let ke=0;for(let Se=fe;Se--&&ge.glyphAt(Se).glyphObj.isWhitespace;)ke++;let Pe=0,Te=0;if(P==="center")Pe=(ce-Ce)/2;else if(P==="right")Pe=ce-Ce;else if(P==="justify"&&ge.isSoftWrapped){let Se=0;for(let ye=fe-ke;ye--;)ge.glyphAt(ye).glyphObj.isWhitespace&&Se++;Te=(ce-Ce)/Se}if(Te||Pe){let Se=0;for(let ye=0;ye<fe;ye++){let Ee=ge.glyphAt(ye);const Fe=Ee.glyphObj;Ee.x+=Pe+Se,Te!==0&&Fe.isWhitespace&&ye<fe-ke&&(Se+=Te,Ee.width+=Te)}}const he=r.getReorderSegments(p,ae,ge.glyphAt(0).charIndex,ge.glyphAt(ge.count-1).charIndex);for(let Se=0;Se<he.length;Se++){const[ye,Ee]=he[Se];let Fe=1/0,pe=-1/0;for(let De=0;De<fe;De++)if(ge.glyphAt(De).charIndex>=ye){let Ge=De,Re=De;for(;Re<fe;Re++){let Ae=ge.glyphAt(Re);if(Ae.charIndex>Ee)break;Re<fe-ke&&(Fe=Math.min(Fe,Ae.x),pe=Math.max(pe,Ae.x+Ae.width))}for(let Ae=Ge;Ae<Re;Ae++){const We=ge.glyphAt(Ae);We.x=pe-(We.x+We.width-Fe)}break}}let Ue;const Qe=Se=>Ue=Se;for(let Se=0;Se<fe;Se++){const ye=ge.glyphAt(Se);Ue=ye.glyphObj;const Ee=Ue.index,Fe=ae.levels[ye.charIndex]&1;if(Fe){const pe=r.getMirroredCharacter(p[ye.charIndex]);pe&&ye.fontData.fontObj.forEachGlyph(pe,0,0,Qe)}if(ee){const{charIndex:pe,fontData:De}=ye,Ge=ye.x+oe,Re=ye.x+ye.width+oe;X[pe*4]=Fe?Re:Ge,X[pe*4+1]=Fe?Ge:Re,X[pe*4+2]=ge.baseline+De.caretBottom+K,X[pe*4+3]=ge.baseline+De.caretTop+K;const Ae=pe-ue;Ae>1&&s(X,ue,Ae),ue=pe}if(A){const{charIndex:pe}=ye;for(;pe>ve;)ve++,A.hasOwnProperty(ve)&&(Me=A[ve])}if(!Ue.isWhitespace&&!Ue.isEmpty){const pe=ie++,{fontSizeMult:De,src:Ge,index:Re}=ye.fontData,Ae=J[Ge]||(J[Ge]={});Ae[Ee]||(Ae[Ee]={path:Ue.path,pathBounds:[Ue.xMin,Ue.yMin,Ue.xMax,Ue.yMax]});const We=ye.x+oe,Ze=ye.y+ge.baseline+K;I[pe*2]=We,I[pe*2+1]=Ze;const Xe=We+Ue.xMin*De,qe=Ze+Ue.yMin*De,tt=We+Ue.xMax*De,Ye=Ze+Ue.yMax*De;Xe<N[0]&&(N[0]=Xe),qe<N[1]&&(N[1]=qe),tt>N[2]&&(N[2]=tt),Ye>N[3]&&(N[3]=Ye),pe%O===0&&(we={start:pe,end:pe,rect:[1/0,1/0,-1/0,-1/0]},me.push(we)),we.end++;const Le=we.rect;if(Xe<Le[0]&&(Le[0]=Xe),qe<Le[1]&&(Le[1]=qe),tt>Le[2]&&(Le[2]=tt),Ye>Le[3]&&(Le[3]=Ye),j[pe]=Ee,B[pe]=Re,A){const rt=pe*3;te[rt]=Me>>16&255,te[rt+1]=Me>>8&255,te[rt+2]=Me&255}}}}}),X){const ge=p.length-ue;ge>1&&s(X,ue,ge)}}const _e=[];le.forEach(({index:ae,src:ie,unitsPerEm:ue,ascender:ve,descender:we,lineHeight:Me,capHeight:ge,xHeight:xe})=>{_e[ae]={src:ie,unitsPerEm:ue,ascender:ve,descender:we,lineHeight:Me,capHeight:ge,xHeight:xe}}),_.typesetting=l()-V,v({glyphIds:j,glyphFontIndices:B,glyphPositions:I,glyphData:J,fontData:_e,caretPositions:X,glyphColors:te,chunkedBounds:me,fontSize:w,topBaseline:K+de[0].baseline,blockBounds:[oe,K-Z,oe+ce,K],visibleBounds:N,timings:_})})}function n(p,m){i({...p,metricsOnly:!0},g=>{const[G,w,F,b]=g.blockBounds;m({width:F-G,height:b-w})})}function o(p){let m=p.match(/^([\d.]+)%$/),g=m?parseFloat(m[1]):NaN;return isNaN(g)?0:g/100}function s(p,m,g){const G=p[m*4],w=p[m*4+1],F=p[m*4+2],b=p[m*4+3],U=(w-G)/g;for(let R=0;R<g;R++){const S=(m+R)*4;p[S]=G+U*R,p[S+1]=G+U*(R+1),p[S+2]=F,p[S+3]=b}}function l(){return(self.performance||Date).now()}function f(){this.data=[]}const h=["glyphObj","x","y","width","charIndex","fontData"];return f.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/h.length)},glyphAt(p){let m=f.flyweight;return m.data=this.data,m.index=p,m},splitAt(p){let m=new f;return m.data=this.data.splice(p*h.length),m}},f.flyweight=h.reduce((p,m,g,G)=>(Object.defineProperty(p,m,{get(){return this.data[this.index*h.length+g]},set(w){this.data[this.index*h.length+g]=w}}),p),{data:null,index:0}),{typeset:i,measure:n}}const at=()=>(self.performance||Date).now(),Yt=mn();let rn;function Wa(c,r,d,u,t,e,a,i,n,o,s=!0){return s?Va(c,r,d,u,t,e,a,i,n,o).then(null,l=>(rn||(console.warn("WebGL SDF generation failed, falling back to JS",l),rn=!0),an(c,r,d,u,t,e,a,i,n,o))):an(c,r,d,u,t,e,a,i,n,o)}const zt=[],za=5;let Ur=0;function xn(){const c=at();for(;zt.length&&at()-c<za;)zt.shift()();Ur=zt.length?setTimeout(xn,0):0}const Va=(...c)=>new Promise((r,d)=>{zt.push(()=>{const u=at();try{Yt.webgl.generateIntoCanvas(...c),r({timing:at()-u})}catch(t){d(t)}}),Ur||(Ur=setTimeout(xn,0))}),Ha=4,Xa=2e3,nn={};let Ya=0;function an(c,r,d,u,t,e,a,i,n,o){const s="TroikaTextSDFGenerator_JS_"+Ya++%Ha;let l=nn[s];return l||(l=nn[s]={workerModule:ct({name:s,workerId:s,dependencies:[mn,at],init(f,h){const p=f().javascript.generate;return function(...m){const g=h();return{textureData:p(...m),timing:h()-g}}},getTransferables(f){return[f.textureData.buffer]}}),requests:0,idleTimer:null}),l.requests++,clearTimeout(l.idleTimer),l.workerModule(c,r,d,u,t,e).then(({textureData:f,timing:h})=>{const p=at(),m=new Uint8Array(f.length*4);for(let g=0;g<f.length;g++)m[g*4+o]=f[g];return Yt.webglUtils.renderImageData(a,m,i,n,c,r,1<<3-o),h+=at()-p,--l.requests===0&&(l.idleTimer=setTimeout(()=>{wa(s)},Xa)),{timing:h}})}function Ja(c){c._warm||(Yt.webgl.isSupported(c),c._warm=!0)}const Ka=Yt.webglUtils.resizeWebGLCanvasWithoutClearing,St={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},Qa=new Xt;function ft(){return(self.performance||Date).now()}const on=Object.create(null);function yn(c,r){c=$a({},c);const d=ft(),u=[];if(c.font&&u.push({label:"user",src:eo(c.font)}),c.font=u,c.text=""+c.text,c.sdfGlyphSize=c.sdfGlyphSize||St.sdfGlyphSize,c.unicodeFontsURL=c.unicodeFontsURL||St.unicodeFontsURL,c.colorRanges!=null){let f={};for(let h in c.colorRanges)if(c.colorRanges.hasOwnProperty(h)){let p=c.colorRanges[h];typeof p!="number"&&(p=Qa.set(p).getHex()),f[h]=p}c.colorRanges=f}Object.freeze(c);const{textureWidth:t,sdfExponent:e}=St,{sdfGlyphSize:a}=c,i=t/a*4;let n=on[a];if(!n){const f=document.createElement("canvas");f.width=t,f.height=a*256/i,n=on[a]={glyphCount:0,sdfGlyphSize:a,sdfCanvas:f,sdfTexture:new ra(f,void 0,void 0,void 0,ut,ut),contextLost:!1,glyphsByFont:new Map},n.sdfTexture.generateMipmaps=!1,Za(n)}const{sdfTexture:o,sdfCanvas:s}=n;Un(c).then(f=>{const{glyphIds:h,glyphFontIndices:p,fontData:m,glyphPositions:g,fontSize:G,timings:w}=f,F=[],b=new Float32Array(h.length*4);let U=0,R=0;const S=ft(),D=m.map(C=>{let k=n.glyphsByFont.get(C.src);return k||n.glyphsByFont.set(C.src,k=new Map),k});h.forEach((C,k)=>{const W=p[k],{src:z,unitsPerEm:Q}=m[W];let ee=D[W].get(C);if(!ee){const{path:_,pathBounds:M}=f.glyphData[z][C],T=Math.max(M[2]-M[0],M[3]-M[1])/a*(St.sdfMargin*a+.5),j=n.glyphCount++,B=[M[0]-T,M[1]-T,M[2]+T,M[3]+T];D[W].set(C,ee={path:_,atlasIndex:j,sdfViewBox:B}),F.push(ee)}const{sdfViewBox:O}=ee,A=g[R++],v=g[R++],x=G/Q;b[U++]=A+O[0]*x,b[U++]=v+O[1]*x,b[U++]=A+O[2]*x,b[U++]=v+O[3]*x,h[k]=ee.atlasIndex}),w.quads=(w.quads||0)+(ft()-S);const P=ft();w.sdf={};const E=s.height,Y=Math.ceil(n.glyphCount/i),y=Math.pow(2,Math.ceil(Math.log2(Y*a)));y>E&&(console.info(`Increasing SDF texture size ${E}->${y}`),Ka(s,t,y),o.dispose()),Promise.all(F.map(C=>bn(C,n,c.gpuAccelerateSDF).then(({timing:k})=>{w.sdf[C.atlasIndex]=k}))).then(()=>{F.length&&!n.contextLost&&(_n(n),o.needsUpdate=!0),w.sdfTotal=ft()-P,w.total=ft()-d,r(Object.freeze({parameters:c,sdfTexture:o,sdfGlyphSize:a,sdfExponent:e,glyphBounds:b,glyphAtlasIndices:h,glyphColors:f.glyphColors,caretPositions:f.caretPositions,chunkedBounds:f.chunkedBounds,ascender:f.ascender,descender:f.descender,lineHeight:f.lineHeight,capHeight:f.capHeight,xHeight:f.xHeight,topBaseline:f.topBaseline,blockBounds:f.blockBounds,visibleBounds:f.visibleBounds,timings:f.timings}))})}),Promise.resolve().then(()=>{n.contextLost||Ja(s)})}function bn({path:c,atlasIndex:r,sdfViewBox:d},{sdfGlyphSize:u,sdfCanvas:t,contextLost:e},a){if(e)return Promise.resolve({timing:-1});const{textureWidth:i,sdfExponent:n}=St,o=Math.max(d[2]-d[0],d[3]-d[1]),s=Math.floor(r/4),l=s%(i/u)*u,f=Math.floor(s/(i/u))*u,h=r%4;return Wa(u,u,c,d,o,n,t,l,f,h,a)}function Za(c){const r=c.sdfCanvas;r.addEventListener("webglcontextlost",d=>{console.log("Context Lost",d),d.preventDefault(),c.contextLost=!0}),r.addEventListener("webglcontextrestored",d=>{console.log("Context Restored",d),c.contextLost=!1;const u=[];c.glyphsByFont.forEach(t=>{t.forEach(e=>{u.push(bn(e,c,!0))})}),Promise.all(u).then(()=>{_n(c),c.sdfTexture.needsUpdate=!0})})}function qa({font:c,characters:r,sdfGlyphSize:d},u){let t=Array.isArray(r)?r.join(`
`):""+r;yn({font:c,sdfGlyphSize:d,text:t},u)}function $a(c,r){for(let d in r)r.hasOwnProperty(d)&&(c[d]=r[d]);return c}let It;function eo(c){return It||(It=typeof document>"u"?{}:document.createElement("a")),It.href=c,It.href}function _n(c){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:r,sdfTexture:d}=c,{width:u,height:t}=r,e=c.sdfCanvas.getContext("webgl");let a=d.image.data;(!a||a.length!==u*t*4)&&(a=new Uint8Array(u*t*4),d.image={width:u,height:t,data:a},d.flipY=!1,d.isDataTexture=!0),e.readPixels(0,0,u,t,e.RGBA,e.UNSIGNED_BYTE,a)}}const to=ct({name:"Typesetter",dependencies:[Na,ja,ka],init(c,r,d){return c(r,d())}}),Un=ct({name:"Typesetter",dependencies:[to],init(c){return function(r){return new Promise(d=>{c.typeset(r,d)})}},getTransferables(c){const r=[];for(let d in c)c[d]&&c[d].buffer&&r.push(c[d].buffer);return r}});Un.onMainThread;const sn={};function ro(c){let r=sn[c];return r||(r=sn[c]=new Tr(1,1,c,c).translate(.5,.5,0)),r}const no="aTroikaGlyphBounds",ln="aTroikaGlyphIndex",ao="aTroikaGlyphColor";class oo extends $n{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new ea,this.boundingBox=new dn}computeBoundingSphere(){}computeBoundingBox(){}set detail(r){if(r!==this._detail){this._detail=r,(typeof r!="number"||r<1)&&(r=1);let d=ro(r);["position","normal","uv"].forEach(u=>{this.attributes[u]=d.attributes[u].clone()}),this.setIndex(d.getIndex().clone())}}get detail(){return this._detail}set curveRadius(r){r!==this._curveRadius&&(this._curveRadius=r,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(r,d,u,t,e){this.updateAttributeData(no,r,4),this.updateAttributeData(ln,d,1),this.updateAttributeData(ao,e,3),this._blockBounds=u,this._chunkedBounds=t,this.instanceCount=d.length,this._updateBounds()}_updateBounds(){const r=this._blockBounds;if(r){const{curveRadius:d,boundingBox:u}=this;if(d){const{PI:t,floor:e,min:a,max:i,sin:n,cos:o}=Math,s=t/2,l=t*2,f=Math.abs(d),h=r[0]/f,p=r[2]/f,m=e((h+s)/l)!==e((p+s)/l)?-f:a(n(h)*f,n(p)*f),g=e((h-s)/l)!==e((p-s)/l)?f:i(n(h)*f,n(p)*f),G=e((h+t)/l)!==e((p+t)/l)?f*2:i(f-o(h)*f,f-o(p)*f);u.min.set(m,r[1],d<0?-G:0),u.max.set(g,r[3],d<0?0:G)}else u.min.set(r[0],r[1],0),u.max.set(r[2],r[3],0);u.getBoundingSphere(this.boundingSphere)}}applyClipRect(r){let d=this.getAttribute(ln).count,u=this._chunkedBounds;if(u)for(let t=u.length;t--;){d=u[t].end;let e=u[t].rect;if(e[1]<r.w&&e[3]>r.y&&e[0]<r.z&&e[2]>r.x)break}this.instanceCount=d}updateAttributeData(r,d,u){const t=this.getAttribute(r);d?t&&t.array.length===d.length?(t.array.set(d),t.needsUpdate=!0):(this.setAttribute(r,new ta(d,u)),delete this._maxInstanceCount,this.dispose()):t&&this.deleteAttribute(r)}}const io=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,so=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,lo=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,fo=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function uo(c){const r=_r(c,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new Ke},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Vt(0,0,0,0)},uTroikaClipRect:{value:new Vt(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new Ke},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Xt},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new na},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:io,vertexTransform:so,fragmentDefs:lo,fragmentColorTransform:fo,customRewriter({vertexShader:d,fragmentShader:u}){let t=/\buniform\s+vec3\s+diffuse\b/;return t.test(u)&&(u=u.replace(t,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),t.test(d)||(d=d.replace(gn,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:d,fragmentShader:u}}});return r.transparent=!0,r.forceSinglePass=!0,Object.defineProperties(r,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),r}const kr=new qn({color:16777215,side:aa,transparent:!0}),fn=8421504,un=new gr,jt=new Je,pr=new Je,Ut=[],co=new Je,mr="+x+y";function cn(c){return Array.isArray(c)?c[0]:c}let Sn=()=>{const c=new Ht(new Tr(1,1),kr);return Sn=()=>c,c},wn=()=>{const c=new Ht(new Tr(1,1,32,1),kr);return wn=()=>c,c};const ho={type:"syncstart"},vo={type:"synccomplete"},Tn=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],po=Tn.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let kn=class extends Ht{constructor(){const r=new oo;super(r,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=fn,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=mr,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(r){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(r):(this._isSyncing=!0,this.dispatchEvent(ho),yn({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},d=>{this._isSyncing=!1,this._textRenderInfo=d,this.geometry.updateGlyphs(d.glyphBounds,d.glyphAtlasIndices,d.blockBounds,d.chunkedBounds,d.glyphColors);const u=this._queuedSyncs;u&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{u.forEach(t=>t&&t())})),this.dispatchEvent(vo),r&&r()})))}onBeforeRender(r,d,u,t,e,a){this.sync(),e.isTroikaTextMaterial&&this._prepareForRender(e)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(r){return uo(r)}get material(){let r=this._derivedMaterial;const d=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=kr.clone());if((!r||!r.isDerivedFrom(d))&&(r=this._derivedMaterial=this.createDerivedMaterial(d),d.addEventListener("dispose",function u(){d.removeEventListener("dispose",u),r.dispose()})),this.hasOutline()){let u=r._outlineMtl;return u||(u=r._outlineMtl=Object.create(r,{id:{value:r.id+.1}}),u.isTextOutlineMaterial=!0,u.depthWrite=!1,u.map=null,r.addEventListener("dispose",function t(){r.removeEventListener("dispose",t),u.dispose()})),[u,r]}else return r}set material(r){r&&r.isTroikaTextMaterial?(this._derivedMaterial=r,this._baseMaterial=r.baseMaterial):this._baseMaterial=r}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(r){this.geometry.detail=r}get curveRadius(){return this.geometry.curveRadius}set curveRadius(r){this.geometry.curveRadius=r}get customDepthMaterial(){return cn(this.material).getDepthMaterial()}set customDepthMaterial(r){}get customDistanceMaterial(){return cn(this.material).getDistanceMaterial()}set customDistanceMaterial(r){}_prepareForRender(r){const d=r.isTextOutlineMaterial,u=r.uniforms,t=this.textRenderInfo;if(t){const{sdfTexture:i,blockBounds:n}=t;u.uTroikaSDFTexture.value=i,u.uTroikaSDFTextureSize.value.set(i.image.width,i.image.height),u.uTroikaSDFGlyphSize.value=t.sdfGlyphSize,u.uTroikaSDFExponent.value=t.sdfExponent,u.uTroikaTotalBounds.value.fromArray(n),u.uTroikaUseGlyphColors.value=!d&&!!t.glyphColors;let o=0,s=0,l=0,f,h,p,m=0,g=0;if(d){let{outlineWidth:w,outlineOffsetX:F,outlineOffsetY:b,outlineBlur:U,outlineOpacity:R}=this;o=this._parsePercent(w)||0,s=Math.max(0,this._parsePercent(U)||0),f=R,m=this._parsePercent(F)||0,g=this._parsePercent(b)||0}else l=Math.max(0,this._parsePercent(this.strokeWidth)||0),l&&(p=this.strokeColor,u.uTroikaStrokeColor.value.set(p??fn),h=this.strokeOpacity,h==null&&(h=1)),f=this.fillOpacity;u.uTroikaEdgeOffset.value=o,u.uTroikaPositionOffset.value.set(m,g),u.uTroikaBlurRadius.value=s,u.uTroikaStrokeWidth.value=l,u.uTroikaStrokeOpacity.value=h,u.uTroikaFillOpacity.value=f??1,u.uTroikaCurveRadius.value=this.curveRadius||0;let G=this.clipRect;if(G&&Array.isArray(G)&&G.length===4)u.uTroikaClipRect.value.fromArray(G);else{const w=(this.fontSize||.1)*100;u.uTroikaClipRect.value.set(n[0]-w,n[1]-w,n[2]+w,n[3]+w)}this.geometry.applyClipRect(u.uTroikaClipRect.value)}u.uTroikaSDFDebug.value=!!this.debugSDF,r.polygonOffset=!!this.depthOffset,r.polygonOffsetFactor=r.polygonOffsetUnits=this.depthOffset||0;const e=d?this.outlineColor||0:this.color;if(e==null)delete r.color;else{const i=r.hasOwnProperty("color")?r.color:r.color=new Xt;(e!==i._input||typeof e=="object")&&i.set(i._input=e)}let a=this.orientation||mr;if(a!==r._orientation){let i=u.uTroikaOrient.value;a=a.replace(/[^-+xyz]/g,"");let n=a!==mr&&a.match(/^([-+])([xyz])([-+])([xyz])$/);if(n){let[,o,s,l,f]=n;jt.set(0,0,0)[s]=o==="-"?1:-1,pr.set(0,0,0)[f]=l==="-"?-1:1,un.lookAt(co,jt.cross(pr),pr),i.setFromMatrix4(un)}else i.identity();r._orientation=a}}_parsePercent(r){if(typeof r=="string"){let d=r.match(/^(-?[\d.]+)%$/),u=d?parseFloat(d[1]):NaN;r=(isNaN(u)?0:u/100)*this.fontSize}return r}localPositionToTextCoords(r,d=new Ke){d.copy(r);const u=this.curveRadius;return u&&(d.x=Math.atan2(r.x,Math.abs(u)-Math.abs(r.z))*Math.abs(u)),d}worldPositionToTextCoords(r,d=new Ke){return jt.copy(r),this.localPositionToTextCoords(this.worldToLocal(jt),d)}raycast(r,d){const{textRenderInfo:u,curveRadius:t}=this;if(u){const e=u.blockBounds,a=t?wn():Sn(),i=a.geometry,{position:n,uv:o}=i.attributes;for(let s=0;s<o.count;s++){let l=e[0]+o.getX(s)*(e[2]-e[0]);const f=e[1]+o.getY(s)*(e[3]-e[1]);let h=0;t&&(h=t-Math.cos(l/t)*t,l=Math.sin(l/t)*t),n.setXYZ(s,l,f,h)}i.boundingSphere=this.geometry.boundingSphere,i.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,Ut.length=0,a.raycast(r,Ut);for(let s=0;s<Ut.length;s++)Ut[s].object=this,d.push(Ut[s])}}copy(r){const d=this.geometry;return super.copy(r),this.geometry=d,po.forEach(u=>{this[u]=r[u]}),this}clone(){return new this.constructor().copy(this)}};Tn.forEach(c=>{const r="_private_"+c;Object.defineProperty(kn.prototype,c,{get(){return this[r]},set(d){d!==this[r]&&(this[r]=d,this._needsSync=!0)}})});new dn;new Xt;const mo=be.forwardRef(({sdfGlyphSize:c=64,anchorX:r="center",anchorY:d="middle",font:u,fontSize:t=1,children:e,characters:a,onSync:i,...n},o)=>{const s=Nt(({invalidate:p})=>p),[l]=be.useState(()=>new kn),[f,h]=be.useMemo(()=>{const p=[];let m="";return be.Children.forEach(e,g=>{typeof g=="string"||typeof g=="number"?m+=g:p.push(g)}),[p,m]},[e]);return On(()=>new Promise(p=>qa({font:u,characters:a},p)),["troika-text",u,a]),be.useLayoutEffect(()=>void l.sync(()=>{s(),i&&i(l)})),be.useEffect(()=>()=>l.dispose(),[l]),be.createElement("primitive",hn({object:l,ref:o,font:u,text:h,anchorX:r,anchorY:d,fontSize:t,sdfGlyphSize:c},n),f)}),go=()=>parseInt(oa.replace(/\D+/g,"")),xo=go();class yo extends ia{constructor(r=new Ke){super({uniforms:{inputBuffer:new Ne(null),depthBuffer:new Ne(null),resolution:new Ne(new Ke),texelSize:new Ne(new Ke),halfTexelSize:new Ne(new Ke),kernel:new Ne(0),scale:new Ne(1),cameraNear:new Ne(0),cameraFar:new Ne(1),minDepthThreshold:new Ne(0),maxDepthThreshold:new Ne(1),depthScale:new Ne(0),depthToBlurRatioBias:new Ne(.25)},fragmentShader:`#include <common>
        #include <dithering_pars_fragment>      
        uniform sampler2D inputBuffer;
        uniform sampler2D depthBuffer;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          float depthFactor = 0.0;
          
          #ifdef USE_DEPTH
            vec4 depth = texture2D(depthBuffer, vUv);
            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
            depthFactor *= depthScale;
            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));
          #endif
          
          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));
          gl_FragColor = sum * 0.25 ;

          #include <dithering_fragment>
          #include <tonemapping_fragment>
          #include <${xo>=154?"colorspace_fragment":"encodings_fragment"}>
        }`,vertexShader:`uniform vec2 texelSize;
        uniform vec2 halfTexelSize;
        uniform float kernel;
        uniform float scale;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          vec2 uv = position.xy * 0.5 + 0.5;
          vUv = uv;

          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;
          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);
          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);
          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);
          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);

          gl_Position = vec4(position.xy, 1.0, 1.0);
        }`,blending:sa,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(r.x,r.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(r,d){this.uniforms.texelSize.value.set(r,d),this.uniforms.halfTexelSize.value.set(r,d).multiplyScalar(.5)}setResolution(r){this.uniforms.resolution.value.copy(r)}}class bo{constructor({gl:r,resolution:d,width:u=500,height:t=500,minDepthThreshold:e=0,maxDepthThreshold:a=1,depthScale:i=0,depthToBlurRatioBias:n=.25}){this.renderToScreen=!1,this.renderTargetA=new xr(d,d,{minFilter:ut,magFilter:ut,stencilBuffer:!1,depthBuffer:!1,type:vn}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new yo,this.convolutionMaterial.setTexelSize(1/u,1/t),this.convolutionMaterial.setResolution(new Ke(u,t)),this.scene=new la,this.camera=new fa,this.convolutionMaterial.uniforms.minDepthThreshold.value=e,this.convolutionMaterial.uniforms.maxDepthThreshold.value=a,this.convolutionMaterial.uniforms.depthScale.value=i,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=n,this.convolutionMaterial.defines.USE_DEPTH=i>0;const o=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),s=new Float32Array([0,0,2,0,0,2]),l=new ua;l.setAttribute("position",new Qr(o,3)),l.setAttribute("uv",new Qr(s,2)),this.screen=new Ht(l,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(r,d,u){const t=this.scene,e=this.camera,a=this.renderTargetA,i=this.renderTargetB;let n=this.convolutionMaterial,o=n.uniforms;o.depthBuffer.value=d.depthTexture;const s=n.kernel;let l=d,f,h,p;for(h=0,p=s.length-1;h<p;++h)f=h&1?i:a,o.kernel.value=s[h],o.inputBuffer.value=l.texture,r.setRenderTarget(f),r.render(t,e),l=f;o.kernel.value=s[h],o.inputBuffer.value=l.texture,r.setRenderTarget(this.renderToScreen?null:u),r.render(t,e)}}let _o=class extends ca{constructor(r={}){super(r),this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(r)}onBeforeCompile(r){var d;(d=r.defines)!=null&&d.USE_UV||(r.defines.USE_UV=""),r.uniforms.hasBlur=this._hasBlur,r.uniforms.tDiffuse=this._tDiffuse,r.uniforms.tDepth=this._tDepth,r.uniforms.distortionMap=this._distortionMap,r.uniforms.tDiffuseBlur=this._tDiffuseBlur,r.uniforms.textureMatrix=this._textureMatrix,r.uniforms.mirror=this._mirror,r.uniforms.mixBlur=this._mixBlur,r.uniforms.mixStrength=this._blurStrength,r.uniforms.minDepthThreshold=this._minDepthThreshold,r.uniforms.maxDepthThreshold=this._maxDepthThreshold,r.uniforms.depthScale=this._depthScale,r.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,r.uniforms.distortion=this._distortion,r.uniforms.mixContrast=this._mixContrast,r.vertexShader=`
        uniform mat4 textureMatrix;
        varying vec4 my_vUv;
      ${r.vertexShader}`,r.vertexShader=r.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
        my_vUv = textureMatrix * vec4( position, 1.0 );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );`),r.fragmentShader=`
        uniform sampler2D tDiffuse;
        uniform sampler2D tDiffuseBlur;
        uniform sampler2D tDepth;
        uniform sampler2D distortionMap;
        uniform float distortion;
        uniform float cameraNear;
			  uniform float cameraFar;
        uniform bool hasBlur;
        uniform float mixBlur;
        uniform float mirror;
        uniform float mixStrength;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float mixContrast;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec4 my_vUv;
        ${r.fragmentShader}`,r.fragmentShader=r.fragmentShader.replace("#include <emissivemap_fragment>",`#include <emissivemap_fragment>

      float distortionFactor = 0.0;
      #ifdef USE_DISTORTION
        distortionFactor = texture2D(distortionMap, vUv).r * distortion;
      #endif

      vec4 new_vUv = my_vUv;
      new_vUv.x += distortionFactor;
      new_vUv.y += distortionFactor;

      vec4 base = texture2DProj(tDiffuse, new_vUv);
      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);

      vec4 merge = base;

      #ifdef USE_NORMALMAP
        vec2 normal_uv = vec2(0.0);
        vec4 normalColor = texture2D(normalMap, vUv * normalScale);
        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );
        vec3 coord = new_vUv.xyz / new_vUv.w;
        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;
        vec4 base_normal = texture2D(tDiffuse, normal_uv);
        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);
        merge = base_normal;
        blur = blur_normal;
      #endif

      float depthFactor = 0.0001;
      float blurFactor = 0.0;

      #ifdef USE_DEPTH
        vec4 depth = texture2DProj(tDepth, new_vUv);
        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
        depthFactor *= depthScale;
        depthFactor = max(0.0001, min(1.0, depthFactor));

        #ifdef USE_BLUR
          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);
          merge = merge * min(1.0, depthFactor + 0.5);
        #else
          merge = merge * depthFactor;
        #endif

      #endif

      float reflectorRoughnessFactor = roughness;
      #ifdef USE_ROUGHNESSMAP
        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );
        reflectorRoughnessFactor *= reflectorTexelRoughness.g;
      #endif

      #ifdef USE_BLUR
        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);
        merge = mix(merge, blur, blurFactor);
      #endif

      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);
      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;
      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;
      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;

      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);
      `)}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(r){this._tDiffuse.value=r}get tDepth(){return this._tDepth.value}set tDepth(r){this._tDepth.value=r}get distortionMap(){return this._distortionMap.value}set distortionMap(r){this._distortionMap.value=r}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(r){this._tDiffuseBlur.value=r}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(r){this._textureMatrix.value=r}get hasBlur(){return this._hasBlur.value}set hasBlur(r){this._hasBlur.value=r}get mirror(){return this._mirror.value}set mirror(r){this._mirror.value=r}get mixBlur(){return this._mixBlur.value}set mixBlur(r){this._mixBlur.value=r}get mixStrength(){return this._blurStrength.value}set mixStrength(r){this._blurStrength.value=r}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(r){this._minDepthThreshold.value=r}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(r){this._maxDepthThreshold.value=r}get depthScale(){return this._depthScale.value}set depthScale(r){this._depthScale.value=r}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(r){this._depthToBlurRatioBias.value=r}get distortion(){return this._distortion.value}set distortion(r){this._distortion.value=r}get mixContrast(){return this._mixContrast.value}set mixContrast(r){this._mixContrast.value=r}};const Uo=be.forwardRef(({mixBlur:c=0,mixStrength:r=1,resolution:d=256,blur:u=[0,0],minDepthThreshold:t=.9,maxDepthThreshold:e=1,depthScale:a=0,depthToBlurRatioBias:i=.25,mirror:n=0,distortion:o=1,mixContrast:s=1,distortionMap:l,reflectorOffset:f=0,...h},p)=>{In({MeshReflectorMaterialImpl:_o});const m=Nt(({gl:v})=>v),g=Nt(({camera:v})=>v),G=Nt(({scene:v})=>v);u=Array.isArray(u)?u:[u,u];const w=u[0]+u[1]>0,F=be.useRef(null);be.useImperativeHandle(p,()=>F.current,[]);const[b]=be.useState(()=>new ha),[U]=be.useState(()=>new Je),[R]=be.useState(()=>new Je),[S]=be.useState(()=>new Je),[D]=be.useState(()=>new gr),[P]=be.useState(()=>new Je(0,0,-1)),[E]=be.useState(()=>new Vt),[Y]=be.useState(()=>new Je),[y]=be.useState(()=>new Je),[C]=be.useState(()=>new Vt),[k]=be.useState(()=>new gr),[W]=be.useState(()=>new da),z=be.useCallback(()=>{var v;const x=F.current.parent||((v=F.current)==null?void 0:v.__r3f.parent);if(!x||(R.setFromMatrixPosition(x.matrixWorld),S.setFromMatrixPosition(g.matrixWorld),D.extractRotation(x.matrixWorld),U.set(0,0,1),U.applyMatrix4(D),R.addScaledVector(U,f),Y.subVectors(R,S),Y.dot(U)>0))return;Y.reflect(U).negate(),Y.add(R),D.extractRotation(g.matrixWorld),P.set(0,0,-1),P.applyMatrix4(D),P.add(S),y.subVectors(R,P),y.reflect(U).negate(),y.add(R),W.position.copy(Y),W.up.set(0,1,0),W.up.applyMatrix4(D),W.up.reflect(U),W.lookAt(y),W.far=g.far,W.updateMatrixWorld(),W.projectionMatrix.copy(g.projectionMatrix),k.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),k.multiply(W.projectionMatrix),k.multiply(W.matrixWorldInverse),k.multiply(x.matrixWorld),b.setFromNormalAndCoplanarPoint(U,R),b.applyMatrix4(W.matrixWorldInverse),E.set(b.normal.x,b.normal.y,b.normal.z,b.constant);const _=W.projectionMatrix;C.x=(Math.sign(E.x)+_.elements[8])/_.elements[0],C.y=(Math.sign(E.y)+_.elements[9])/_.elements[5],C.z=-1,C.w=(1+_.elements[10])/_.elements[14],E.multiplyScalar(2/E.dot(C)),_.elements[2]=E.x,_.elements[6]=E.y,_.elements[10]=E.z+1,_.elements[14]=E.w},[g,f]),[Q,ee,O,A]=be.useMemo(()=>{const v={minFilter:ut,magFilter:ut,type:vn},x=new xr(d,d,v);x.depthBuffer=!0,x.depthTexture=new va(d,d),x.depthTexture.format=pa,x.depthTexture.type=ma;const _=new xr(d,d,v),M=new bo({gl:m,resolution:d,width:u[0],height:u[1],minDepthThreshold:t,maxDepthThreshold:e,depthScale:a,depthToBlurRatioBias:i}),T={mirror:n,textureMatrix:k,mixBlur:c,tDiffuse:x.texture,tDepth:x.depthTexture,tDiffuseBlur:_.texture,hasBlur:w,mixStrength:r,minDepthThreshold:t,maxDepthThreshold:e,depthScale:a,depthToBlurRatioBias:i,distortion:o,distortionMap:l,mixContrast:s,"defines-USE_BLUR":w?"":void 0,"defines-USE_DEPTH":a>0?"":void 0,"defines-USE_DISTORTION":l?"":void 0};return[x,_,M,T]},[m,u,k,d,n,w,c,r,t,e,a,i,o,l,s]);return wr(()=>{var v;const x=F.current.parent||((v=F.current)==null?void 0:v.__r3f.parent);if(!x)return;x.visible=!1;const _=m.xr.enabled,M=m.shadowMap.autoUpdate;z(),m.xr.enabled=!1,m.shadowMap.autoUpdate=!1,m.setRenderTarget(Q),m.state.buffers.depth.setMask(!0),m.autoClear||m.clear(),m.render(G,W),w&&O.render(m,Q,ee),m.xr.enabled=_,m.shadowMap.autoUpdate=M,x.visible=!0,m.setRenderTarget(null)}),be.createElement("meshReflectorMaterialImpl",hn({attach:"material",key:"key"+A["defines-USE_BLUR"]+A["defines-USE_DEPTH"]+A["defines-USE_DISTORTION"],ref:F},A,h))}),So=be.forwardRef(({children:c,enabled:r=!0,speed:d=1,rotationIntensity:u=1,floatIntensity:t=1,floatingRange:e=[-.1,.1],autoInvalidate:a=!1,...i},n)=>{const o=be.useRef(null);be.useImperativeHandle(n,()=>o.current,[]);const s=be.useRef(Math.random()*1e4);return wr(l=>{var f,h;if(!r||d===0)return;a&&l.invalidate();const p=s.current+l.clock.elapsedTime;o.current.rotation.x=Math.cos(p/4*d)/8*u,o.current.rotation.y=Math.sin(p/4*d)/8*u,o.current.rotation.z=Math.sin(p/4*d)/20*u;let m=Math.sin(p/4*d)/10;m=ga.mapLinear(m,-.1,.1,(f=e==null?void 0:e[0])!==null&&f!==void 0?f:-.1,(h=e==null?void 0:e[1])!==null&&h!==void 0?h:.1),o.current.position.y=m*t,o.current.updateMatrix()}),be.createElement("group",i,be.createElement("group",{ref:o,matrixAutoUpdate:!1},c))}),Sr=[{id:"bamboo",name:"",description:"",image:"https://images.unsplash.com/photo-1595513046791-c87a6f0c3947?w=800",position:[-4,1.5,-3],rotation:[0,.3,0],link:"/experience/bamboo-weaving"},{id:"paper",name:"",description:"15002009",image:"https://images.unsplash.com/photo-1582719478250-c89cae4dc85b?w=800",position:[0,1.5,-4],rotation:[0,0,0],link:"/experience/paper-cutting"},{id:"terrace",name:"",description:"13002013",image:"https://images.unsplash.com/photo-1605000797499-95a51c5269ae?w=800",position:[4,1.5,-3],rotation:[0,-.3,0],link:"/experience/hani-terrace"}];function wo({exhibit:c,isActive:r,onClick:d}){const u=be.useRef(null),[t,e]=be.useState(!1);return wr(a=>{u.current&&(u.current.position.y=c.position[1]+Math.sin(a.clock.elapsedTime+c.position[0])*.05)}),H.jsxs("group",{position:c.position,rotation:c.rotation,children:[H.jsxs("mesh",{ref:u,onClick:d,onPointerOver:()=>e(!0),onPointerOut:()=>e(!1),children:[H.jsx("boxGeometry",{args:[2.2,1.5,.1]}),H.jsx("meshStandardMaterial",{color:r?"#D97706":t?"#92400E":"#1C1917",metalness:.8,roughness:.2})]}),H.jsxs("mesh",{position:[0,0,.06],children:[H.jsx("planeGeometry",{args:[2,1.3]}),H.jsx("meshBasicMaterial",{color:"#374151"})]}),(t||r)&&H.jsxs("mesh",{position:[0,0,.05],children:[H.jsx("ringGeometry",{args:[1.12,1.15,4]}),H.jsx("meshBasicMaterial",{color:"#F59E0B",transparent:!0,opacity:.6})]}),H.jsx(mo,{position:[0,-1,.1],fontSize:.15,color:r?"#F59E0B":"#FFFFFF",anchorX:"center",anchorY:"middle",font:"/fonts/noto-sans-sc.woff",children:c.name}),t&&H.jsx(xa,{position:[0,.9,.2],center:!0,children:H.jsx("div",{className:"bg-black/80 backdrop-blur px-3 py-1 rounded-full text-white text-xs whitespace-nowrap",children:""})})]})}function To(){return H.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.5,0],receiveShadow:!0,children:[H.jsx("planeGeometry",{args:[30,30]}),H.jsx(Uo,{blur:[300,100],resolution:1024,mixBlur:1,mixStrength:40,roughness:1,depthScale:1.2,minDepthThreshold:.4,maxDepthThreshold:1.4,color:"#050505",metalness:.5,mirror:.5})]})}function ko(){return H.jsxs(H.Fragment,{children:[H.jsx("ambientLight",{intensity:.3}),H.jsx("spotLight",{position:[0,10,0],angle:.5,penumbra:1,intensity:1,castShadow:!0}),H.jsx("pointLight",{position:[-5,5,-5],intensity:.5,color:"#F59E0B"}),H.jsx("pointLight",{position:[5,5,-5],intensity:.5,color:"#3B82F6"})]})}function Fo(){return H.jsx(H.Fragment,{children:[[-6,0,-6],[6,0,-6],[-6,0,2],[6,0,2]].map((c,r)=>H.jsxs("mesh",{position:c,children:[H.jsx("cylinderGeometry",{args:[.3,.3,4,32]}),H.jsx("meshStandardMaterial",{color:"#1C1917",metalness:.9,roughness:.1})]},r))})}function Do(){return H.jsx(H.Fragment,{children:Array.from({length:10}).map((c,r)=>H.jsx(So,{speed:1+Math.random(),rotationIntensity:.5,floatIntensity:.5,position:[(Math.random()-.5)*12,2+Math.random()*2,(Math.random()-.5)*8-2],children:H.jsxs("mesh",{children:[H.jsx("sphereGeometry",{args:[.05+Math.random()*.1,16,16]}),H.jsx("meshStandardMaterial",{color:["#F59E0B","#3B82F6","#10B981","#EC4899"][r%4],emissive:["#F59E0B","#3B82F6","#10B981","#EC4899"][r%4],emissiveIntensity:.5})]})},r))})}function Mo({activeExhibit:c,onExhibitClick:r}){return H.jsxs(H.Fragment,{children:[H.jsx(Hn,{makeDefault:!0,position:[0,2,6],fov:60}),H.jsx(Nn,{enablePan:!1,minDistance:3,maxDistance:10,minPolarAngle:Math.PI/4,maxPolarAngle:Math.PI/2.2,target:[0,1,-2]}),H.jsx(ko,{}),H.jsx(To,{}),H.jsx(Fo,{}),H.jsx(Do,{}),Sr.map(d=>H.jsx(wo,{exhibit:d,isActive:c===d.id,onClick:()=>r(d.id)},d.id)),H.jsx(Xn,{preset:"night"})]})}function Co(){return H.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-ink-950",children:H.jsxs("div",{className:"text-center",children:[H.jsx("div",{className:"w-16 h-16 border-4 border-heritage-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),H.jsx("p",{className:"text-white text-lg",children:"..."})]})})}function zo(){const[c,r]=be.useState(null),[d,u]=be.useState(!1),t=Sr.find(e=>e.id===c);return H.jsxs("div",{className:"fixed inset-0 bg-ink-950",children:[H.jsx(be.Suspense,{fallback:H.jsx(Co,{}),children:H.jsx(jn,{shadows:!0,dpr:[1,2],children:H.jsx(Mo,{activeExhibit:c,onExhibitClick:r})})}),H.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 flex items-center justify-between z-10",children:[H.jsxs(Kr,{to:"/",className:"flex items-center gap-2 px-4 py-2 bg-black/50 backdrop-blur rounded-full text-white hover:bg-black/70 transition-colors",children:[H.jsx(Wn,{className:"w-5 h-5"}),""]}),H.jsxs("div",{className:"flex items-center gap-2",children:[H.jsx("button",{className:"p-2 bg-black/50 backdrop-blur rounded-full text-white hover:bg-black/70 transition-colors",children:H.jsx(Rn,{className:"w-5 h-5"})}),H.jsx("button",{className:"p-2 bg-black/50 backdrop-blur rounded-full text-white hover:bg-black/70 transition-colors",children:H.jsx(ya,{className:"w-5 h-5"})}),H.jsx("button",{className:"p-2 bg-black/50 backdrop-blur rounded-full text-white hover:bg-black/70 transition-colors",children:H.jsx(zn,{className:"w-5 h-5"})})]})]}),H.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 z-10",children:H.jsxs("div",{className:"max-w-2xl mx-auto",children:[H.jsx("div",{className:"flex items-center justify-center gap-4 mb-4",children:Sr.map(e=>H.jsx("button",{onClick:()=>r(e.id),className:`
                  px-4 py-2 rounded-full text-sm font-medium transition-all
                  ${c===e.id?"bg-heritage-500 text-white scale-105":"bg-black/50 text-white/70 hover:bg-black/70 hover:text-white"}
                `,children:e.name},e.id))}),H.jsx("p",{className:"text-center text-white/50 text-sm",children:"    "})]})}),H.jsx(Gn,{children:t&&H.jsxs(Ln.div,{initial:{opacity:0,x:300},animate:{opacity:1,x:0},exit:{opacity:0,x:300},className:"absolute top-20 right-4 bottom-20 w-80 bg-black/80 backdrop-blur-xl rounded-2xl p-6 z-10",children:[H.jsx("button",{onClick:()=>r(null),className:"absolute top-4 right-4 p-1 hover:bg-white/10 rounded-full",children:H.jsx(Pn,{className:"w-5 h-5 text-white"})}),H.jsxs("div",{className:"h-full flex flex-col",children:[H.jsx("div",{className:"mb-4",children:H.jsx("span",{className:"px-2 py-1 bg-heritage-500/20 text-heritage-400 text-xs rounded-full",children:""})}),H.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:t.name}),H.jsx("p",{className:"text-white/70 text-sm leading-relaxed mb-6",children:t.description}),H.jsx("div",{className:"mt-auto",children:H.jsx(Kr,{to:t.link,className:"block w-full py-3 bg-gradient-to-r from-heritage-500 to-primary-500 text-white text-center rounded-xl font-semibold hover:shadow-lg hover:shadow-heritage-500/25 transition-all",children:""})})]})]})}),H.jsx("div",{className:"absolute bottom-20 left-4 z-10",children:H.jsxs("div",{className:"bg-black/50 backdrop-blur rounded-xl p-4 max-w-xs",children:[H.jsxs("div",{className:"flex items-center gap-2 text-heritage-400 text-sm mb-2",children:[H.jsx(Vn,{className:"w-4 h-4"}),""]}),H.jsx("p",{className:"text-white/70 text-xs",children:" "})]})})]})}export{zo as default};
