import{r as e,_ as s,j as t}from"./three-vendor-BoyHWg1a.js";import{h as a,u as l,a as i,i as n,P as c,c as r,E as x}from"./index-DkRoqGlp.js";import{u as o}from"./ecoAchievementStore-30xRUVWQ.js";import{L as d,E as m,T as h,ad as u,m as p,D as j,u as b,aG as f,aH as g}from"./ui-vendor-BCOa7pYq.js";function N({variant:N="default",customMessage:w,onShare:v,className:k}){const y=e.useRef(null),[C,$]=e.useState(!1),[_,S]=e.useState(!1),[T]=e.useState(w||a()),{totalPoints:D,currentLevel:E}=l(),{totalCarbonSaved:P,getEquivalentMetrics:L}=i(),{achievements:F}=o(),H=x[E],R=L(),A=F.filter(e=>e.unlocked),M=e.useCallback(async()=>{if(!y.current)return null;$(!0);try{const e=(await s(async()=>{const{default:e}=await import("./html2canvas.esm-BPY6V10C.js");return{default:e}},[])).default;return(await e(y.current,{scale:2,backgroundColor:"#ffffff",useCORS:!0})).toDataURL("image/png")}catch(e){return null}finally{$(!1)}},[]),I=e.useCallback(async()=>{const e=await M();if(e){const s=document.createElement("a");s.download=`ä¹¡é—è¯†-ç”Ÿæ€å¡ç‰‡-${Date.now()}.png`,s.href=e,s.click(),n("ä¸‹è½½åˆ†äº«å¡ç‰‡",c.share_social)}},[M]),O=e.useCallback(async()=>{const e=await M();if(e&&navigator.share)try{const s=await(await fetch(e)).blob(),t=new File([s],"ä¹¡é—è¯†-ç”Ÿæ€å¡ç‰‡.png",{type:"image/png"});await navigator.share({title:"ä¹¡é—è¯† - æˆ‘çš„ç”Ÿæ€è¶³è¿¹",text:T,files:[t]}),n("åˆ†äº«ç”Ÿæ€å¡ç‰‡",c.share_social),null==v||v()}catch(s){}else q()},[M,T,v]),q=e.useCallback(()=>{const e=`${T}\n\næˆ‘åœ¨ä¹¡é—è¯†ç´¯è®¡å‡ç¢³ ${s=P,s>=1e6?`${(s/1e6).toFixed(1)} å¨`:s>=1e3?`${(s/1e3).toFixed(1)} kg`:`${s} g`}ï¼Œç›¸å½“äºç§æ¤ ${R.treesPlanted} æ£µæ ‘ï¼\n\næ¥ä¸€èµ·æ¢ç´¢ç”Ÿæ€æ™ºæ…§å§ ğŸ‘‰ ${window.location.origin}`;var s;navigator.clipboard.writeText(e),S(!0),setTimeout(()=>S(!1),2e3),n("å¤åˆ¶åˆ†äº«é“¾æ¥",Math.floor(c.share_social/2))},[T,P,R.treesPlanted]);return t.jsxs("div",{className:r("space-y-4",k),children:[t.jsxs("div",{ref:y,className:"bg-gradient-to-br from-eco-50 via-white to-heritage-50 rounded-2xl p-6 border border-eco-200 shadow-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-heritage-500 to-primary-600 flex items-center justify-center",children:t.jsx(d,{className:"w-6 h-6 text-white"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-bold text-ink-800",children:"ä¹¡é—è¯†"}),t.jsx("p",{className:"text-xs text-ink-500",children:"æ¢å¯»ä¹¡æ‘ç”Ÿæ€æ™ºæ…§"})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-2xl",children:H.icon}),t.jsx("p",{className:"text-xs text-ink-500",children:H.name})]})]}),t.jsx("div",{className:"bg-white/80 rounded-xl p-4 mb-6 text-center",children:t.jsx("p",{className:"text-lg text-ink-700 font-medium",children:T})}),t.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[t.jsxs("div",{className:"bg-eco-100/80 rounded-xl p-3 text-center",children:[t.jsx(m,{className:"w-6 h-6 text-eco-600 mx-auto mb-1"}),t.jsx("p",{className:"text-xl font-bold text-eco-700",children:D}),t.jsx("p",{className:"text-xs text-ink-500",children:"ç»¿è‰²ç§¯åˆ†"})]}),t.jsxs("div",{className:"bg-carbon-100/80 rounded-xl p-3 text-center",children:[t.jsx(d,{className:"w-6 h-6 text-carbon-600 mx-auto mb-1"}),t.jsx("p",{className:"text-xl font-bold text-carbon-700",children:P>=1e3?`${(P/1e3).toFixed(1)}kg`:`${P}g`}),t.jsx("p",{className:"text-xs text-ink-500",children:"ç¢³å‡æ’"})]}),t.jsxs("div",{className:"bg-bamboo-100/80 rounded-xl p-3 text-center",children:[t.jsx(h,{className:"w-6 h-6 text-bamboo-600 mx-auto mb-1"}),t.jsx("p",{className:"text-xl font-bold text-bamboo-700",children:R.treesPlanted}),t.jsx("p",{className:"text-xs text-ink-500",children:"ç­‰æ•ˆç§æ ‘"})]})]}),A.length>0&&t.jsxs("div",{className:"mb-6",children:[t.jsx("p",{className:"text-xs text-ink-500 mb-2",children:"å·²è·å¾—æˆå°±"}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[A.slice(0,6).map(e=>t.jsxs("span",{className:"px-2 py-1 bg-heritage-100 rounded-full text-xs text-heritage-700 flex items-center gap-1",children:[t.jsx("span",{children:e.icon}),e.name]},e.id)),A.length>6&&t.jsxs("span",{className:"px-2 py-1 bg-ink-100 rounded-full text-xs text-ink-500",children:["+",A.length-6]})]})]}),t.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-eco-200",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(u,{className:"w-8 h-8 text-ink-300"}),t.jsxs("div",{className:"text-xs text-ink-400",children:[t.jsx("p",{children:"æ‰«ç ä½“éªŒ"}),t.jsx("p",{children:"ä¹¡é—è¯†"})]})]}),t.jsx("p",{className:"text-xs text-ink-400",children:(new Date).toLocaleDateString("zh-CN")})]})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs(p.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:I,disabled:C,className:"flex-1 py-3 bg-eco-500 hover:bg-eco-600 text-white rounded-xl font-medium flex items-center justify-center gap-2 transition-colors disabled:opacity-50",children:[t.jsx(j,{className:"w-5 h-5"}),C?"ç”Ÿæˆä¸­...":"ä¿å­˜å›¾ç‰‡"]}),t.jsxs(p.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:O,disabled:C,className:"flex-1 py-3 bg-heritage-500 hover:bg-heritage-600 text-white rounded-xl font-medium flex items-center justify-center gap-2 transition-colors disabled:opacity-50",children:[t.jsx(b,{className:"w-5 h-5"}),"åˆ†äº«"]}),t.jsx(p.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:q,className:"py-3 px-4 bg-ink-100 hover:bg-ink-200 text-ink-700 rounded-xl font-medium flex items-center justify-center gap-2 transition-colors",children:_?t.jsx(f,{className:"w-5 h-5 text-eco-500"}):t.jsx(g,{className:"w-5 h-5"})})]}),t.jsxs("p",{className:"text-xs text-ink-400 text-center",children:["åˆ†äº«å¯è·å¾— ",c.share_social," ç»¿è‰²ç§¯åˆ†"]})]})}export{N as S};
