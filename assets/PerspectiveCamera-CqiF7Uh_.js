import{u as p,a as F,_ as R}from"./OrbitControls-BPu6_TR5.js";import{r as t}from"./index-CCr_emsx.js";import{W as T,H as v,L as b,t as x,K as L}from"./three.module-C2hvsvVY.js";function w(n,y,g){const f=p(r=>r.size),c=p(r=>r.viewport),a=typeof n=="number"?n:f.width*c.dpr,u=f.height*c.dpr,l=(typeof n=="number"?g:n)||{},{samples:i=0,depth:m,...s}=l,o=t.useMemo(()=>{const r=new T(a,u,{minFilter:b,magFilter:b,type:v,...s});return m&&(r.depthTexture=new x(a,u,L)),r.samples=i,r},[]);return t.useLayoutEffect(()=>{o.setSize(a,u),i&&(o.samples=i)},[i,o,a,u]),t.useEffect(()=>()=>o.dispose(),[]),o}const _=n=>typeof n=="function",I=t.forwardRef(({envMap:n,resolution:y=256,frames:g=1/0,makeDefault:f,children:c,...a},u)=>{const l=p(({set:e})=>e),i=p(({camera:e})=>e),m=p(({size:e})=>e),s=t.useRef(null);t.useImperativeHandle(u,()=>s.current,[]);const o=t.useRef(null),r=w(y);t.useLayoutEffect(()=>{a.manual||(s.current.aspect=m.width/m.height)},[m,a]),t.useLayoutEffect(()=>{s.current.updateProjectionMatrix()});let h=0,E=null;const d=_(c);return F(e=>{d&&(g===1/0||h<g)&&(o.current.visible=!1,e.gl.setRenderTarget(r),E=e.scene.background,n&&(e.scene.background=n),e.gl.render(e.scene,s.current),e.scene.background=E,e.gl.setRenderTarget(null),o.current.visible=!0,h++)}),t.useLayoutEffect(()=>{if(f){const e=i;return l(()=>({camera:s.current})),()=>l(()=>({camera:e}))}},[s,f,l]),t.createElement(t.Fragment,null,t.createElement("perspectiveCamera",R({ref:s},a),!d&&c),t.createElement("group",{ref:o},d&&c(r.texture)))});export{I as P};
