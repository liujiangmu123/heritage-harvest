const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/hands-BXvxRdiq.js","assets/index-CIFreg_9.js","assets/index-X7sjaMD2.css","assets/camera_utils-BrV3Ya08.js"])))=>i.map(i=>d[i]);
import{c as de,r as i,j as e,A as re,m as Y,H as fe,S as xe,_ as ae}from"./index-CIFreg_9.js";import{u as oe,a as z,_ as pe,C as ge,O as ye}from"./OrbitControls-CcGKTEhn.js";import{W as ie,P as ve,b as je,a as be,C as Me,k as ce,V as D,x as $,D as O,A as _,w as we}from"./three.module-C2hvsvVY.js";import{B as Q}from"./Button-CAZ9oYUG.js";import{C as le}from"./camera-CG0fsqJh.js";import{R as ue}from"./rotate-ccw-B2lbR2yx.js";import{P as Re}from"./play-PxQ9HxQM.js";import{C as Pe}from"./chevron-right-B_0CgUWH.js";import{I as Ne}from"./info-CAWq1lxm.js";import{E as Se}from"./Environment-D_QvMNrM.js";import{u as Te}from"./Progress-G2MA8nKt.js";import{H as Ce}from"./Html-D158LjGk.js";import{P as ke}from"./PerspectiveCamera-Bo8LCB21.js";import"./constants-Ck1MbfUW.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=de("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=de("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),Fe={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},Ie={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `},Ge=i.forwardRef(({scale:a=10,frames:y=1/0,opacity:d=1,width:f=1,height:u=1,blur:j=1,near:b=0,far:M=10,resolution:P=512,smooth:N=!0,color:v="#000000",depthWrite:h=!1,renderOrder:c,...n},s)=>{const r=i.useRef(null),t=oe(A=>A.scene),o=oe(A=>A.gl),l=i.useRef(null);f=f*(Array.isArray(a)?a[0]:a||1),u=u*(Array.isArray(a)?a[1]:a||1);const[m,g,S,x,p,w,T]=i.useMemo(()=>{const A=new ie(P,P),E=new ie(P,P);E.texture.generateMipmaps=A.texture.generateMipmaps=!1;const q=new ve(f,u).rotateX(Math.PI/2),L=new je(q),B=new be;B.depthTest=B.depthWrite=!1,B.onBeforeCompile=H=>{H.uniforms={...H.uniforms,ucolor:{value:new Me(v)}},H.fragmentShader=H.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
           void main() {
          `),H.fragmentShader=H.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};const Z=new ce(Fe),X=new ce(Ie);return X.depthTest=Z.depthTest=!1,[A,q,B,L,Z,X,E]},[P,f,u,a,v]),k=A=>{x.visible=!0,x.material=p,p.uniforms.tDiffuse.value=m.texture,p.uniforms.h.value=A*1/256,o.setRenderTarget(T),o.render(x,l.current),x.material=w,w.uniforms.tDiffuse.value=T.texture,w.uniforms.v.value=A*1/256,o.setRenderTarget(m),o.render(x,l.current),x.visible=!1};let G=0,I,F;return z(()=>{l.current&&(y===1/0||G<y)&&(G++,I=t.background,F=t.overrideMaterial,r.current.visible=!1,t.background=null,t.overrideMaterial=S,o.setRenderTarget(m),o.render(t,l.current),k(j),N&&k(j*.4),o.setRenderTarget(null),r.current.visible=!0,t.overrideMaterial=F,t.background=I)}),i.useImperativeHandle(s,()=>r.current,[]),i.createElement("group",pe({"rotation-x":Math.PI/2},n,{ref:r}),i.createElement("mesh",{renderOrder:c,geometry:g,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},i.createElement("meshBasicMaterial",{transparent:!0,map:m.texture,opacity:d,depthWrite:h})),i.createElement("orthographicCamera",{ref:l,args:[-f/2,f/2,u/2,-u/2,b,M]}))});function Ue(a,y){const[d,f]=i.useState({isTracking:!1,landmarks:null,gesture:"none",handedness:null,isLoading:!1,error:null,rotation:0,rotationSpeed:0,palmCenter:null}),u=i.useRef(null),j=i.useRef(null),b=i.useRef([]),M=i.useRef("none"),P=i.useRef({}),N=i.useRef(0),v=i.useRef([]),h=s=>{const r=s[0],t=s[9],o=s[5],l=s[17],m={x:(r.x+t.x+o.x+l.x)/4,y:(r.y+t.y+o.y+l.y)/4},g=l.x-o.x,S=l.y-o.y,x=Math.atan2(S,g)*(180/Math.PI)+180,p=v.current;p.push(x),p.length>5&&p.shift();let w=0;if(p.length>=2){let T=p[p.length-1]-p[p.length-2];T>180&&(T-=360),T<-180&&(T+=360),w=T}return N.current=x,{rotation:x,speed:w,center:m}},c=s=>{const r=b.current;r.push(s),r.length>8&&r.shift();const t={};r.forEach(m=>{t[m]=(t[m]||0)+1});let o=0,l="none";return Object.entries(t).forEach(([m,g])=>{g>o&&(o=g,l=m)}),l!==M.current?(P.current[l]=(P.current[l]||0)+1,P.current[l]>=3&&(M.current=l,P.current={})):P.current={},M.current},n=s=>{if(!s||s.length<21)return"none";const r=s[4],t=s[3],o=s[8],l=s[6],m=s[12],g=s[10],S=s[16],x=s[14],p=s[20],w=s[18],T=(L,B)=>Math.sqrt((L.x-B.x)**2+(L.y-B.y)**2),k=(L,B)=>L.y<B.y-.02,G=r.x<t.x-.02||r.x>t.x+.02,I=k(o,l),F=k(m,g),A=k(S,x),E=k(p,w);return T(r,o)<.06&&!F&&!A?"pinch":G&&!I&&!F&&!A&&!E?"thumbsUp":I&&F&&!A&&!E?"peace":I&&!F&&!A&&!E?"pointing":!I&&!F&&!A&&!E?"fist":I&&F&&A&&E?"open":"none"};return i.useEffect(()=>{var t,o,l,m;if(!y||!a.current)return;if(u.current&&j.current){console.log("æ‰‹éƒ¨è¿½è¸ªå·²åœ¨è¿è¡Œä¸­");return}let s=!0;return u.current&&((o=(t=u.current).close)==null||o.call(t),u.current=null),j.current&&((m=(l=j.current).stop)==null||m.call(l),j.current=null),b.current=[],M.current="none",v.current=[],f(g=>({...g,isLoading:!0,error:null})),(async()=>{try{console.log("å¼€å§‹åŠ è½½MediaPipe Hands...");const{Hands:g}=await ae(async()=>{const{Hands:p}=await import("./hands-BXvxRdiq.js").then(w=>w.h);return{Hands:p}},__vite__mapDeps([0,1,2])),{Camera:S}=await ae(async()=>{const{Camera:p}=await import("./camera_utils-BrV3Ya08.js").then(w=>w.c);return{Camera:p}},__vite__mapDeps([3,1,2]));console.log("MediaPipeåŠ è½½æˆåŠŸï¼Œåˆå§‹åŒ–ä¸­...");const x=new g({locateFile:p=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${p}`});if(x.setOptions({maxNumHands:1,modelComplexity:1,minDetectionConfidence:.5,minTrackingConfidence:.5}),x.onResults(p=>{var w,T;if(s)if(p.multiHandLandmarks&&p.multiHandLandmarks.length>0){const k=p.multiHandLandmarks[0],G=((T=(w=p.multiHandedness)==null?void 0:w[0])==null?void 0:T.label)||null,I=n(k),F=c(I),A=h(k);f(E=>({...E,isTracking:!0,landmarks:k,gesture:F,handedness:G,isLoading:!1,rotation:A.rotation,rotationSpeed:A.speed,palmCenter:A.center}))}else f(k=>({...k,isTracking:!1,landmarks:null,gesture:c("none"),rotationSpeed:0,palmCenter:null}))}),u.current=x,a.current){console.log("å¯åŠ¨æ‘„åƒå¤´...");const p=new S(a.current,{onFrame:async()=>{u.current&&a.current&&await u.current.send({image:a.current})},width:640,height:480});j.current=p,await p.start(),console.log("æ‘„åƒå¤´å¯åŠ¨æˆåŠŸ"),f(w=>({...w,isLoading:!1}))}}catch(g){console.error("æ‰‹éƒ¨è¿½è¸ªåˆå§‹åŒ–å¤±è´¥:",g),f(S=>({...S,isLoading:!1,error:g instanceof Error?g.message:"åˆå§‹åŒ–å¤±è´¥"}))}})(),()=>{var g,S,x,p;console.log("æ¸…ç†æ‰‹éƒ¨è¿½è¸ª..."),s=!1,j.current&&((S=(g=j.current).stop)==null||S.call(g),j.current=null),u.current&&((p=(x=u.current).close)==null||p.call(x),u.current=null),f({isTracking:!1,landmarks:null,gesture:"none",handedness:null,isLoading:!1,error:null,rotation:0,rotationSpeed:0,palmCenter:null})}},[y]),d}function Ee(){const{progress:a}=Te();return e.jsx(Ce,{center:!0,children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-palace-500 border-t-transparent rounded-full animate-spin"}),e.jsxs("p",{className:"text-palace-600 font-medium",children:["åŠ è½½ä¸­ ",a.toFixed(0),"%"]})]})})}function Be(){const a=i.useRef(null),y="#0a0a0a",d="#1a1a1a",f="#8B7355";z(h=>{if(a.current){const c=Math.sin(h.clock.elapsedTime*.5)*.002;a.current.scale.setScalar(1+c)}});const u=[{y:0,r:.35},{y:.15,r:.38},{y:.3,r:.42},{y:.5,r:.5},{y:.8,r:.55},{y:1,r:.52},{y:1.2,r:.48},{y:1.4,r:.4},{y:1.6,r:.32},{y:1.8,r:.26},{y:2,r:.24},{y:2.2,r:.28},{y:2.4,r:.35},{y:2.6,r:.42},{y:2.8,r:.47},{y:3,r:.5}],j=Array.from({length:16}).map((h,c)=>{const n=c/16*Math.PI*2,s=c%2===0?.02:-.02,r=u.map((t,o)=>new D(t.r*Math.cos(n+s*o),t.y,t.r*Math.sin(n+s*o)));return new $(r,!1,"catmullrom",.3)}),b=[.08,.35,.7,1.1,1.5,1.9,2.5,2.95],M=h=>{for(let c=0;c<u.length-1;c++)if(h>=u[c].y&&h<=u[c+1].y){const n=(h-u[c].y)/(u[c+1].y-u[c].y);return u[c].r+n*(u[c+1].r-u[c].r)}return .35},P=[];for(let h=0;h<3;h++){const c=.5+h*.25;for(let n=0;n<8;n++){const s=n/8*Math.PI*2,r=M(c)+.01,t=[new D(r*Math.cos(s),c,r*Math.sin(s)),new D((r+.02)*Math.cos(s+.15),c+.12,(r+.02)*Math.sin(s+.15)),new D(r*Math.cos(s+.3),c+.24,r*Math.sin(s+.3))];P.push(new $(t))}}const N=[];for(let h=0;h<=40;h++){const c=h/40,n=1.8+c*.6,s=M(n)+.015,r=c*Math.PI*3;N.push(new D(s*Math.cos(r),n,s*Math.sin(r)))}const v=new $(N);return e.jsxs("group",{ref:a,children:[j.map((h,c)=>e.jsxs("mesh",{castShadow:!0,receiveShadow:!0,children:[e.jsx("tubeGeometry",{args:[h,64,c%2===0?.014:.01,8,!1]}),e.jsx("meshStandardMaterial",{color:c%2===0?y:d,metalness:.95,roughness:.15,envMapIntensity:1.2})]},`main-${c}`)),b.map((h,c)=>{const n=M(h);return e.jsxs("group",{children:[e.jsxs("mesh",{position:[0,h,0],rotation:[-Math.PI/2,0,0],castShadow:!0,children:[e.jsx("torusGeometry",{args:[n,.012,8,64]}),e.jsx("meshStandardMaterial",{color:y,metalness:.95,roughness:.12})]}),c%2===0&&e.jsxs("mesh",{position:[0,h+.02,0],rotation:[-Math.PI/2,0,0],castShadow:!0,children:[e.jsx("torusGeometry",{args:[n-.01,.006,6,64]}),e.jsx("meshStandardMaterial",{color:f,metalness:.8,roughness:.25})]})]},`ring-group-${c}`)}),P.map((h,c)=>e.jsxs("mesh",{castShadow:!0,children:[e.jsx("tubeGeometry",{args:[h,16,.004,4,!1]}),e.jsx("meshStandardMaterial",{color:f,metalness:.85,roughness:.2})]},`diamond-${c}`)),e.jsxs("mesh",{castShadow:!0,children:[e.jsx("tubeGeometry",{args:[v,48,.005,6,!1]}),e.jsx("meshStandardMaterial",{color:f,metalness:.85,roughness:.2})]}),[{y:0,r1:.38,r2:.42,h:.02,color:d},{y:-.025,r1:.42,r2:.48,h:.03,color:y},{y:-.06,r1:.48,r2:.52,h:.04,color:d},{y:-.11,r1:.44,r2:.48,h:.06,color:y}].map((h,c)=>e.jsxs("mesh",{position:[0,h.y,0],castShadow:!0,receiveShadow:!0,children:[e.jsx("cylinderGeometry",{args:[h.r1,h.r2,h.h,48]}),e.jsx("meshStandardMaterial",{color:h.color,metalness:.92,roughness:.15})]},`base-${c}`)),e.jsxs("mesh",{position:[0,-.03,0],rotation:[-Math.PI/2,0,0],children:[e.jsx("torusGeometry",{args:[.45,.008,6,48]}),e.jsx("meshStandardMaterial",{color:f,metalness:.9,roughness:.2,emissive:f,emissiveIntensity:.1})]}),e.jsxs("mesh",{position:[0,3,0],rotation:[-Math.PI/2,0,0],castShadow:!0,children:[e.jsx("torusGeometry",{args:[.5,.018,8,64]}),e.jsx("meshStandardMaterial",{color:y,metalness:.95,roughness:.1})]}),e.jsxs("mesh",{position:[0,2.98,0],rotation:[-Math.PI/2,0,0],children:[e.jsx("torusGeometry",{args:[.485,.008,6,64]}),e.jsx("meshStandardMaterial",{color:f,metalness:.9,roughness:.15,emissive:f,emissiveIntensity:.15})]}),e.jsxs("mesh",{position:[0,2.96,0],rotation:[-Math.PI/2,0,0],castShadow:!0,children:[e.jsx("torusGeometry",{args:[.47,.012,8,64]}),e.jsx("meshStandardMaterial",{color:d,metalness:.92,roughness:.12})]})]})}function Le({isComplete:a}){const y=i.useRef(null),d=i.useRef(null),f=i.useRef(null),u=i.useRef(null),j=i.useRef(0);if(z((v,h)=>{if(!a){j.current=0;return}j.current=Math.min(j.current+h*.5,1);const c=j.current,n=v.clock.elapsedTime;if(y.current&&(y.current.rotation.y=n*.3),d.current&&d.current.children.forEach((s,r)=>{const t=(n+r*.5)%3,o=1+t*.5,l=Math.max(0,1-t/3);s.scale.setScalar(o),s.material&&(s.material.opacity=l*c),s.rotation.z=n*(.2+r*.1)}),f.current){const s=f.current.geometry.attributes.position.array;for(let r=0;r<s.length/3;r++){const t=r/(s.length/3)*Math.PI*8+n,o=(r*.05+n*.5)%4-.5,l=.3+Math.sin(o*2)*.2;s[r*3]=Math.cos(t)*l,s[r*3+1]=o,s[r*3+2]=Math.sin(t)*l}f.current.geometry.attributes.position.needsUpdate=!0}if(u.current){const s=u.current.geometry.attributes.position.array;for(let r=0;r<s.length/3;r++){const t=r/(s.length/3)*Math.PI*2,o=.5+r%5*.2,l=n*o%2,m=1.5+Math.sin(t*3+n)*.3;s[r*3]=Math.cos(t+n*.5)*l,s[r*3+1]=m,s[r*3+2]=Math.sin(t+n*.5)*l}u.current.geometry.attributes.position.needsUpdate=!0}}),!a)return null;const b=80,M=new Float32Array(b*3),P=60,N=new Float32Array(P*3);for(let v=0;v<b;v++)M[v*3]=0,M[v*3+1]=v*.05,M[v*3+2]=0;for(let v=0;v<P;v++)N[v*3]=0,N[v*3+1]=1.5,N[v*3+2]=0;return e.jsxs("group",{ref:y,children:[e.jsx("group",{ref:d,position:[0,1.5,0],children:[0,1,2].map(v=>e.jsxs("mesh",{rotation:[Math.PI/2,0,0],children:[e.jsx("ringGeometry",{args:[.4+v*.1,.45+v*.1,64]}),e.jsx("meshBasicMaterial",{color:"#FFD700",transparent:!0,opacity:.6,side:O})]},v))}),e.jsxs("mesh",{position:[0,1.5,0],children:[e.jsx("cylinderGeometry",{args:[.02,.15,4,16,1,!0]}),e.jsx("meshBasicMaterial",{color:"#FFD700",transparent:!0,opacity:.3,side:O})]}),e.jsxs("points",{ref:f,children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",count:b,array:M,itemSize:3})}),e.jsx("pointsMaterial",{color:"#FFD700",size:.04,transparent:!0,opacity:.9,blending:_})]}),e.jsxs("points",{ref:u,children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",count:P,array:N,itemSize:3})}),e.jsx("pointsMaterial",{color:"#FFA500",size:.06,transparent:!0,opacity:.7,blending:_})]}),e.jsxs("mesh",{position:[0,3.2,0],children:[e.jsx("sphereGeometry",{args:[.15,32,32]}),e.jsx("meshBasicMaterial",{color:"#FFD700",transparent:!0,opacity:.8})]}),e.jsxs("mesh",{position:[0,3.2,0],children:[e.jsx("sphereGeometry",{args:[.25,32,32]}),e.jsx("meshBasicMaterial",{color:"#FFA500",transparent:!0,opacity:.3})]}),e.jsxs("mesh",{position:[0,0,0],rotation:[-Math.PI/2,0,0],children:[e.jsx("ringGeometry",{args:[.5,.8,64]}),e.jsx("meshBasicMaterial",{color:"#FFD700",transparent:!0,opacity:.4,side:O})]}),Array.from({length:12}).map((v,h)=>{const c=h/12*Math.PI*2;return e.jsxs("mesh",{position:[Math.cos(c)*.7,1+h%3*.5,Math.sin(c)*.7],children:[e.jsx("sphereGeometry",{args:[.025,8,8]}),e.jsx("meshBasicMaterial",{color:"#FFE4B5",transparent:!0,opacity:.8})]},h)})]})}function He({progress:a}){const y=i.useRef(null),d=[{y:0,r:.35},{y:.15,r:.38},{y:.3,r:.42},{y:.5,r:.5},{y:.8,r:.55},{y:1,r:.52},{y:1.2,r:.48},{y:1.4,r:.4},{y:1.6,r:.32},{y:1.8,r:.26},{y:2,r:.24},{y:2.2,r:.28},{y:2.4,r:.35},{y:2.6,r:.42},{y:2.8,r:.47},{y:3,r:.5}],f=t=>{for(let o=0;o<d.length-1;o++)if(t>=d[o].y&&t<=d[o+1].y){const l=(t-d[o].y)/(d[o+1].y-d[o].y);return d[o].r+l*(d[o+1].r-d[o].r)}return .35},u=i.useCallback((t=0,o=0)=>{const l=[];for(let S=0;S<=720;S++){const x=S/720,p=x*3,w=x*20*Math.PI*2+t,T=f(p),k=Math.sin(w*8)*.02,G=Math.sin(w*4)*.008,I=Math.sin(x*Math.PI*6)*.005,F=T+k+o+.015;l.push(new D(F*Math.cos(w),p+G+I,F*Math.sin(w)))}return new $(l,!1,"catmullrom",.2)},[]),j=i.useCallback((t=0)=>{const o=[];for(let g=0;g<=288;g++){const S=g/288,x=S*3,p=-S*12*Math.PI*2+t,w=f(x),T=Math.sin(p*6)*.015,k=w+T+.025;o.push(new D(k*Math.cos(p),x,k*Math.sin(p)))}return new $(o,!1,"catmullrom",.3)},[]),b=u(0,0),M=u(Math.PI/3,.01),P=j(0),N=j(Math.PI/2),v=t=>{const o=Math.floor(a*t.points.length);return o<2?null:new $(t.points.slice(0,Math.max(2,o)),!1,"catmullrom",.2)},h=v(b),c=v(M),n=v(P),s=v(N);if(!h)return null;const r={light:"#A67B4B",medium:"#8B5E34",dark:"#5D4E37",accent:"#C4956A"};return e.jsxs("group",{ref:y,children:[e.jsxs("mesh",{castShadow:!0,receiveShadow:!0,children:[e.jsx("tubeGeometry",{args:[h,Math.floor(a*600),.016,10,!1]}),e.jsx("meshStandardMaterial",{color:r.medium,roughness:.7,metalness:.05,envMapIntensity:.3})]}),c&&a>.05&&e.jsxs("mesh",{castShadow:!0,receiveShadow:!0,children:[e.jsx("tubeGeometry",{args:[c,Math.floor(a*500),.012,8,!1]}),e.jsx("meshStandardMaterial",{color:r.light,roughness:.65,metalness:.08})]}),n&&a>.1&&e.jsxs("mesh",{castShadow:!0,children:[e.jsx("tubeGeometry",{args:[n,Math.floor(a*250),.008,6,!1]}),e.jsx("meshStandardMaterial",{color:r.dark,roughness:.8,metalness:0})]}),s&&a>.15&&e.jsxs("mesh",{castShadow:!0,children:[e.jsx("tubeGeometry",{args:[s,Math.floor(a*200),.006,6,!1]}),e.jsx("meshStandardMaterial",{color:r.accent,roughness:.6,metalness:.1})]}),a>.2&&h&&e.jsxs("mesh",{children:[e.jsx("tubeGeometry",{args:[h,Math.floor(a*400),.02,8,!1]}),e.jsx("meshStandardMaterial",{color:r.accent,roughness:.4,metalness:.15,transparent:!0,opacity:.2})]}),a>0&&a<1&&e.jsxs("mesh",{position:[0,a*3,0],children:[e.jsx("torusGeometry",{args:[f(a*3)+.03,.015,8,32]}),e.jsx("meshBasicMaterial",{color:"#FFD700",transparent:!0,opacity:.4+Math.sin(Date.now()*.01)*.2})]})]})}function ze({progress:a,isWeaving:y}){const d=i.useRef(null),f=i.useRef(null),u=i.useRef(null),j=i.useRef(null),b=i.useRef(null),M=[{y:0,r:.35},{y:.3,r:.4},{y:.8,r:.55},{y:1.2,r:.5},{y:1.6,r:.35},{y:2,r:.25},{y:2.4,r:.35},{y:2.8,r:.45},{y:3,r:.5}],P=h=>{for(let c=0;c<M.length-1;c++)if(h>=M[c].y&&h<=M[c+1].y){const n=(h-M[c].y)/(M[c+1].y-M[c].y);return M[c].r+n*(M[c+1].r-M[c].r)}return .35};if(z(h=>{if(!d.current||a>=1)return;const c=18,n=a,s=n*3,r=n*c*Math.PI*2,t=P(s)+.05,o=t*Math.cos(r),l=t*Math.sin(r),m=h.clock.elapsedTime;if(d.current.position.set(o,s,l),f.current){const g=y?1+Math.sin(m*12)*.4:1+Math.sin(m*4)*.15;f.current.scale.setScalar(g)}if(u.current){u.current.rotation.z=m*2;const g=y?1.5+Math.sin(m*8)*.5:1+Math.sin(m*2)*.2;u.current.scale.setScalar(g)}j.current&&(j.current.rotation.x=Math.PI/2,j.current.rotation.z=-r),b.current&&(b.current.intensity=y?3:1)}),a>=1)return null;const N=y?"#FFD700":"#F2D974",v=y?"#FFA500":"#A73A36";return e.jsxs("group",{ref:d,children:[e.jsxs("mesh",{ref:f,children:[e.jsx("sphereGeometry",{args:[.03,16,16]}),e.jsx("meshStandardMaterial",{color:N,emissive:N,emissiveIntensity:y?4:1.5})]}),e.jsxs("mesh",{ref:u,children:[e.jsx("ringGeometry",{args:[.04,.08,6]}),e.jsx("meshBasicMaterial",{color:v,transparent:!0,opacity:y?.8:.4,side:O})]}),y&&e.jsxs("mesh",{ref:j,position:[0,0,0],children:[e.jsx("torusGeometry",{args:[.12,.008,8,32]}),e.jsx("meshBasicMaterial",{color:"#FFD700",transparent:!0,opacity:.5})]}),e.jsx("pointLight",{ref:b,color:N,intensity:2,distance:1,decay:2}),y&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[.08,.05,0],scale:.5,children:[e.jsx("sphereGeometry",{args:[.015,8,8]}),e.jsx("meshBasicMaterial",{color:"#FFE4B5",transparent:!0,opacity:.7})]}),e.jsxs("mesh",{position:[-.06,-.04,.05],scale:.4,children:[e.jsx("sphereGeometry",{args:[.015,8,8]}),e.jsx("meshBasicMaterial",{color:"#FFD700",transparent:!0,opacity:.6})]}),e.jsxs("mesh",{position:[.03,-.07,-.04],scale:.3,children:[e.jsx("sphereGeometry",{args:[.015,8,8]}),e.jsx("meshBasicMaterial",{color:"#FFA500",transparent:!0,opacity:.5})]})]})]})}function Ve({progress:a,isWeaving:y,rotationSpeed:d,palmCenter:f,viewMode:u}){const j=i.useRef(null),b=i.useRef(new D(2.5,2,2.5)),M=i.useRef(new D(0,.5,0)),P=i.useRef(0),N=i.useRef(0),v=i.useRef("outside"),h=c=>{const n=[{y:0,r:.35},{y:.8,r:.55},{y:1.6,r:.35},{y:2,r:.25},{y:2.8,r:.45},{y:3,r:.5}];for(let s=0;s<n.length-1;s++)if(c>=n[s].y&&c<=n[s+1].y){const r=(c-n[s].y)/(n[s+1].y-n[s].y);return n[s].r+r*(n[s+1].r-n[s].r)}return .4};return z((c,n)=>{if(!j.current)return;const s=a,r=c.clock.elapsedTime,t=s*3-1.5,o=s*18*Math.PI*2;if(y&&Math.abs(d)>3&&(P.current+=d*.005),u==="auto"&&y&&(N.current+=n,N.current>4)){N.current=0;const p=["outside","detail","inside"],w=p.indexOf(v.current);v.current=p[(w+1)%p.length]}const l=u==="auto"?v.current:u;let m,g,S=50;if(!y||s===0){const p=r*.12+P.current;m=new D(Math.cos(p)*3.2,1.2+Math.sin(r*.25)*.1,Math.sin(p)*3.2),g=new D(0,.2,0),S=45}else if(l==="overview"){const p=r*.1+P.current;m=new D(Math.cos(p)*4,2.5,Math.sin(p)*4),g=new D(0,.3,0),S=40}else if(l==="inside"){const p=h(t+1.5)*.3,w=r*.3+P.current;m=new D(Math.cos(w)*p,t+.2,Math.sin(w)*p);const T=h(t+1.5)+.05;g=new D(Math.cos(o)*T,t,Math.sin(o)*T),S=70}else if(l==="detail"){const p=h(t+1.5)+.4,w=o+Math.PI*.7;m=new D(Math.cos(w)*p,t+.15,Math.sin(w)*p);const T=h(t+1.5)+.05;g=new D(Math.cos(o)*T,t,Math.sin(o)*T),S=55}else{const p=s*Math.PI*2+P.current;let w=2.2,T=.6;s<.2?(w=3-s*4,T=1.2-s*3):s>.8&&(w=2.2+(s-.8)*4,T=.6+(s-.8)*2),m=new D(Math.cos(p)*w,t+T,Math.sin(p)*w),g=new D(0,t*.8,0),S=50}f&&y&&(m.x+=(f.x-.5)*.1,g.y+=(f.y-.5)*.05),m.y+=Math.sin(r*1.5)*.01;const x=l==="detail"?3:1.5;b.current.lerp(m,n*x),M.current.lerp(g,n*x),j.current.position.copy(b.current),j.current.lookAt(M.current),j.current.fov=we.lerp(j.current.fov,S,n*2),j.current.updateProjectionMatrix()}),e.jsx(ke,{ref:j,makeDefault:!0,fov:50})}function _e({progress:a,isWeaving:y}){const d=i.useRef(null),f=i.useRef(null),u=i.useRef(null),j=80,b=120,M=40,P=i.useRef(new Float32Array(j*3)),N=i.useRef(new Float32Array(b*3)),v=i.useRef(new Float32Array(M*3));return i.useEffect(()=>{for(let h=0;h<b;h++)N.current[h*3]=(Math.random()-.5)*2,N.current[h*3+1]=Math.random()*4-.5,N.current[h*3+2]=(Math.random()-.5)*2},[]),z(h=>{const c=h.clock.elapsedTime,n=a*3,s=a*18*Math.PI*2;if(d.current&&y){const r=d.current.geometry.attributes.position.array;for(let t=0;t<j;t++){const o=t/j,l=(c*2+o*3)%3,m=s+o*Math.PI*4+c*3,g=.3+Math.sin(o*Math.PI*2)*.15+l*.1,S=n-.5+l*.5;r[t*3]=Math.cos(m)*g,r[t*3+1]=S,r[t*3+2]=Math.sin(m)*g}d.current.geometry.attributes.position.needsUpdate=!0}if(f.current){const r=f.current.geometry.attributes.position.array;for(let t=0;t<b;t++){const o=N.current[t*3+1],l=Math.sin(c*.5+t*.1)*.02,m=y?c*.02:0;r[t*3]=N.current[t*3]+Math.sin(c+t)*.05,r[t*3+1]=(o+m)%4-.5,r[t*3+2]=N.current[t*3+2]+l}f.current.geometry.attributes.position.needsUpdate=!0}if(u.current&&y&&a>0){const r=u.current.geometry.attributes.position.array;for(let t=0;t<M;t++){const o=Math.max(0,a-t/M*.03),l=o*3,m=o*18*Math.PI*2,g=.5+Math.sin(m*8)*.02;r[t*3]=Math.cos(m)*g,r[t*3+1]=l,r[t*3+2]=Math.sin(m)*g}u.current.geometry.attributes.position.needsUpdate=!0}}),e.jsxs("group",{children:[y&&a<1&&e.jsxs("points",{ref:d,children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",count:j,array:P.current,itemSize:3})}),e.jsx("pointsMaterial",{color:"#FFD700",size:.025,transparent:!0,opacity:.9,blending:_})]}),e.jsxs("points",{ref:f,children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",count:b,array:N.current,itemSize:3})}),e.jsx("pointsMaterial",{color:"#D4AF37",size:.008,transparent:!0,opacity:y?.4:.2,blending:_})]}),y&&a>.01&&e.jsxs("points",{ref:u,children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",count:M,array:v.current,itemSize:3})}),e.jsx("pointsMaterial",{color:"#FFA500",size:.02,transparent:!0,opacity:.7,blending:_})]}),y&&a>0&&a<1&&e.jsxs("mesh",{position:[0,a*3,0],rotation:[-Math.PI/2,0,0],children:[e.jsx("ringGeometry",{args:[.2,.6,32]}),e.jsx("meshBasicMaterial",{color:"#FFD700",transparent:!0,opacity:.15,side:O,blending:_})]})]})}function $e({isWeaving:a}){const y=i.useRef(null);return z(d=>{y.current&&(y.current.rotation.y=d.clock.elapsedTime*.1,y.current.children.forEach((f,u)=>{f.position.y=1.5+Math.sin(d.clock.elapsedTime*.5+u)*.3}))}),e.jsxs("group",{children:[e.jsx("group",{ref:y,children:Array.from({length:8}).map((d,f)=>{const u=f/8*Math.PI*2;return e.jsxs("mesh",{position:[Math.cos(u)*1.2,1.5,Math.sin(u)*1.2],children:[e.jsx("sphereGeometry",{args:[.015,8,8]}),e.jsx("meshBasicMaterial",{color:a?"#FFD700":"#8B7355",transparent:!0,opacity:a?.8:.4})]},f)})}),e.jsxs("mesh",{position:[0,.01,0],rotation:[-Math.PI/2,0,0],children:[e.jsx("ringGeometry",{args:[.3,.6,64]}),e.jsx("meshBasicMaterial",{color:a?"#FFD700":"#8B7355",transparent:!0,opacity:a?.2:.1,side:O})]})]})}function Oe({progress:a,isComplete:y,isWeaving:d,handRotation:f,rotationSpeed:u,palmCenter:j,viewMode:b}){const M=i.useRef(null),P=i.useRef(null);return z(N=>{if(P.current&&d){const v=1+Math.sin(N.clock.elapsedTime*2)*.1;P.current.intensity=1.5*v}}),e.jsxs(e.Fragment,{children:[e.jsx(Ve,{progress:a,isWeaving:d,handRotation:f,rotationSpeed:u,palmCenter:j,viewMode:b}),e.jsx("spotLight",{ref:P,position:[4,8,4],angle:.25,penumbra:.8,intensity:1.5,castShadow:!0,"shadow-mapSize":[2048,2048],"shadow-bias":-1e-4}),e.jsx("spotLight",{position:[-4,6,-2],angle:.4,penumbra:1,intensity:.6,color:"#E8E4D9"}),e.jsx("spotLight",{position:[0,4,-5],angle:.5,penumbra:1,intensity:.4,color:"#F2D974"}),e.jsx("ambientLight",{intensity:.25,color:"#FFF8F0"}),d&&e.jsx("pointLight",{position:[0,a*3-1.5+.5,0],intensity:.8,color:"#FFD700",distance:2,decay:2}),e.jsxs("group",{ref:M,position:[0,-1.5,0],children:[e.jsx(Be,{}),e.jsx(He,{progress:a}),e.jsx(ze,{progress:a,isWeaving:d}),e.jsx(_e,{progress:a,isWeaving:d}),e.jsx($e,{isWeaving:d}),e.jsx(Le,{isComplete:y})]}),e.jsx(Ge,{position:[0,-1.5,0],opacity:.5,scale:10,blur:2.5,far:4,color:"#2a1810"}),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-1.49,0],children:[e.jsx("ringGeometry",{args:[.8,1.2,64]}),e.jsx("meshBasicMaterial",{color:"#1a1208",transparent:!0,opacity:.15})]}),e.jsx(Se,{preset:"studio"}),e.jsx("color",{attach:"background",args:["#1a1612"]}),e.jsx("fog",{attach:"fog",args:["#1a1612",5,15]}),e.jsx(ye,{enablePan:!1,enableZoom:!0,minDistance:1.2,maxDistance:5,minPolarAngle:Math.PI/6,maxPolarAngle:Math.PI/2.2,enableDamping:!0,dampingFactor:.08,rotateSpeed:.4})]})}function qe({progress:a}){return e.jsx("div",{className:"w-full bg-paper-600 rounded-full h-3 overflow-hidden",children:e.jsx(Y.div,{className:"h-full bg-gradient-to-r from-palace-500 to-gold-500 rounded-full",initial:{width:0},animate:{width:`${a*100}%`},transition:{duration:.1}})})}function Ye({gesture:a,isTracking:y,isWeaving:d}){const u={fist:{icon:"âœŠ",text:"æ¡æ‹³ - å¿«é€Ÿç¼–ç»‡",color:"bg-palace-500",weaves:!0},pinch:{icon:"ğŸ¤",text:"æåˆ - ç²¾ç»†ç¼–ç»‡",color:"bg-palace-400",weaves:!0},pointing:{icon:"ğŸ‘†",text:"æŒ‡å‘ - ç¼“æ…¢ç¼–ç»‡",color:"bg-nature-500",weaves:!0},thumbsUp:{icon:"ğŸ‘",text:"ç‚¹èµ - åŠ é€Ÿç¼–ç»‡",color:"bg-gold-600",weaves:!0},peace:{icon:"âœŒï¸",text:"å‰ªåˆ€æ‰‹ - ç¼–ç»‡",color:"bg-nature-400",weaves:!0},open:{icon:"âœ‹",text:"å¼ å¼€ - æš‚åœ",color:"bg-mountain-400",weaves:!1},none:{icon:"â“",text:"æœªæ£€æµ‹åˆ°æ‰‹åŠ¿",color:"bg-mountain-500",weaves:!1}}[a];return e.jsxs(Y.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:`flex items-center gap-2 px-4 py-2 rounded-full text-white ${u.color} ${d?"ring-2 ring-white ring-opacity-50 animate-pulse":""}`,children:[e.jsx("span",{className:"text-xl",children:u.icon}),e.jsx("span",{className:"text-sm font-medium",children:u.text}),y&&e.jsx("span",{className:`w-2 h-2 rounded-full ${d?"bg-gold-300 animate-ping":"bg-white animate-pulse"}`})]})}function Ze(){const[a,y]=i.useState({isMuted:!1,volume:.5,isPlaying:!1}),d=i.useRef(null),f=i.useRef(null),u=i.useRef(null),j=i.useRef(!1),b=i.useCallback(()=>(d.current||(d.current=new(window.AudioContext||window.webkitAudioContext)),d.current),[]),M=i.useCallback((n,s,r,t,o)=>{const l=n.createOscillator();l.type="sine",l.frequency.value=s;const m=n.createGain();m.gain.setValueAtTime(0,r),m.gain.linearRampToValueAtTime(o,r+.01),m.gain.exponentialRampToValueAtTime(o*.6,r+t*.2),m.gain.exponentialRampToValueAtTime(.001,r+t);const g=n.createBiquadFilter();g.type="lowpass",g.frequency.value=2e3,l.connect(g),g.connect(m),m.connect(f.current||n.destination),l.start(r),l.stop(r+t)},[]),P=i.useCallback(()=>{if(!(a.isMuted||j.current))try{const n=b();n.state==="suspended"&&n.resume(),j.current=!0;const s=n.createGain();s.gain.value=a.volume*.3,s.connect(n.destination),f.current=s;const r=[{note:261.63,beat:0,dur:2},{note:329.63,beat:1,dur:2},{note:392,beat:2,dur:2},{note:523.25,beat:3,dur:2},{note:220,beat:4,dur:2},{note:261.63,beat:5,dur:2},{note:329.63,beat:6,dur:2},{note:440,beat:7,dur:2},{note:174.61,beat:8,dur:2},{note:261.63,beat:9,dur:2},{note:349.23,beat:10,dur:2},{note:440,beat:11,dur:2},{note:196,beat:12,dur:2},{note:246.94,beat:13,dur:2},{note:392,beat:14,dur:2},{note:493.88,beat:15,dur:2}],t=.8,o=16*t;let l=0;const m=()=>{if(!j.current)return;const S=n.currentTime+.1;r.forEach(({note:x,beat:p,dur:w})=>{const T=S+p*t,k=w*t,G=a.volume*.15;M(n,x,T,k,G)}),l++,u.current=setTimeout(()=>{m()},o*1e3-100)};m(),y(g=>({...g,isPlaying:!0}))}catch(n){console.log("éŸ³é¢‘åˆå§‹åŒ–å¤±è´¥:",n)}},[a.isMuted,a.volume,b,M]),N=i.useCallback(()=>{if(j.current=!1,u.current&&(clearTimeout(u.current),u.current=null),f.current&&d.current){const n=d.current.currentTime;f.current.gain.linearRampToValueAtTime(0,n+.5)}y(n=>({...n,isPlaying:!1}))},[]),v=i.useCallback(()=>{if(!a.isMuted)try{const n=b(),s=n.currentTime,r=[523.25,587.33,659.25,783.99,880],t=r[Math.floor(Math.random()*r.length)],o=n.createOscillator();o.type="sine",o.frequency.value=t;const l=n.createGain();l.gain.setValueAtTime(0,s),l.gain.linearRampToValueAtTime(a.volume*.08,s+.01),l.gain.exponentialRampToValueAtTime(.001,s+.3),o.connect(l),l.connect(n.destination),o.start(s),o.stop(s+.3)}catch{}},[a.isMuted,a.volume,b]),h=i.useCallback(()=>{if(!a.isMuted)try{const n=b(),s=n.currentTime;[261.63,329.63,392,523.25,659.25,783.99,1046.5].forEach((t,o)=>{const l=n.createOscillator();l.type="sine",l.frequency.value=t;const m=n.createGain(),g=s+o*.15;m.gain.setValueAtTime(0,g),m.gain.linearRampToValueAtTime(a.volume*.12,g+.02),m.gain.exponentialRampToValueAtTime(.001,g+1.5),l.connect(m),m.connect(n.destination),l.start(g),l.stop(g+1.5)}),setTimeout(()=>{[261.63,329.63,392,523.25].forEach(o=>{const l=n.createOscillator();l.type="sine",l.frequency.value=o;const m=n.createGain();m.gain.setValueAtTime(a.volume*.1,n.currentTime),m.gain.exponentialRampToValueAtTime(.001,n.currentTime+2),l.connect(m),m.connect(n.destination),l.start(),l.stop(n.currentTime+2)})},1e3)}catch{}},[a.isMuted,a.volume,b]),c=i.useCallback(()=>{y(n=>{const s=!n.isMuted;return f.current&&(f.current.gain.value=s?0:n.volume*.3),{...n,isMuted:s}})},[]);return i.useEffect(()=>()=>{j.current=!1,u.current&&clearTimeout(u.current)},[]),{audioState:a,playAmbientMusic:P,stopAmbientMusic:N,playWeavingSound:v,playCompleteSound:h,toggleMute:c}}function lt(){const[a,y]=i.useState(0),[d,f]=i.useState(!1),[u,j]=i.useState(!0),[b,M]=i.useState(!1),[P,N]=i.useState(!1),[v,h]=i.useState("touch"),[c,n]=i.useState(!1),[s,r]=i.useState("auto"),[t,o]=i.useState(!1),l=i.useRef(null),m=i.useRef(null),g=i.useRef(null),S=i.useRef(0),x=Ue(m,c),{audioState:p,playAmbientMusic:w,stopAmbientMusic:T,playWeavingSound:k,playCompleteSound:G,toggleMute:I}=Ze(),F=i.useRef(0),A=i.useCallback(async()=>{if(g.current)try{document.fullscreenElement?(await document.exitFullscreen(),o(!1)):(await g.current.requestFullscreen(),o(!0))}catch(R){console.error("å…¨å±åˆ‡æ¢å¤±è´¥:",R)}},[]);i.useEffect(()=>{const R=()=>{o(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",R),()=>document.removeEventListener("fullscreenchange",R)},[]),i.useEffect(()=>{if(d&&!u&&!t&&g.current){const R=setTimeout(()=>{var C,U;(U=(C=g.current)==null?void 0:C.requestFullscreen)==null||U.call(C).catch(()=>{})},500);return()=>clearTimeout(R)}},[d,u]),i.useEffect(()=>{d&&!u&&!b?w():(!d||b)&&T()},[d,u,b,w,T]);const E=R=>["fist","pinch","pointing","thumbsUp","peace"].includes(R),q=R=>({fist:.008,thumbsUp:.012,pinch:.004,pointing:.003,peace:.006,open:0,none:0})[R],L=c&&d&&!b&&E(x.gesture);i.useEffect(()=>{if(L){const R=Date.now();R-F.current>150&&(k(),F.current=R)}},[L,a,k]),i.useEffect(()=>{b&&G()},[b,G]),i.useEffect(()=>{if(!c||!d||b)return;const R=setInterval(()=>{const C=q(x.gesture);C>0&&y(U=>{const V=Math.min(1,U+C);return V>=1&&(M(!0),setTimeout(()=>N(!0),1e3),clearInterval(R)),V})},50);return()=>clearInterval(R)},[c,d,b,x.gesture]);const B=i.useCallback(R=>{if(!d||b||v!=="touch")return;const C=(S.current-R)*.003;S.current=R,y(U=>{const V=Math.max(0,Math.min(1,U+C));return V>=1&&!b&&(M(!0),setTimeout(()=>N(!0),1e3)),V})},[d,b,v]),Z=R=>{R.buttons===1&&v==="touch"&&B(R.clientY)},X=R=>{S.current=R.clientY,!d&&v==="touch"&&(f(!0),j(!1))},H=R=>{v==="touch"&&B(R.touches[0].clientY)},he=R=>{S.current=R.touches[0].clientY,!d&&v==="touch"&&(f(!0),j(!1))},te=()=>{h("hand"),n(!0),j(!1),f(!0)},W=()=>{y(0),f(!1),M(!1),N(!1),j(!0),n(!1),h("touch")},me=()=>{y(0),M(!1),N(!1),f(!0)},ee=i.useRef(null);return i.useEffect(()=>{if(!x.landmarks||!ee.current)return;const R=ee.current,C=R.getContext("2d");if(!C)return;C.clearRect(0,0,R.width,R.height);const U=x.landmarks,V=[[0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[0,9],[9,10],[10,11],[11,12],[0,13],[13,14],[14,15],[15,16],[0,17],[17,18],[18,19],[19,20],[5,9],[9,13],[13,17]];C.strokeStyle="#A73A36",C.lineWidth=2,V.forEach(([J,K])=>{const se=U[J],ne=U[K];C.beginPath(),C.moveTo((1-se.x)*R.width,se.y*R.height),C.lineTo((1-ne.x)*R.width,ne.y*R.height),C.stroke()}),U.forEach((J,K)=>{C.beginPath(),C.arc((1-J.x)*R.width,J.y*R.height,K===0?6:4,0,Math.PI*2),C.fillStyle=K===0?"#F2D974":"#A73A36",C.fill(),C.strokeStyle="#fff",C.lineWidth=1,C.stroke()})},[x.landmarks]),e.jsxs("div",{ref:g,className:"relative w-full h-screen bg-gradient-to-b from-paper-500 to-paper-300 overflow-hidden",children:[e.jsxs("div",{className:`absolute z-20 transition-all duration-300 ${c?"bottom-24 right-4 w-64 h-48 rounded-xl overflow-hidden shadow-card border-2 border-palace-500":"w-0 h-0 opacity-0"}`,children:[e.jsx("video",{ref:m,className:"absolute inset-0 w-full h-full object-cover transform -scale-x-100",playsInline:!0,muted:!0}),e.jsx("canvas",{ref:ee,width:256,height:192,className:"absolute inset-0 w-full h-full pointer-events-none"}),c&&e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[x.isLoading&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e.jsx("span",{className:"text-xs",children:"åŠ è½½æ‰‹éƒ¨æ¨¡å‹..."})]})}),x.error&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-500/80",children:e.jsx("div",{className:"text-center text-white p-2",children:e.jsxs("span",{className:"text-xs",children:["âŒ ",x.error]})})}),!x.isLoading&&!x.error&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx("span",{className:`px-2 py-1 text-white text-xs rounded-full flex items-center gap-1 ${x.isTracking?"bg-nature-500":"bg-gold-500"}`,children:x.isTracking?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),"è¿½è¸ªä¸­"]}):"ç­‰å¾…æ£€æµ‹..."})}),x.isTracking&&Math.abs(x.rotationSpeed)>2&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs("span",{className:"px-2 py-1 bg-palace-500 text-white text-xs rounded-full flex items-center gap-1",children:[e.jsx("span",{className:`transform ${x.rotationSpeed>0?"rotate-90":"-rotate-90"}`,children:"â†»"}),"æ—‹è½¬è§†è§’"]})}),e.jsx("div",{className:"absolute bottom-2 left-2 right-2 text-center",children:e.jsxs("span",{className:`text-sm font-bold px-3 py-1 rounded ${x.gesture==="fist"||x.gesture==="pinch"||x.gesture==="thumbsUp"||x.gesture==="peace"?"bg-palace-500 text-white":x.gesture==="open"?"bg-mountain-400 text-white":"bg-black/50 text-white"}`,children:[x.gesture==="fist"&&"âœŠ æ¡æ‹³ç¼–ç»‡",x.gesture==="pinch"&&"ğŸ¤ ç²¾ç»†ç¼–ç»‡",x.gesture==="thumbsUp"&&"ğŸ‘ åŠ é€Ÿç¼–ç»‡",x.gesture==="peace"&&"âœŒï¸ ç¼–ç»‡ä¸­",x.gesture==="pointing"&&"ğŸ‘† ç¼“æ…¢ç¼–ç»‡",x.gesture==="open"&&"âœ‹ æš‚åœ",x.gesture==="none"&&"æœªè¯†åˆ«"]})})]})]})]}),e.jsx("div",{ref:l,className:"absolute inset-0 cursor-grab active:cursor-grabbing",onMouseDown:X,onMouseMove:Z,onTouchStart:he,onTouchMove:H,children:e.jsx(ge,{shadows:!0,children:e.jsx(i.Suspense,{fallback:e.jsx(Ee,{}),children:e.jsx(Oe,{progress:a,isComplete:b,isWeaving:L,handRotation:x.rotation,rotationSpeed:x.rotationSpeed,palmCenter:x.palmCenter,viewMode:s})})})}),e.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-mountain-900/80 to-transparent z-10",children:e.jsxs("div",{className:"max-w-lg mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between text-white mb-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"å®‰æºªè—¤é“å·¥è‰º"}),e.jsx("p",{className:"text-sm text-white/70",children:v==="hand"?"ğŸ–ï¸ æ‰‹åŠ¿ç¼–ç»‡æ¨¡å¼":"ğŸ‘† è§¦æ§ç¼–ç»‡æ¨¡å¼"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:I,className:`p-2 rounded-full transition-colors ${p.isMuted?"bg-red-500/50 text-white":"bg-white/10 hover:bg-white/20 text-white"}`,title:p.isMuted?"å¼€å¯å£°éŸ³":"é™éŸ³",children:p.isMuted?e.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]}):e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})})}),e.jsx("button",{onClick:()=>v==="hand"?W():te(),className:`p-2 rounded-full transition-colors ${v==="hand"?"bg-palace-500 text-white":"bg-white/10 hover:bg-white/20 text-white"}`,title:v==="hand"?"åˆ‡æ¢åˆ°è§¦æ§æ¨¡å¼":"å¼€å¯æ‰‹åŠ¿è¿½è¸ª",children:v==="hand"?e.jsx(De,{className:"w-5 h-5"}):e.jsx(le,{className:"w-5 h-5"})}),e.jsx("button",{onClick:W,className:"p-2 rounded-full bg-white/10 hover:bg-white/20",children:e.jsx(ue,{className:"w-5 h-5"})})]})]}),e.jsx(qe,{progress:a}),e.jsxs("p",{className:"text-xs text-white/60 mt-1 text-center",children:["ç¼–ç»‡è¿›åº¦ ",Math.floor(a*100),"%"]})]})}),c&&d&&e.jsx("div",{className:"absolute top-28 left-1/2 -translate-x-1/2 z-20",children:e.jsx(Ye,{gesture:x.gesture,isTracking:x.isTracking,isWeaving:L})}),d&&!u&&e.jsxs("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 z-20 flex flex-col gap-2",children:[[{mode:"auto",icon:"ğŸ¬",label:"è‡ªåŠ¨"},{mode:"outside",icon:"ğŸŒ",label:"å¤–éƒ¨"},{mode:"inside",icon:"ğŸ‘ï¸",label:"å†…éƒ¨"},{mode:"detail",icon:"ğŸ”",label:"ç»†èŠ‚"},{mode:"overview",icon:"ğŸ”ï¸",label:"å…¨è²Œ"}].map(({mode:R,icon:C,label:U})=>e.jsxs("button",{onClick:()=>r(R),className:`w-12 h-12 rounded-xl flex flex-col items-center justify-center transition-all ${s===R?"bg-palace-500 text-white scale-110 shadow-lg":"bg-black/40 text-white/80 hover:bg-black/60 hover:scale-105"}`,title:U,children:[e.jsx("span",{className:"text-lg",children:C}),e.jsx("span",{className:"text-[10px]",children:U})]},R)),e.jsx("div",{className:"w-8 h-px bg-white/20 mx-auto my-1"}),e.jsxs("button",{onClick:A,className:`w-12 h-12 rounded-xl flex flex-col items-center justify-center transition-all ${t?"bg-gold-500 text-white":"bg-black/40 text-white/80 hover:bg-black/60"}`,title:t?"é€€å‡ºå…¨å±":"å…¨å±æ¨¡å¼",children:[e.jsx("span",{className:"text-lg",children:"â›¶"}),e.jsx("span",{className:"text-[10px]",children:t?"é€€å‡º":"å…¨å±"})]})]}),e.jsx(re,{children:u&&e.jsx(Y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"absolute bottom-32 left-1/2 -translate-x-1/2 w-96 max-w-[90vw] z-20",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur rounded-2xl p-6 shadow-card text-center",children:[e.jsx(fe,{className:"w-12 h-12 mx-auto mb-3 text-palace-500"}),e.jsx("h3",{className:"text-lg font-bold text-mountain-700 mb-2",children:"ä½“éªŒè—¤é“ç¼–ç»‡æŠ€è‰º"}),e.jsx("p",{className:"text-sm text-mountain-500 mb-4",children:"é€‰æ‹©äº¤äº’æ–¹å¼ï¼Œæ„Ÿå—ä¼ ç»Ÿæ‰‹å·¥è‰ºçš„é­…åŠ›"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(Q,{variant:"heritage",onClick:()=>{h("touch"),f(!0),j(!1)},className:"w-full",children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"è§¦æ§ç¼–ç»‡ï¼ˆå‘ä¸Šæ»‘åŠ¨ï¼‰"]}),e.jsxs(Q,{variant:"outline-heritage",onClick:te,className:"w-full",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"æ‰‹åŠ¿ç¼–ç»‡ï¼ˆé«˜çº§ä½“éªŒï¼‰"]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-paper-100 rounded-xl text-left",children:[e.jsx("p",{className:"text-xs font-medium text-mountain-600 mb-2",children:"ğŸ® æ‰‹åŠ¿æ“ä½œæŒ‡å—ï¼š"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-mountain-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"âœŠ"})," æ¡æ‹³ = å¿«é€Ÿç¼–ç»‡"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"ğŸ‘"})," ç‚¹èµ = æœ€å¿«ç¼–ç»‡"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"âœŒï¸"})," å‰ªåˆ€æ‰‹ = ä¸­é€Ÿç¼–ç»‡"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"ğŸ¤"})," æåˆ = ç²¾ç»†ç¼–ç»‡"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"âœ‹"})," å¼ å¼€ = æš‚åœç¼–ç»‡"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"ğŸ”„"})," æ—‹è½¬ = è½¬åŠ¨è§†è§’"]})]})]})]})})}),e.jsx(re,{children:P&&e.jsx(Y.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"absolute inset-0 flex items-center justify-center bg-black/60 z-50",children:e.jsxs("div",{className:"bg-white rounded-3xl p-8 max-w-sm mx-4 text-center",children:[e.jsx(Y.div,{animate:{rotate:[0,10,-10,0],scale:[1,1.1,1]},transition:{duration:.5,repeat:2},children:e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-gradient-to-br from-gold-400 to-gold-600 rounded-2xl flex items-center justify-center shadow-heritage",children:e.jsx(xe,{className:"w-10 h-10 text-white"})})}),e.jsx("h3",{className:"text-2xl font-bold text-mountain-800 mb-2",children:"ğŸ‰ ç¼–ç»‡å®Œæˆï¼"}),e.jsx("p",{className:"text-mountain-500 mb-4",children:"æ­å–œè·å¾—æ–‡è„‰ç¢ç‰‡"}),e.jsx("div",{className:"bg-paper-500 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-palace-500 rounded-lg flex items-center justify-center",children:e.jsx(Ae,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-bold text-mountain-800",children:"è—¤é“èŠ±ç“¶"}),e.jsx("p",{className:"text-xs text-mountain-500",children:"ç¨€æœ‰åº¦: çå“"})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Q,{variant:"heritage",className:"w-full",onClick:me,children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"å†æ¥ä¸€æ¬¡"]}),e.jsxs(Q,{variant:"outline-heritage",className:"w-full",onClick:W,children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"è¿”å›é€‰æ‹©"]})]})]})})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-mountain-900/80 to-transparent",children:e.jsx("div",{className:"max-w-lg mx-auto",children:e.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-xl p-3 flex items-start gap-3",children:[e.jsx(Ne,{className:"w-5 h-5 text-gold-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-white/80 text-sm",children:[e.jsx("p",{className:"font-medium mb-1",children:"å®‰æºªè—¤é“å·¥è‰º"}),e.jsx("p",{className:"text-xs text-white/60",children:'å›½å®¶çº§éç‰©è´¨æ–‡åŒ–é—äº§ï¼Œä»¥é“ä¸ä¸ºéª¨æ¶ï¼Œç”¨è—¤æ¡ç¼ ç»•ç¼–ç»‡ï¼Œ åˆ›é€ å‡ºç²¾ç¾çš„å·¥è‰ºå“ï¼Œè¢«èª‰ä¸º"æŒ‡å°–ä¸Šçš„è‰ºæœ¯"ã€‚'})]})]})})})]})}export{lt as default};
