const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mediapipe-vendor-Bj4-a4SN.js","assets/three-vendor-BoyHWg1a.js"])))=>i.map(i=>d[i]);
import{r as e,j as t,C as s,u as r,d as a,E as n,O as i,e as o,H as c,_ as l,V as u,P as d,f as h,D as m,A as x,h as p}from"./three-vendor-BoyHWg1a.js";import{S as g}from"./ShareCardGenerator-B89QHg_k.js";import{d as f,u as j,a as y,C as b,B as v}from"./index-D20SIRsj.js";import{u as w}from"./ecoAchievementStore-C9SOCyzU.js";import{u as M}from"./artworkStore-COEslUvR.js";import{a as N}from"./core-vendor-Csnc5NqJ.js";import{az as S,o as k,s as F,A as C,m as T,e as R,w as A,g as I,L as D,O as E,T as P,E as B,u as G,X as L,ao as _}from"./ui-vendor-BCOa7pYq.js";const $={lantern:{name:"è—¤ç¼–ç¯ç¬¼",icon:"ğŸ®",desc:"å…‰å½±äº¤ç»‡ï¼Œæ¸©æš–å¦‚è¯—",profile:[{y:0,r:.2},{y:.3,r:.35},{y:.6,r:.5},{y:1,r:.55},{y:1.5,r:.5},{y:2,r:.55},{y:2.4,r:.5},{y:2.7,r:.35},{y:3,r:.2}],weaveTurns:25,weaveStyle:"dense"},basket:{name:"æ”¶çº³èŠ±ç¯®",icon:"ğŸ§º",desc:"ç”Ÿæ´»ç¾å­¦ï¼Œå®ç”¨ä¹‹é€‰",profile:[{y:0,r:.25},{y:.3,r:.3},{y:.6,r:.38},{y:1,r:.45},{y:1.5,r:.5},{y:2,r:.55},{y:2.5,r:.6},{y:2.8,r:.62},{y:3,r:.65}],weaveTurns:18,weaveStyle:"loose"},vase:{name:"è‰ºæœ¯èŠ±ç“¶",icon:"ğŸº",desc:"å…¸é›…é€ å‹ï¼Œæ’èŠ±ä½³å™¨",profile:[{y:0,r:.35},{y:.3,r:.42},{y:.6,r:.5},{y:1,r:.52},{y:1.4,r:.4},{y:1.8,r:.26},{y:2.2,r:.28},{y:2.6,r:.42},{y:3,r:.5}],weaveTurns:20,weaveStyle:"classic"},sphere:{name:"è—¤ç¼–åœ†çƒ",icon:"ğŸ”®",desc:"åœ†æ¶¦é€ å‹ï¼Œè£…é¥°é¦–é€‰",profile:[{y:0,r:.15},{y:.4,r:.4},{y:.8,r:.52},{y:1.2,r:.58},{y:1.5,r:.58},{y:1.8,r:.52},{y:2.2,r:.4},{y:2.6,r:.25},{y:3,r:.1}],weaveTurns:22,weaveStyle:"wave"},sculpture:{name:"è‰ºæœ¯æ‘†ä»¶",icon:"ğŸ¨",desc:"ç‹¬ç‰¹é€ å‹ï¼ŒåŒ å¿ƒç‹¬è¿",profile:[{y:0,r:.3},{y:.4,r:.5},{y:.8,r:.35},{y:1.2,r:.55},{y:1.6,r:.3},{y:2,r:.5},{y:2.4,r:.35},{y:2.7,r:.45},{y:3,r:.25}],weaveTurns:15,weaveStyle:"artistic"}},z=[{min:0,max:20,level:"åˆå­¦è€…",title:"è—¤è‰ºæ–°æ‰‹",color:"#9E9E9E"},{min:20,max:40,level:"å…¥é—¨",title:"ç¼–ç»‡å­¦å¾’",color:"#8BC34A"},{min:40,max:60,level:"ç†Ÿç»ƒ",title:"è—¤è‰ºåŒ äºº",color:"#2196F3"},{min:60,max:80,level:"ç²¾é€š",title:"ç¼–ç»‡è¾¾äºº",color:"#9C27B0"},{min:80,max:100,level:"å¤§å¸ˆ",title:"éé—ä¼ æ‰¿äºº",color:"#FF9800"}];const U={classic:{name:"å¤å…¸ç¼–ç»‡",icon:"ğŸ›ï¸"},modern:{name:"ç°ä»£ç®€çº¦",icon:"âœ¨"},artistic:{name:"è‰ºæœ¯æŠ½è±¡",icon:"ğŸ¨"},nature:{name:"è‡ªç„¶çº¹ç†",icon:"ğŸŒ¿"}},W=[{primary:"#A67B4B",secondary:"#8B5E34",accent:"#C4956A",highlight:"#DEB887",name:"ç»å…¸æ£•"},{primary:"#2E7D32",secondary:"#1B5E20",accent:"#4CAF50",highlight:"#81C784",name:"ç¿ ç«¹ç»¿"},{primary:"#5D4037",secondary:"#3E2723",accent:"#8D6E63",highlight:"#A1887F",name:"æ·±æœ¨æ£•"},{primary:"#FF8A65",secondary:"#E64A19",accent:"#FFAB91",highlight:"#FFCCBC",name:"æš–é˜³æ©™"},{primary:"#7986CB",secondary:"#3F51B5",accent:"#9FA8DA",highlight:"#C5CAE9",name:"é™è°§è“"},{primary:"#F48FB1",secondary:"#E91E63",accent:"#F8BBD9",highlight:"#FCE4EC",name:"èŠ±æ¼«ç²‰"},{primary:"#FFD54F",secondary:"#FFA000",accent:"#FFE082",highlight:"#FFF8E1",name:"é‡‘ç§‹é»„"},{primary:"#80CBC4",secondary:"#00897B",accent:"#B2DFDB",highlight:"#E0F2F1",name:"æ¸…æ–°é’"}];const q=350,O=450,V=6,H=3,Y=12,Z=70,J=60;function K(t,s){const[r,a]=e.useState({isTracking:!1,landmarks:null,gesture:"none",handedness:null,isLoading:!1,error:null}),n=e.useRef({landmarks:null,rotation:0,rotationSpeed:0,palmCenter:null,gesture:"none"}),i=e.useRef(null),o=e.useRef(null),c=e.useRef([]),u=e.useRef("none"),d=e.useRef({}),h=e.useRef(0),m=e.useRef([]),x=e=>{const t=c.current;t.push(e),t.length>8&&t.shift();const s={};t.forEach(e=>{s[e]=(s[e]||0)+1});let r=0,a="none";return Object.entries(s).forEach(([e,t])=>{t>r&&(r=t,a=e)}),a!==u.current?(d.current[a]=(d.current[a]||0)+1,d.current[a]>=3&&(u.current=a,d.current={})):d.current={},u.current};return e.useEffect(()=>{var e,r,d,p;if(!s||!t.current)return;if(i.current&&o.current)return;let g=!0;i.current&&(null==(r=(e=i.current).close)||r.call(e),i.current=null),o.current&&(null==(p=(d=o.current).stop)||p.call(d),o.current=null),c.current=[],u.current="none",m.current=[],a(e=>({...e,isLoading:!0,error:null}));return(async()=>{try{const{Hands:e}=await l(async()=>{const{Hands:e}=await import("./mediapipe-vendor-Bj4-a4SN.js").then(e=>e.h);return{Hands:e}},__vite__mapDeps([0,1])),{Camera:s}=await l(async()=>{const{Camera:e}=await import("./mediapipe-vendor-Bj4-a4SN.js").then(e=>e.c);return{Camera:e}},__vite__mapDeps([0,1])),r=new e({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${e}`});if(r.setOptions({maxNumHands:1,modelComplexity:1,minDetectionConfidence:.5,minTrackingConfidence:.5}),r.onResults(e=>{var t,s;if(g)if(e.multiHandLandmarks&&e.multiHandLandmarks.length>0){const r=e.multiHandLandmarks[0],i=(null==(s=null==(t=e.multiHandedness)?void 0:t[0])?void 0:s.label)||null,o=(e=>{if(!e||e.length<21)return"none";const t=e[4],s=e[3],r=e[8],a=e[6],n=e[12],i=e[10],o=e[16],c=e[14],l=e[20],u=e[18],d=(e,t)=>e.y<t.y-.02,h=t.x<s.x-.02||t.x>s.x+.02,m=d(r,a),x=d(n,i),p=d(o,c),g=d(l,u);var f,j;return f=t,j=r,Math.sqrt((f.x-j.x)**2+(f.y-j.y)**2)<.06&&!x&&!p?"pinch":!h||m||x||p||g?m&&x&&!p&&!g?"peace":!m||x||p||g?m||x||p||g?m&&x&&p&&g?"open":"none":"fist":"pointing":"thumbsUp"})(r),c=x(o),l=(e=>{const t=e[0],s=e[9],r=e[5],a=e[17],n={x:(t.x+s.x+r.x+a.x)/4,y:(t.y+s.y+r.y+a.y)/4},i=a.x-r.x,o=a.y-r.y,c=Math.atan2(o,i)*(180/Math.PI)+180,l=m.current;l.push(c),l.length>5&&l.shift();let u=0;if(l.length>=2){let e=l[l.length-1]-l[l.length-2];e>180&&(e-=360),e<-180&&(e+=360),u=e}return h.current=c,{rotation:c,speed:u,center:n}})(r);n.current={landmarks:r,rotation:l.rotation,rotationSpeed:l.speed,palmCenter:l.center,gesture:c},a(e=>e.isTracking&&e.gesture===c&&e.handedness===i?e:{...e,isTracking:!0,landmarks:r,gesture:c,handedness:i,isLoading:!1})}else n.current={landmarks:null,rotation:0,rotationSpeed:0,palmCenter:null,gesture:"none"},a(e=>e.isTracking||"none"!==e.gesture?{...e,isTracking:!1,landmarks:null,gesture:x("none")}:e)}),i.current=r,t.current){const e=new s(t.current,{onFrame:async()=>{i.current&&t.current&&await i.current.send({image:t.current})},width:640,height:480});o.current=e,await e.start(),a(e=>({...e,isLoading:!1}))}}catch(e){a(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"åˆå§‹åŒ–å¤±è´¥"}))}})(),()=>{var e,t,s,r;g=!1,o.current&&(null==(t=(e=o.current).stop)||t.call(e),o.current=null),i.current&&(null==(r=(s=i.current).close)||r.call(s),i.current=null),a({isTracking:!1,landmarks:null,gesture:"none",handedness:null,isLoading:!1,error:null})}},[s]),{state:r,handDataRef:n}}function Q(){const{progress:e}=o();return t.jsx(c,{center:!0,children:t.jsxs("div",{className:"flex flex-col items-center gap-3",children:[t.jsx("div",{className:"w-16 h-16 border-4 border-palace-500 border-t-transparent rounded-full animate-spin"}),t.jsxs("p",{className:"text-palace-600 font-medium",children:["åŠ è½½ä¸­ ",e.toFixed(0),"%"]})]})})}function X({productShape:s="vase"}){const a=e.useRef(null),n="#0a0a0a",i="#1a1a1a",o="#8B7355";r(e=>{if(a.current){const t=.002*Math.sin(.5*e.clock.elapsedTime);a.current.scale.setScalar(1+t)}});const c=$[s].profile,l=Array.from({length:16}).map((e,t)=>{const s=t/16*Math.PI*2,r=t%2==0?.02:-.02,a=c.map((e,t)=>new u(e.r*Math.cos(s+r*t),e.y,e.r*Math.sin(s+r*t)));return new h(a,!1,"catmullrom",.3)}),d=e=>{for(let t=0;t<c.length-1;t++)if(e>=c[t].y&&e<=c[t+1].y){const s=(e-c[t].y)/(c[t+1].y-c[t].y);return c[t].r+s*(c[t+1].r-c[t].r)}return.35},m=[];for(let e=0;e<3;e++){const t=.5+.25*e;for(let e=0;e<8;e++){const s=e/8*Math.PI*2,r=d(t)+.01,a=[new u(r*Math.cos(s),t,r*Math.sin(s)),new u((r+.02)*Math.cos(s+.15),t+.12,(r+.02)*Math.sin(s+.15)),new u(r*Math.cos(s+.3),t+.24,r*Math.sin(s+.3))];m.push(new h(a))}}const x=[];for(let e=0;e<=40;e++){const t=e/40,s=1.8+.6*t,r=d(s)+.015,a=t*Math.PI*3;x.push(new u(r*Math.cos(a),s,r*Math.sin(a)))}const p=new h(x);return t.jsxs("group",{ref:a,children:[l.map((e,s)=>t.jsxs("mesh",{castShadow:!0,receiveShadow:!0,children:[t.jsx("tubeGeometry",{args:[e,64,s%2==0?.014:.01,8,!1]}),t.jsx("meshStandardMaterial",{color:s%2==0?n:i,metalness:.95,roughness:.15,envMapIntensity:1.2})]},`main-${s}`)),[.08,.35,.7,1.1,1.5,1.9,2.5,2.95].map((e,s)=>{const r=d(e);return t.jsxs("group",{children:[t.jsxs("mesh",{position:[0,e,0],rotation:[-Math.PI/2,0,0],castShadow:!0,children:[t.jsx("torusGeometry",{args:[r,.012,8,64]}),t.jsx("meshStandardMaterial",{color:n,metalness:.95,roughness:.12})]}),s%2==0&&t.jsxs("mesh",{position:[0,e+.02,0],rotation:[-Math.PI/2,0,0],castShadow:!0,children:[t.jsx("torusGeometry",{args:[r-.01,.006,6,64]}),t.jsx("meshStandardMaterial",{color:o,metalness:.8,roughness:.25})]})]},`ring-group-${s}`)}),m.map((e,s)=>t.jsxs("mesh",{castShadow:!0,children:[t.jsx("tubeGeometry",{args:[e,16,.004,4,!1]}),t.jsx("meshStandardMaterial",{color:o,metalness:.85,roughness:.2})]},`diamond-${s}`)),t.jsxs("mesh",{castShadow:!0,children:[t.jsx("tubeGeometry",{args:[p,48,.005,6,!1]}),t.jsx("meshStandardMaterial",{color:o,metalness:.85,roughness:.2})]}),[{y:0,r1:.38,r2:.42,h:.02,color:i},{y:-.025,r1:.42,r2:.48,h:.03,color:n},{y:-.06,r1:.48,r2:.52,h:.04,color:i},{y:-.11,r1:.44,r2:.48,h:.06,color:n}].map((e,s)=>t.jsxs("mesh",{position:[0,e.y,0],castShadow:!0,receiveShadow:!0,children:[t.jsx("cylinderGeometry",{args:[e.r1,e.r2,e.h,48]}),t.jsx("meshStandardMaterial",{color:e.color,metalness:.92,roughness:.15})]},`base-${s}`)),t.jsxs("mesh",{position:[0,-.03,0],rotation:[-Math.PI/2,0,0],children:[t.jsx("torusGeometry",{args:[.45,.008,6,48]}),t.jsx("meshStandardMaterial",{color:o,metalness:.9,roughness:.2,emissive:o,emissiveIntensity:.1})]}),t.jsxs("mesh",{position:[0,3,0],rotation:[-Math.PI/2,0,0],castShadow:!0,children:[t.jsx("torusGeometry",{args:[.5,.018,8,64]}),t.jsx("meshStandardMaterial",{color:n,metalness:.95,roughness:.1})]}),t.jsxs("mesh",{position:[0,2.98,0],rotation:[-Math.PI/2,0,0],children:[t.jsx("torusGeometry",{args:[.485,.008,6,64]}),t.jsx("meshStandardMaterial",{color:o,metalness:.9,roughness:.15,emissive:o,emissiveIntensity:.15})]}),t.jsxs("mesh",{position:[0,2.96,0],rotation:[-Math.PI/2,0,0],castShadow:!0,children:[t.jsx("torusGeometry",{args:[.47,.012,8,64]}),t.jsx("meshStandardMaterial",{color:i,metalness:.92,roughness:.12})]})]})}function ee({isComplete:s}){const a=e.useRef(null),n=e.useRef(null),i=e.useRef(null),o=e.useRef(null),c=e.useRef(0);if(r((e,t)=>{if(!s)return void(c.current=0);c.current=Math.min(c.current+.5*t,1);const r=c.current,l=e.clock.elapsedTime;if(a.current&&(a.current.rotation.y=.3*l),n.current&&n.current.children.forEach((e,t)=>{const s=(l+.5*t)%3,a=1+.5*s,n=Math.max(0,1-s/3);e.scale.setScalar(a),e.material&&(e.material.opacity=n*r),e.rotation.z=l*(.2+.1*t)}),i.current){const e=i.current.geometry.attributes.position.array;for(let t=0;t<e.length/3;t++){const s=t/(e.length/3)*Math.PI*8+l,r=(.05*t+.5*l)%4-.5,a=.3+.2*Math.sin(2*r);e[3*t]=Math.cos(s)*a,e[3*t+1]=r,e[3*t+2]=Math.sin(s)*a}i.current.geometry.attributes.position.needsUpdate=!0}if(o.current){const e=o.current.geometry.attributes.position.array;for(let t=0;t<e.length/3;t++){const s=t/(e.length/3)*Math.PI*2,r=l*(.5+t%5*.2)%2,a=1.5+.3*Math.sin(3*s+l);e[3*t]=Math.cos(s+.5*l)*r,e[3*t+1]=a,e[3*t+2]=Math.sin(s+.5*l)*r}o.current.geometry.attributes.position.needsUpdate=!0}}),!s)return null;const l=new Float32Array(240),u=new Float32Array(180);for(let e=0;e<80;e++)l[3*e]=0,l[3*e+1]=.05*e,l[3*e+2]=0;for(let e=0;e<60;e++)u[3*e]=0,u[3*e+1]=1.5,u[3*e+2]=0;return t.jsxs("group",{ref:a,children:[t.jsx("group",{ref:n,position:[0,1.5,0],children:[0,1,2].map(e=>t.jsxs("mesh",{rotation:[Math.PI/2,0,0],children:[t.jsx("ringGeometry",{args:[.4+.1*e,.45+.1*e,64]}),t.jsx("meshBasicMaterial",{color:"#FFD700",transparent:!0,opacity:.6,side:m})]},e))}),t.jsxs("mesh",{position:[0,1.5,0],children:[t.jsx("cylinderGeometry",{args:[.02,.15,4,16,1,!0]}),t.jsx("meshBasicMaterial",{color:"#FFD700",transparent:!0,opacity:.3,side:m})]}),t.jsxs("points",{ref:i,children:[t.jsx("bufferGeometry",{children:t.jsx("bufferAttribute",{attach:"attributes-position",count:80,array:l,itemSize:3})}),t.jsx("pointsMaterial",{color:"#FFD700",size:.04,transparent:!0,opacity:.9,blending:x})]}),t.jsxs("points",{ref:o,children:[t.jsx("bufferGeometry",{children:t.jsx("bufferAttribute",{attach:"attributes-position",count:60,array:u,itemSize:3})}),t.jsx("pointsMaterial",{color:"#FFA500",size:.06,transparent:!0,opacity:.7,blending:x})]}),t.jsxs("mesh",{position:[0,3.2,0],children:[t.jsx("sphereGeometry",{args:[.15,32,32]}),t.jsx("meshBasicMaterial",{color:"#FFD700",transparent:!0,opacity:.8})]}),t.jsxs("mesh",{position:[0,3.2,0],children:[t.jsx("sphereGeometry",{args:[.25,32,32]}),t.jsx("meshBasicMaterial",{color:"#FFA500",transparent:!0,opacity:.3})]}),t.jsxs("mesh",{position:[0,0,0],rotation:[-Math.PI/2,0,0],children:[t.jsx("ringGeometry",{args:[.5,.8,64]}),t.jsx("meshBasicMaterial",{color:"#FFD700",transparent:!0,opacity:.4,side:m})]}),Array.from({length:12}).map((e,s)=>{const r=s/12*Math.PI*2;return t.jsxs("mesh",{position:[.7*Math.cos(r),1+s%3*.5,.7*Math.sin(r)],children:[t.jsx("sphereGeometry",{args:[.025,8,8]}),t.jsx("meshBasicMaterial",{color:"#FFE4B5",transparent:!0,opacity:.8})]},s)})]})}function te({progress:s,colorScheme:r,productShape:a="vase"}){const n=e.useRef(null),i=$[a].profile,o=e=>{for(let t=0;t<i.length-1;t++)if(e>=i[t].y&&e<=i[t+1].y){const s=(e-i[t].y)/(i[t+1].y-i[t].y);return i[t].r+s*(i[t+1].r-i[t].r)}return.35},c=e.useCallback((e=0,t=0)=>{const s=[];for(let r=0;r<=720;r++){const a=r/720,n=3*a,i=20*a*Math.PI*2+e,c=o(n),l=.02*Math.sin(8*i),d=.008*Math.sin(4*i),h=.005*Math.sin(a*Math.PI*6),m=c+l+t+.015;s.push(new u(m*Math.cos(i),n+d+h,m*Math.sin(i)))}return new h(s,!1,"catmullrom",.2)},[]),l=e.useCallback((e=0)=>{const t=[];for(let s=0;s<=288;s++){const r=s/288,a=3*r,n=12*-r*Math.PI*2+e,i=o(a)+.015*Math.sin(6*n)+.025;t.push(new u(i*Math.cos(n),a,i*Math.sin(n)))}return new h(t,!1,"catmullrom",.3)},[]),d=c(0,0),m=c(Math.PI/3,.01),x=l(0),p=l(Math.PI/2),g=e=>{const t=Math.floor(s*e.points.length);return t<2?null:new h(e.points.slice(0,Math.max(2,t)),!1,"catmullrom",.2)},f=g(d),j=g(m),y=g(x),b=g(p);if(!f)return null;const v=r?{light:r.highlight,medium:r.primary,dark:r.secondary,accent:r.accent}:{light:"#A67B4B",medium:"#8B5E34",dark:"#5D4E37",accent:"#C4956A"};return t.jsxs("group",{ref:n,children:[t.jsxs("mesh",{castShadow:!0,receiveShadow:!0,children:[t.jsx("tubeGeometry",{args:[f,Math.floor(600*s),.016,10,!1]}),t.jsx("meshStandardMaterial",{color:v.medium,roughness:.7,metalness:.05,envMapIntensity:.3})]}),j&&s>.05&&t.jsxs("mesh",{castShadow:!0,receiveShadow:!0,children:[t.jsx("tubeGeometry",{args:[j,Math.floor(500*s),.012,8,!1]}),t.jsx("meshStandardMaterial",{color:v.light,roughness:.65,metalness:.08})]}),y&&s>.1&&t.jsxs("mesh",{castShadow:!0,children:[t.jsx("tubeGeometry",{args:[y,Math.floor(250*s),.008,6,!1]}),t.jsx("meshStandardMaterial",{color:v.dark,roughness:.8,metalness:0})]}),b&&s>.15&&t.jsxs("mesh",{castShadow:!0,children:[t.jsx("tubeGeometry",{args:[b,Math.floor(200*s),.006,6,!1]}),t.jsx("meshStandardMaterial",{color:v.accent,roughness:.6,metalness:.1})]}),s>.2&&f&&t.jsxs("mesh",{children:[t.jsx("tubeGeometry",{args:[f,Math.floor(400*s),.02,8,!1]}),t.jsx("meshStandardMaterial",{color:v.accent,roughness:.4,metalness:.15,transparent:!0,opacity:.2})]}),s>0&&s<1&&t.jsxs("mesh",{position:[0,3*s,0],children:[t.jsx("torusGeometry",{args:[o(3*s)+.03,.015,8,32]}),t.jsx("meshBasicMaterial",{color:"#FFD700",transparent:!0,opacity:.4+.2*Math.sin(.01*Date.now())})]})]})}function se({progress:s,isWeaving:a}){const n=e.useRef(null),i=e.useRef(null),o=e.useRef(null),c=e.useRef(null),l=e.useRef(null),u=[{y:0,r:.35},{y:.3,r:.4},{y:.8,r:.55},{y:1.2,r:.5},{y:1.6,r:.35},{y:2,r:.25},{y:2.4,r:.35},{y:2.8,r:.45},{y:3,r:.5}];if(r(e=>{if(!n.current||s>=1)return;const t=3*s,r=18*s*Math.PI*2,d=(e=>{for(let t=0;t<u.length-1;t++)if(e>=u[t].y&&e<=u[t+1].y){const s=(e-u[t].y)/(u[t+1].y-u[t].y);return u[t].r+s*(u[t+1].r-u[t].r)}return.35})(t)+.05,h=d*Math.cos(r),m=d*Math.sin(r),x=e.clock.elapsedTime;if(n.current.position.set(h,t,m),i.current){const e=a?1+.4*Math.sin(12*x):1+.15*Math.sin(4*x);i.current.scale.setScalar(e)}if(o.current){o.current.rotation.z=2*x;const e=a?1.5+.5*Math.sin(8*x):1+.2*Math.sin(2*x);o.current.scale.setScalar(e)}c.current&&(c.current.rotation.x=Math.PI/2,c.current.rotation.z=-r),l.current&&(l.current.intensity=a?3:1)}),s>=1)return null;const d=a?"#FFD700":"#F2D974",h=a?"#FFA500":"#A73A36";return t.jsxs("group",{ref:n,children:[t.jsxs("mesh",{ref:i,children:[t.jsx("sphereGeometry",{args:[.03,16,16]}),t.jsx("meshStandardMaterial",{color:d,emissive:d,emissiveIntensity:a?4:1.5})]}),t.jsxs("mesh",{ref:o,children:[t.jsx("ringGeometry",{args:[.04,.08,6]}),t.jsx("meshBasicMaterial",{color:h,transparent:!0,opacity:a?.8:.4,side:m})]}),a&&t.jsxs("mesh",{ref:c,position:[0,0,0],children:[t.jsx("torusGeometry",{args:[.12,.008,8,32]}),t.jsx("meshBasicMaterial",{color:"#FFD700",transparent:!0,opacity:.5})]}),t.jsx("pointLight",{ref:l,color:d,intensity:2,distance:1,decay:2}),a&&t.jsxs(t.Fragment,{children:[t.jsxs("mesh",{position:[.08,.05,0],scale:.5,children:[t.jsx("sphereGeometry",{args:[.015,8,8]}),t.jsx("meshBasicMaterial",{color:"#FFE4B5",transparent:!0,opacity:.7})]}),t.jsxs("mesh",{position:[-.06,-.04,.05],scale:.4,children:[t.jsx("sphereGeometry",{args:[.015,8,8]}),t.jsx("meshBasicMaterial",{color:"#FFD700",transparent:!0,opacity:.6})]}),t.jsxs("mesh",{position:[.03,-.07,-.04],scale:.3,children:[t.jsx("sphereGeometry",{args:[.015,8,8]}),t.jsx("meshBasicMaterial",{color:"#FFA500",transparent:!0,opacity:.5})]})]})]})}function re({progress:s,isWeaving:a,handDataRef:n,viewMode:i}){const o=e.useRef(null),c=e.useRef(new u(2.5,2,2.5)),l=e.useRef(new u(0,.5,0)),h=e.useRef(0),m=e.useRef(0),x=e.useRef("outside"),g=e=>{const t=[{y:0,r:.35},{y:.8,r:.55},{y:1.6,r:.35},{y:2,r:.25},{y:2.8,r:.45},{y:3,r:.5}];for(let s=0;s<t.length-1;s++)if(e>=t[s].y&&e<=t[s+1].y){const r=(e-t[s].y)/(t[s+1].y-t[s].y);return t[s].r+r*(t[s+1].r-t[s].r)}return.4};return r((e,t)=>{if(!o.current)return;const r=s,d=e.clock.elapsedTime,f=3*r-1.5,j=18*r*Math.PI*2;if(!n.current)return;const{rotationSpeed:y,palmCenter:b}=n.current;if(a&&Math.abs(y)>3&&(h.current+=.005*y),"auto"===i&&a&&(m.current+=t,m.current>4)){m.current=0;const e=["outside","detail","inside"],t=e.indexOf(x.current);x.current=e[(t+1)%e.length]}const v="auto"===i?x.current:i;let w,M,N=50;if(a&&0!==r)if("overview"===v){const e=.04*d+h.current;w=new u(6*Math.cos(e),3,6*Math.sin(e)),M=new u(0,1.5,0),N=50}else if("inside"===v){const e=.3*g(f+1.5),t=.3*d+h.current;w=new u(Math.cos(t)*e,f+.2,Math.sin(t)*e);const s=g(f+1.5)+.05;M=new u(Math.cos(j)*s,f,Math.sin(j)*s),N=70}else if("detail"===v){const e=g(f+1.5)+.4,t=j+.7*Math.PI;w=new u(Math.cos(t)*e,f+.15,Math.sin(t)*e);const s=g(f+1.5)+.05;M=new u(Math.cos(j)*s,f,Math.sin(j)*s),N=55}else{const e=r*Math.PI*2+h.current;let t=2.2,s=.6;r<.2?(t=3-4*r,s=1.2-3*r):r>.8&&(t=2.2+4*(r-.8),s=.6+2*(r-.8)),w=new u(Math.cos(e)*t,f+s,Math.sin(e)*t),M=new u(0,.8*f,0),N=50}else{const e=.12*d+h.current;w=new u(3.2*Math.cos(e),1.2+.1*Math.sin(.25*d),3.2*Math.sin(e)),M=new u(0,.2,0),N=45}b&&a&&(w.x+=.1*(b.x-.5),M.y+=.05*(b.y-.5)),w.y+=.01*Math.sin(1.5*d);const S="detail"===v?3:1.5;c.current.lerp(w,t*S),l.current.lerp(M,t*S),o.current.position.copy(c.current),o.current.lookAt(l.current),o.current.fov=p.lerp(o.current.fov,N,2*t),o.current.updateProjectionMatrix()}),t.jsx(d,{ref:o,makeDefault:!0,fov:50})}function ae({progress:s,isWeaving:a}){const n=e.useRef(null),i=e.useRef(null),o=e.useRef(null),c=120,l=e.useRef(new Float32Array(240)),u=e.useRef(new Float32Array(360)),d=e.useRef(new Float32Array(120));return e.useEffect(()=>{for(let e=0;e<c;e++)u.current[3*e]=2*(Math.random()-.5),u.current[3*e+1]=4*Math.random()-.5,u.current[3*e+2]=2*(Math.random()-.5)},[]),r(e=>{const t=e.clock.elapsedTime,r=3*s,l=18*s*Math.PI*2;if(n.current&&a){const e=n.current.geometry.attributes.position.array;for(let s=0;s<80;s++){const a=s/80,n=(2*t+3*a)%3,i=l+a*Math.PI*4+3*t,o=.3+.15*Math.sin(a*Math.PI*2)+.1*n,c=r-.5+.5*n;e[3*s]=Math.cos(i)*o,e[3*s+1]=c,e[3*s+2]=Math.sin(i)*o}n.current.geometry.attributes.position.needsUpdate=!0}if(i.current){const e=i.current.geometry.attributes.position.array;for(let s=0;s<c;s++){const r=u.current[3*s+1],n=.02*Math.sin(.5*t+.1*s),i=a?.02*t:0;e[3*s]=u.current[3*s]+.05*Math.sin(t+s),e[3*s+1]=(r+i)%4-.5,e[3*s+2]=u.current[3*s+2]+n}i.current.geometry.attributes.position.needsUpdate=!0}if(o.current&&a&&s>0){const e=o.current.geometry.attributes.position.array;for(let t=0;t<40;t++){const r=Math.max(0,s-t/40*.03),a=3*r,n=18*r*Math.PI*2,i=.5+.02*Math.sin(8*n);e[3*t]=Math.cos(n)*i,e[3*t+1]=a,e[3*t+2]=Math.sin(n)*i}o.current.geometry.attributes.position.needsUpdate=!0}}),t.jsxs("group",{children:[a&&s<1&&t.jsxs("points",{ref:n,children:[t.jsx("bufferGeometry",{children:t.jsx("bufferAttribute",{attach:"attributes-position",count:80,array:l.current,itemSize:3})}),t.jsx("pointsMaterial",{color:"#FFD700",size:.025,transparent:!0,opacity:.9,blending:x})]}),t.jsxs("points",{ref:i,children:[t.jsx("bufferGeometry",{children:t.jsx("bufferAttribute",{attach:"attributes-position",count:c,array:u.current,itemSize:3})}),t.jsx("pointsMaterial",{color:"#D4AF37",size:.008,transparent:!0,opacity:a?.4:.2,blending:x})]}),a&&s>.01&&t.jsxs("points",{ref:o,children:[t.jsx("bufferGeometry",{children:t.jsx("bufferAttribute",{attach:"attributes-position",count:40,array:d.current,itemSize:3})}),t.jsx("pointsMaterial",{color:"#FFA500",size:.02,transparent:!0,opacity:.7,blending:x})]}),a&&s>0&&s<1&&t.jsxs("mesh",{position:[0,3*s,0],rotation:[-Math.PI/2,0,0],children:[t.jsx("ringGeometry",{args:[.2,.6,32]}),t.jsx("meshBasicMaterial",{color:"#FFD700",transparent:!0,opacity:.15,side:m,blending:x})]})]})}function ne({isWeaving:s}){const a=e.useRef(null);return r(e=>{a.current&&(a.current.rotation.y=.1*e.clock.elapsedTime,a.current.children.forEach((t,s)=>{t.position.y=1.5+.3*Math.sin(.5*e.clock.elapsedTime+s)}))}),t.jsxs("group",{children:[t.jsx("group",{ref:a,children:Array.from({length:8}).map((e,r)=>{const a=r/8*Math.PI*2;return t.jsxs("mesh",{position:[1.2*Math.cos(a),1.5,1.2*Math.sin(a)],children:[t.jsx("sphereGeometry",{args:[.015,8,8]}),t.jsx("meshBasicMaterial",{color:s?"#FFD700":"#8B7355",transparent:!0,opacity:s?.8:.4})]},r)})}),t.jsxs("mesh",{position:[0,.01,0],rotation:[-Math.PI/2,0,0],children:[t.jsx("ringGeometry",{args:[.3,.6,64]}),t.jsx("meshBasicMaterial",{color:s?"#FFD700":"#8B7355",transparent:!0,opacity:s?.2:.1,side:m})]})]})}function ie({progress:s,isComplete:o,isWeaving:c,handDataRef:l,viewMode:u,colorScheme:d,productShape:h}){const m=e.useRef(null),x=e.useRef(null);return r(e=>{if(x.current&&c){const t=1+.1*Math.sin(2*e.clock.elapsedTime);x.current.intensity=1.5*t}}),t.jsxs(t.Fragment,{children:[t.jsx(re,{progress:s,isWeaving:c,handDataRef:l,viewMode:u}),t.jsx("spotLight",{ref:x,position:[4,8,4],angle:.25,penumbra:.8,intensity:1.5,castShadow:!0,"shadow-mapSize":[2048,2048],"shadow-bias":-1e-4}),t.jsx("spotLight",{position:[-4,6,-2],angle:.4,penumbra:1,intensity:.6,color:"#E8E4D9"}),t.jsx("spotLight",{position:[0,4,-5],angle:.5,penumbra:1,intensity:.4,color:"#F2D974"}),t.jsx("ambientLight",{intensity:.25,color:"#FFF8F0"}),c&&t.jsx("pointLight",{position:[0,3*s-1.5+.5,0],intensity:.8,color:"#FFD700",distance:2,decay:2}),t.jsxs("group",{ref:m,position:[0,-1.2,0],scale:.8,children:[t.jsx(X,{productShape:h}),t.jsx(te,{progress:s,colorScheme:d,productShape:h}),t.jsx(se,{progress:s,isWeaving:c}),t.jsx(ae,{progress:s,isWeaving:c}),t.jsx(ne,{isWeaving:c}),t.jsx(ee,{isComplete:o})]}),t.jsx(a,{position:[0,-1.5,0],opacity:.5,scale:10,blur:2.5,far:4,color:"#2a1810"}),t.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-1.49,0],children:[t.jsx("ringGeometry",{args:[.8,1.2,64]}),t.jsx("meshBasicMaterial",{color:"#1a1208",transparent:!0,opacity:.15})]}),t.jsx(n,{files:"/heritage-harvest/studio_small_03_1k.hdr"}),t.jsx("color",{attach:"background",args:["#1a1612"]}),t.jsx("fog",{attach:"fog",args:["#1a1612",5,15]}),t.jsx(i,{enablePan:!1,enableZoom:!0,minDistance:1.2,maxDistance:5,minPolarAngle:Math.PI/6,maxPolarAngle:Math.PI/2.2,enableDamping:!0,dampingFactor:.08,rotateSpeed:.4})]})}function oe({progress:e,colors:s}){const r=s?{background:`linear-gradient(to right, ${s.primary}, ${s.accent})`}:void 0;return t.jsx("div",{className:"w-full bg-paper-600 rounded-full h-3 overflow-hidden",children:t.jsx(T.div,{className:"h-full rounded-full",style:r||{background:"linear-gradient(to right, #A73A36, #F2D974)"},initial:{width:0},animate:{width:100*e+"%"},transition:{duration:.1}})})}function ce({gesture:e,isTracking:s,isWeaving:r}){const a={fist:{icon:"âœŠ",text:"æ¡æ‹³ - å¿«é€Ÿç¼–ç»‡",color:"bg-palace-500",weaves:!0},pinch:{icon:"ğŸ¤",text:"æåˆ - ç²¾ç»†ç¼–ç»‡",color:"bg-palace-400",weaves:!0},pointing:{icon:"ğŸ‘†",text:"æŒ‡å‘ - ç¼“æ…¢ç¼–ç»‡",color:"bg-nature-500",weaves:!0},thumbsUp:{icon:"ğŸ‘",text:"ç‚¹èµ - åŠ é€Ÿç¼–ç»‡",color:"bg-gold-600",weaves:!0},peace:{icon:"âœŒï¸",text:"å‰ªåˆ€æ‰‹ - ç¼–ç»‡",color:"bg-nature-400",weaves:!0},open:{icon:"âœ‹",text:"å¼ å¼€ - æš‚åœ",color:"bg-mountain-400",weaves:!1},none:{icon:"â“",text:"æœªæ£€æµ‹åˆ°æ‰‹åŠ¿",color:"bg-mountain-500",weaves:!1}}[e];return t.jsxs(T.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:`flex items-center gap-2 px-4 py-2 rounded-full text-white ${a.color} ${r?"ring-2 ring-white ring-opacity-50 animate-pulse":""}`,children:[t.jsx("span",{className:"text-xl",children:a.icon}),t.jsx("span",{className:"text-sm font-medium",children:a.text}),s&&t.jsx("span",{className:"w-2 h-2 rounded-full "+(r?"bg-gold-300 animate-ping":"bg-white animate-pulse")})]})}function le(){var r;const a=N(),{unlockScene:n}=f(),[i,o]=e.useState(0),[c,l]=e.useState(!1),[u,d]=e.useState(!0),[h,m]=e.useState(!1),[x,p]=e.useState(!1),[X,ee]=e.useState("touch"),[te,se]=e.useState(!1),[re,ae]=e.useState("auto"),[ne,le]=e.useState(!1),[ue,de]=e.useState(!1),[he,me]=e.useState(!1),[xe,pe]=e.useState("none"),[ge,fe]=e.useState(null),[je]=e.useState(()=>function(){const e=Math.floor(1e6*Math.random()),t=Object.keys(U),s=["çµåŠ¨","ç²¾å·§","è´é›…","ç»¼æ¨ª","å¦™æƒ³","ç»†è…”","è‡ªç„¶","ç¼–éŸµ"],r=["èŠ±ç¯®","æ˜¥é£","ç«¹éŸµ","æ³‰å£°","æœˆå½±","äº‘çº¹","æµå½©","æ—¬å½±"],a=["lantern","basket","vase","sphere","sculpture"];return{seed:e,patternStyle:t[e%t.length],colorScheme:W[e%W.length],weaveDensity:.8+e%40/100,twistFactor:e%50/100,patternName:`${s[e%s.length]}Â·${r[(e>>4)%r.length]}`,productShape:a[(e>>8)%a.length]}}()),[ye,be]=e.useState(!1),[ve,we]=e.useState("classic"),[Me,Ne]=e.useState(0),[Se,ke]=e.useState(null),Fe=e.useRef([]),Ce=e.useRef(0),Te=e.useRef(0),Re=e.useRef(null),Ae=e.useRef(null),Ie=e.useRef(null),De=e.useRef(0),{state:Ee,handDataRef:Pe}=K(Ae,te),{audioState:Be,playAmbientMusic:Ge,stopAmbientMusic:Le,playWeavingSound:_e,playCompleteSound:$e,toggleMute:ze}=function(){const[t,s]=e.useState({isMuted:!1,volume:.5,isPlaying:!1}),r=e.useRef(null),a=e.useRef(null),n=e.useRef(null),i=e.useRef(!1),o=e.useCallback(()=>(r.current||(r.current=new(window.AudioContext||window.webkitAudioContext)),r.current),[]),c=e.useCallback((e,t,s,r,n)=>{const i=e.createOscillator();i.type="sine",i.frequency.value=t;const o=e.createGain();o.gain.setValueAtTime(0,s),o.gain.linearRampToValueAtTime(n,s+.01),o.gain.exponentialRampToValueAtTime(.6*n,s+.2*r),o.gain.exponentialRampToValueAtTime(.001,s+r);const c=e.createBiquadFilter();c.type="lowpass",c.frequency.value=2e3,i.connect(c),c.connect(o),o.connect(a.current||e.destination),i.start(s),i.stop(s+r)},[]),l=e.useCallback(()=>{if(!t.isMuted&&!i.current)try{const e=o();"suspended"===e.state&&e.resume(),i.current=!0;const r=e.createGain();r.gain.value=.3*t.volume,r.connect(e.destination),a.current=r;const l=[{note:261.63,beat:0,dur:2},{note:329.63,beat:1,dur:2},{note:392,beat:2,dur:2},{note:523.25,beat:3,dur:2},{note:220,beat:4,dur:2},{note:261.63,beat:5,dur:2},{note:329.63,beat:6,dur:2},{note:440,beat:7,dur:2},{note:174.61,beat:8,dur:2},{note:261.63,beat:9,dur:2},{note:349.23,beat:10,dur:2},{note:440,beat:11,dur:2},{note:196,beat:12,dur:2},{note:246.94,beat:13,dur:2},{note:392,beat:14,dur:2},{note:493.88,beat:15,dur:2}],u=.8,d=16*u;let h=0;const m=()=>{if(!i.current)return;const s=e.currentTime+.1;l.forEach(({note:r,beat:a,dur:n})=>{const i=s+a*u,o=n*u,l=.15*t.volume;c(e,r,i,o,l)}),h++,n.current=setTimeout(()=>{m()},1e3*d-100)};m(),s(e=>({...e,isPlaying:!0}))}catch(e){}},[t.isMuted,t.volume,o,c]),u=e.useCallback(()=>{if(i.current=!1,n.current&&(clearTimeout(n.current),n.current=null),a.current&&r.current){const e=r.current.currentTime;a.current.gain.linearRampToValueAtTime(0,e+.5)}s(e=>({...e,isPlaying:!1}))},[]),d=e.useCallback(()=>{if(!t.isMuted)try{const e=o(),s=e.currentTime,r=[523.25,587.33,659.25,783.99,880],a=r[Math.floor(Math.random()*r.length)],n=e.createOscillator();n.type="sine",n.frequency.value=a;const i=e.createGain();i.gain.setValueAtTime(0,s),i.gain.linearRampToValueAtTime(.08*t.volume,s+.01),i.gain.exponentialRampToValueAtTime(.001,s+.3),n.connect(i),i.connect(e.destination),n.start(s),n.stop(s+.3)}catch(e){}},[t.isMuted,t.volume,o]),h=e.useCallback(()=>{if(!t.isMuted)try{const e=o(),s=e.currentTime;[261.63,329.63,392,523.25,659.25,783.99,1046.5].forEach((r,a)=>{const n=e.createOscillator();n.type="sine",n.frequency.value=r;const i=e.createGain(),o=s+.15*a;i.gain.setValueAtTime(0,o),i.gain.linearRampToValueAtTime(.12*t.volume,o+.02),i.gain.exponentialRampToValueAtTime(.001,o+1.5),n.connect(i),i.connect(e.destination),n.start(o),n.stop(o+1.5)}),setTimeout(()=>{[261.63,329.63,392,523.25].forEach(s=>{const r=e.createOscillator();r.type="sine",r.frequency.value=s;const a=e.createGain();a.gain.setValueAtTime(.1*t.volume,e.currentTime),a.gain.exponentialRampToValueAtTime(.001,e.currentTime+2),r.connect(a),a.connect(e.destination),r.start(),r.stop(e.currentTime+2)})},1e3)}catch(e){}},[t.isMuted,t.volume,o]),m=e.useCallback(()=>{s(e=>{const t=!e.isMuted;return a.current&&(a.current.gain.value=t?0:.3*e.volume),{...e,isMuted:t}})},[]);return e.useEffect(()=>()=>{i.current=!1,n.current&&clearTimeout(n.current)},[]),{audioState:t,playAmbientMusic:l,stopAmbientMusic:u,playWeavingSound:d,playCompleteSound:h,toggleMute:m}}(),{lightImpact:Ue,success:We}=function(){const t=e.useCallback(e=>{if("undefined"!=typeof navigator&&navigator.vibrate)try{navigator.vibrate(e)}catch(t){}},[]),s=e.useCallback(()=>t(10),[t]),r=e.useCallback(()=>t(20),[t]),a=e.useCallback(()=>t([30,50,30]),[t]),n=e.useCallback(()=>t([50,100,50]),[t]);return{vibrate:t,lightImpact:s,mediumImpact:r,success:a,failure:n}}(),qe=e.useRef(0);e.useEffect(()=>{var e;if(he&&i>=.95&&!Ye.current){const s=null==(e=Re.current)?void 0:e.querySelector("canvas");if(s)try{const e=s.toDataURL("image/png");localStorage.setItem("weavingProductImage",e),localStorage.setItem("weavingProductTime",Date.now().toString()),Ye.current=!0}catch(t){}}},[he,i]),e.useEffect(()=>(window.__demoAutoWeave=()=>{d(!1),l(!0),me(!0);const e=["outside","detail","inside","outside","overview"],t=["fist","thumbsUp","peace","pinch","fist"];let s=0,r=0,a=0;ae(e[0]),pe(t[0]);let n=0;const i=setInterval(()=>{n+=.006,o(n);const c=Math.min(Math.floor(n*e.length),e.length-1);c!==s&&(s=c,ae(e[c]));const l=Math.min(Math.floor(n*t.length),t.length-1);l!==r&&(r=l,pe(t[l])),a+=.08,fe({x:.5+.15*Math.cos(a),y:.5+.1*Math.sin(a)}),n>=1&&(clearInterval(i),ae("overview"),pe("none"),fe(null),m(!0),me(!1))},100);return()=>{clearInterval(i),me(!1)}},window.__demoCloseModal=()=>{d(!1),l(!0),ae("overview")},window.__demoGetDesign=()=>({seed:je.seed,shape:je.productShape,pattern:je.patternName,colors:je.colorScheme}),()=>{delete window.__demoAutoWeave,delete window.__demoCloseModal,delete window.__demoGetDesign}),[je]);const Oe=e.useCallback(async()=>{if(Ie.current)try{document.fullscreenElement?(await document.exitFullscreen(),le(!1)):(await Ie.current.requestFullscreen(),le(!0))}catch(e){}},[]);e.useEffect(()=>{const e=()=>{le(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]),e.useEffect(()=>{if(c&&!u&&!ne&&Ie.current){const e=setTimeout(()=>{var e,t;null==(t=null==(e=Ie.current)?void 0:e.requestFullscreen)||t.call(e).catch(()=>{})},500);return()=>clearTimeout(e)}},[c,u]),e.useEffect(()=>{!c||u||h?c&&!h||Le():Ge()},[c,u,h,Ge,Le]);const Ve=te&&c&&!h&&(He=Ee.gesture,["fist","pinch","pointing","thumbsUp","peace"].includes(He))||he&&c&&!h&&"none"!==xe&&"open"!==xe;var He;e.useEffect(()=>{if(Ve){const e=Date.now();e-qe.current>150&&(_e(),Ue(),qe.current=e)}},[Ve,i,_e]),e.useEffect(()=>{c&&!u&&0===Ce.current&&(Ce.current=Date.now(),Fe.current=[])},[c,u]);const Ye=e.useRef(!1);e.useEffect(()=>{if(c&&!h&&i>Te.current){const e=i-Te.current;Fe.current.push(e),Te.current=i}},[i,c,h]),e.useEffect(()=>{if(h){$e(),We();const t=document.querySelectorAll("canvas"),s=t.length>1?t[1]:t[0];if(s)try{const e=s.toDataURL("image/png");localStorage.setItem("weavingProductImage",e),localStorage.setItem("weavingProductTime",Date.now().toString()),Ye.current=!0}catch(e){}const r=(Date.now()-Ce.current)/1e3,a=function(e,t,s){const r=Date.now(),a=r%1e3/1e3,n=s||r,i=e.length>0?e.reduce((e,t)=>e+t,0)/e.length:.5,o=Math.max(...e,.3);let c=0;if(e.length>1){for(let t=1;t<e.length;t++)c+=Math.abs(e[t]-e[t-1]);c/=e.length-1}const l=Math.max(20,Math.min(95,70+30*a-100*c)),u=new Set(e.map(e=>Math.round(10*e))).size,d=t%10*5,h=Math.max(25,Math.min(95,40+3*u+d+20*a)),m=Math.max(30,Math.min(95,50+t/30*20+25*a)),x=.25*l+.25*h+.25*m+.25*(80*i+20),p=Math.max(15,Math.min(95,x+15*(a-.5))),g=z.find(e=>p>=e.min&&p<e.max)||z[2],f=Object.keys($),j=f[(n+Math.floor(10*t))%f.length],y=["çµå·§","ç»†è…»","æ²‰ç¨³","åˆ›æ„","ä¸“æ³¨","è‡ªç„¶","æµç•…","è‰ºæœ¯","ç²¾å·§","é›…è‡´","åŒ å¿ƒ","å¦™æ‰‹"],b=["ç¼–ç»‡å¸ˆ","è—¤è‰ºå®¶","åŒ äºº","åˆ›ä½œè€…","æ‰‹è‰ºäºº","å·¥è‰ºå¸ˆ","ç»‡é€ è€…","ç¼–è‰ºäºº"],v=(n+Math.floor(l))%y.length,w=(Math.floor(r/1e3)+Math.floor(h))%b.length,M=`${y[v]}${b[w]}`;return{rhythmPattern:e.slice(-20),totalTime:t,avgSpeed:i,peakSpeed:o,smoothness:Math.round(l),creativity:Math.round(h),persistence:Math.round(m),craftLevel:g.level,uniqueTitle:M,productStyle:j}}(Fe.current,r,je.seed);ke(a),n("bamboo_forest");const i=50+Math.floor(.3*a.smoothness+.2*a.creativity);j.getState().addPoints({type:"experience",points:i,description:`å®Œæˆè—¤ç¼–ä½“éªŒ - ${a.uniqueTitle}`,relatedId:"bamboo_weaving"}),y.getState().addCarbonSaving({type:"digital_experience",carbonSaved:b.bamboo_weaving.baseSaving,description:b.bamboo_weaving.description,experienceId:"bamboo_weaving"});const o=localStorage.getItem("weavingProductImage");o&&M.getState().addWeavingArtwork({image:o,title:a.uniqueTitle,craftLevel:a.craftLevel,productStyle:a.productStyle,colorScheme:je.colorScheme,smoothness:a.smoothness,creativity:a.creativity,persistence:a.persistence,carbonSaved:b.bamboo_weaving.baseSaving,pointsEarned:i,seed:je.seed}),w.getState().recordExperienceComplete("bamboo_weaving")}},[h,$e,We,n]),e.useEffect(()=>{if(!te||!c||h)return;const e=setInterval(()=>{const t=(e=>({fist:.008,thumbsUp:.012,pinch:.004,pointing:.003,peace:.006,open:0,none:0}[e]))(Ee.gesture);t>0&&o(s=>{const r=Math.min(1,s+t);return r>=1&&(m(!0),setTimeout(()=>p(!0),1e3),clearInterval(e)),r})},50);return()=>clearInterval(e)},[te,c,h,Ee.gesture]);const Ze=e.useCallback(e=>{if(!c||h||"touch"!==X)return;const t=.003*(De.current-e);De.current=e,o(e=>{const s=Math.max(0,Math.min(1,e+t));return s>=1&&!h&&(m(!0),setTimeout(()=>p(!0),1e3)),s})},[c,h,X]),Je=()=>{ee("hand"),se(!0),d(!1),l(!0)},Ke=()=>{o(0),l(!1),m(!1),p(!1),d(!0),se(!1),ee("touch")},Qe=e.useRef(null);return e.useEffect(()=>{if(!Ee.landmarks||!Qe.current)return;const e=Qe.current,t=e.getContext("2d");if(!t)return;t.clearRect(0,0,e.width,e.height);const s=Ee.landmarks;t.strokeStyle="#A73A36",t.lineWidth=2,[[0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[0,9],[9,10],[10,11],[11,12],[0,13],[13,14],[14,15],[15,16],[0,17],[17,18],[18,19],[19,20],[5,9],[9,13],[13,17]].forEach(([r,a])=>{const n=s[r],i=s[a];t.beginPath(),t.moveTo((1-n.x)*e.width,n.y*e.height),t.lineTo((1-i.x)*e.width,i.y*e.height),t.stroke()}),s.forEach((s,r)=>{t.beginPath(),t.arc((1-s.x)*e.width,s.y*e.height,0===r?6:4,0,2*Math.PI),t.fillStyle=0===r?"#F2D974":"#A73A36",t.fill(),t.strokeStyle="#fff",t.lineWidth=1,t.stroke()})},[Ee.landmarks]),t.jsxs("div",{ref:Ie,className:"relative w-full h-screen bg-gradient-to-b from-paper-500 to-paper-300 overflow-hidden",children:[t.jsxs("div",{className:"absolute z-20 transition-all duration-300 "+(te?"bottom-24 right-4 w-64 h-48 rounded-xl overflow-hidden shadow-card border-2 border-palace-500":"w-0 h-0 opacity-0"),children:[t.jsx("video",{ref:Ae,className:"absolute inset-0 w-full h-full object-cover transform -scale-x-100",playsInline:!0,muted:!0}),t.jsx("canvas",{ref:Qe,width:256,height:192,className:"absolute inset-0 w-full h-full pointer-events-none"}),te&&t.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[Ee.isLoading&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:t.jsxs("div",{className:"text-center text-white",children:[t.jsx("div",{className:"w-8 h-8 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto mb-2"}),t.jsx("span",{className:"text-xs",children:"åŠ è½½æ‰‹éƒ¨æ¨¡å‹..."})]})}),Ee.error&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-500/80",children:t.jsx("div",{className:"text-center text-white p-2",children:t.jsxs("span",{className:"text-xs",children:["âŒ ",Ee.error]})})}),!Ee.isLoading&&!Ee.error&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"absolute top-2 left-2",children:t.jsx("span",{className:"px-2 py-1 text-white text-xs rounded-full flex items-center gap-1 "+(Ee.isTracking?"bg-nature-500":"bg-gold-500"),children:Ee.isTracking?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),"è¿½è¸ªä¸­"]}):"ç­‰å¾…æ£€æµ‹..."})}),t.jsx("div",{className:"absolute bottom-2 left-2 right-2 text-center",children:t.jsxs("span",{className:"text-sm font-bold px-3 py-1 rounded "+("fist"===Ee.gesture||"pinch"===Ee.gesture||"thumbsUp"===Ee.gesture||"peace"===Ee.gesture?"bg-palace-500 text-white":"open"===Ee.gesture?"bg-mountain-400 text-white":"bg-black/50 text-white"),children:["fist"===Ee.gesture&&"âœŠ æ¡æ‹³ç¼–ç»‡","pinch"===Ee.gesture&&"ğŸ¤ ç²¾ç»†ç¼–ç»‡","thumbsUp"===Ee.gesture&&"ğŸ‘ åŠ é€Ÿç¼–ç»‡","peace"===Ee.gesture&&"âœŒï¸ ç¼–ç»‡ä¸­","pointing"===Ee.gesture&&"ğŸ‘† ç¼“æ…¢ç¼–ç»‡","open"===Ee.gesture&&"âœ‹ æš‚åœ","none"===Ee.gesture&&"æœªè¯†åˆ«"]})})]})]})]}),t.jsx("div",{ref:Re,className:"absolute inset-0 cursor-grab active:cursor-grabbing",onMouseDown:e=>{De.current=e.clientY,c||"touch"!==X||(l(!0),d(!1))},onMouseMove:e=>{1===e.buttons&&"touch"===X&&Ze(e.clientY)},onTouchStart:e=>{De.current=e.touches[0].clientY,c||"touch"!==X||(l(!0),d(!1))},onTouchMove:e=>{"touch"===X&&Ze(e.touches[0].clientY)},children:t.jsx(s,{shadows:!0,gl:{preserveDrawingBuffer:!0},children:t.jsx(e.Suspense,{fallback:t.jsx(Q,{}),children:t.jsx(ie,{progress:i,isComplete:h,isWeaving:Ve,handDataRef:Pe,viewMode:re,colorScheme:je.colorScheme,productShape:je.productShape})})})}),t.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-mountain-900/80 to-transparent z-10",children:t.jsxs("div",{className:"max-w-lg mx-auto",children:[t.jsxs("div",{className:"flex items-center justify-between text-white mb-2",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold",children:"å®‰æºªè—¤é“å·¥è‰º"}),t.jsx("p",{className:"text-sm text-white/70",children:"hand"===X?"ğŸ–ï¸ æ‰‹åŠ¿ç¼–ç»‡æ¨¡å¼":"ğŸ‘† è§¦æ§ç¼–ç»‡æ¨¡å¼"}),t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.jsxs("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium text-white",style:{background:`linear-gradient(to right, ${je.colorScheme.primary}, ${je.colorScheme.accent})`},children:[U[je.patternStyle].icon," ",je.patternName]}),t.jsxs("span",{className:"px-1.5 py-0.5 rounded text-xs font-mono",style:{backgroundColor:je.colorScheme.secondary,color:je.colorScheme.highlight},children:["#",je.seed.toString(16).toUpperCase()]})]}),t.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[Object.values(je.colorScheme).map((e,s)=>t.jsx("div",{className:"w-3 h-3 rounded-full border border-white/30",style:{backgroundColor:e},title:e},s)),t.jsx("span",{className:"text-[10px] text-white/40 ml-1",children:(null==(r=W.find(e=>e.primary===je.colorScheme.primary))?void 0:r.name)||"è‡ªå®šä¹‰"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:ze,className:"p-2 rounded-full transition-colors "+(Be.isMuted?"bg-red-500/50 text-white":"bg-white/10 hover:bg-white/20 text-white"),title:Be.isMuted?"å¼€å¯å£°éŸ³":"é™éŸ³",children:Be.isMuted?t.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]}):t.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})})}),t.jsx("button",{onClick:()=>"hand"===X?Ke():Je(),className:"p-2 rounded-full transition-colors "+("hand"===X?"bg-palace-500 text-white":"bg-white/10 hover:bg-white/20 text-white"),title:"hand"===X?"åˆ‡æ¢åˆ°è§¦æ§æ¨¡å¼":"å¼€å¯æ‰‹åŠ¿è¿½è¸ª",children:"hand"===X?t.jsx(S,{className:"w-5 h-5"}):t.jsx(k,{className:"w-5 h-5"})}),t.jsx("button",{onClick:Ke,className:"p-2 rounded-full bg-white/10 hover:bg-white/20",children:t.jsx(F,{className:"w-5 h-5"})})]})]}),t.jsx(oe,{progress:i,colors:{primary:je.colorScheme.primary,accent:je.colorScheme.accent}}),t.jsxs("p",{className:"text-xs text-white/60 mt-1 text-center",children:["ç¼–ç»‡è¿›åº¦ ",Math.floor(100*i),"%"]})]})}),te&&c&&!he&&t.jsx("div",{className:"absolute top-28 left-1/2 -translate-x-1/2 z-20",children:t.jsx(ce,{gesture:Ee.gesture,isTracking:Ee.isTracking,isWeaving:Ve})}),he&&c&&t.jsx("div",{className:"absolute top-28 left-1/2 -translate-x-1/2 z-20",children:t.jsx(ce,{gesture:xe,isTracking:!0,isWeaving:"none"!==xe&&"open"!==xe})}),he&&ge&&t.jsxs("div",{className:"absolute z-30 pointer-events-none",style:{left:100*ge.x+"%",top:100*ge.y+"%",transform:"translate(-50%, -50%)"},children:[t.jsx("div",{className:"absolute w-16 h-16 -left-8 -top-8 rounded-full border-2 border-gold-400/50 animate-ping"}),t.jsx("div",{className:"absolute w-12 h-12 -left-6 -top-6 rounded-full border-2 border-gold-400/70 animate-pulse"}),t.jsx("div",{className:"w-4 h-4 rounded-full bg-gold-500 shadow-lg shadow-gold-500/50"}),t.jsxs("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 text-2xl animate-bounce",children:["fist"===xe&&"âœŠ","thumbsUp"===xe&&"ğŸ‘","peace"===xe&&"âœŒï¸","pinch"===xe&&"ğŸ¤","open"===xe&&"âœ‹","none"===xe&&"ğŸ–ï¸"]})]}),c&&!u&&t.jsxs("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 z-20 flex flex-col gap-2",children:[[{mode:"auto",icon:"ğŸ¬",label:"è‡ªåŠ¨"},{mode:"outside",icon:"ğŸŒ",label:"å¤–éƒ¨"},{mode:"inside",icon:"ğŸ‘ï¸",label:"å†…éƒ¨"},{mode:"detail",icon:"ğŸ”",label:"ç»†èŠ‚"},{mode:"overview",icon:"ğŸ”ï¸",label:"å…¨è²Œ"}].map(({mode:e,icon:s,label:r})=>t.jsxs("button",{onClick:()=>ae(e),className:"w-12 h-12 rounded-xl flex flex-col items-center justify-center transition-all "+(re===e?"bg-palace-500 text-white scale-110 shadow-lg":"bg-black/40 text-white/80 hover:bg-black/60 hover:scale-105"),title:r,children:[t.jsx("span",{className:"text-lg",children:s}),t.jsx("span",{className:"text-[10px]",children:r})]},e)),t.jsx("div",{className:"w-8 h-px bg-white/20 mx-auto my-1"}),t.jsxs("button",{onClick:Oe,className:"w-12 h-12 rounded-xl flex flex-col items-center justify-center transition-all "+(ne?"bg-gold-500 text-white":"bg-black/40 text-white/80 hover:bg-black/60"),title:ne?"é€€å‡ºå…¨å±":"å…¨å±æ¨¡å¼",children:[t.jsx("span",{className:"text-lg",children:"â›¶"}),t.jsx("span",{className:"text-[10px]",children:ne?"é€€å‡º":"å…¨å±"})]})]}),t.jsx(C,{children:u&&t.jsx(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"absolute bottom-32 left-1/2 -translate-x-1/2 w-96 max-w-[90vw] z-20",children:t.jsxs("div",{className:"bg-white/95 backdrop-blur rounded-2xl p-6 shadow-card text-center",children:[t.jsx(R,{className:"w-12 h-12 mx-auto mb-3 text-palace-500"}),t.jsx("h3",{className:"text-lg font-bold text-mountain-700 mb-2",children:"ä½“éªŒè—¤é“ç¼–ç»‡æŠ€è‰º"}),t.jsx("p",{className:"text-sm text-mountain-500 mb-4",children:"é€‰æ‹©äº¤äº’æ–¹å¼ï¼Œæ„Ÿå—ä¼ ç»Ÿæ‰‹å·¥è‰ºçš„é­…åŠ›"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs(v,{variant:"heritage",onClick:()=>{ee("touch"),l(!0),d(!1)},className:"w-full",children:[t.jsx(A,{className:"w-4 h-4 mr-2"}),"è§¦æ§ç¼–ç»‡ï¼ˆå‘ä¸Šæ»‘åŠ¨ï¼‰"]}),t.jsxs(v,{variant:"outline-heritage",onClick:Je,className:"w-full",children:[t.jsx(k,{className:"w-4 h-4 mr-2"}),"æ‰‹åŠ¿ç¼–ç»‡ï¼ˆé«˜çº§ä½“éªŒï¼‰"]})]}),t.jsxs("div",{className:"mt-4 p-3 bg-paper-100 rounded-xl text-left",children:[t.jsx("p",{className:"text-xs font-medium text-mountain-600 mb-2",children:"ğŸ® æ‰‹åŠ¿æ“ä½œæŒ‡å—ï¼š"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-mountain-500",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{children:"âœŠ"})," æ¡æ‹³ = å¿«é€Ÿç¼–ç»‡"]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{children:"ğŸ‘"})," ç‚¹èµ = æœ€å¿«ç¼–ç»‡"]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{children:"âœŒï¸"})," å‰ªåˆ€æ‰‹ = ä¸­é€Ÿç¼–ç»‡"]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{children:"ğŸ¤"})," æåˆ = ç²¾ç»†ç¼–ç»‡"]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{children:"âœ‹"})," å¼ å¼€ = æš‚åœç¼–ç»‡"]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{children:"ğŸ”„"})," æ—‹è½¬ = è½¬åŠ¨è§†è§’"]})]})]})]})})}),t.jsx(C,{children:x&&t.jsx(T.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"absolute inset-0 flex items-center justify-center bg-black/60 z-50 overflow-y-auto py-8",children:t.jsxs("div",{className:"bg-white rounded-3xl p-6 max-w-md mx-4 text-center",children:[t.jsx(T.div,{animate:{rotate:[0,10,-10,0],scale:[1,1.1,1]},transition:{duration:.5,repeat:2},children:t.jsx("div",{className:"w-16 h-16 mx-auto mb-3 bg-gradient-to-br from-eco-400 to-eco-600 rounded-2xl flex items-center justify-center shadow-heritage",children:t.jsx(I,{className:"w-8 h-8 text-white"})})}),t.jsx("h3",{className:"text-xl font-bold text-mountain-800 mb-2",children:"ğŸ‹ ç¼–ç»‡å®Œæˆï¼"}),t.jsx("p",{className:"text-mountain-500 mb-3 text-sm",children:"æ­å–œå®Œæˆè—¤ç¼–ä½“éªŒï¼Œäº†è§£ä»¥ç«¹ä»£å¡‘çš„ç¯ä¿æ™ºæ…§"}),t.jsxs("div",{className:"bg-gradient-to-br from-eco-50 to-eco-100 rounded-xl p-4 mb-4",children:[t.jsxs("div",{className:"flex items-center justify-center gap-2 mb-3",children:[t.jsx(D,{className:"w-5 h-5 text-eco-600"}),t.jsx("h4",{className:"font-bold text-eco-700",children:"ä»¥ç«¹ä»£å¡‘ Â· ç¯ä¿æ•°æ®"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[t.jsxs("div",{className:"bg-white/80 rounded-lg p-2",children:[t.jsxs("div",{className:"text-eco-600 font-bold text-lg",children:[q,"g"]}),t.jsx("div",{className:"text-mountain-500 text-xs",children:"å‡å°‘å¡‘æ–™ä½¿ç”¨"})]}),t.jsxs("div",{className:"bg-white/80 rounded-lg p-2",children:[t.jsxs("div",{className:"text-eco-600 font-bold text-lg",children:[Z,"%"]}),t.jsx("div",{className:"text-mountain-500 text-xs",children:"ç¢³æ’æ”¾å‡å°‘"})]}),t.jsxs("div",{className:"bg-white/80 rounded-lg p-2",children:[t.jsxs("div",{className:"text-red-500 font-bold text-lg",children:[O,"å¹´"]}),t.jsx("div",{className:"text-mountain-500 text-xs",children:"å¡‘æ–™åˆ†è§£æ—¶é—´"})]}),t.jsxs("div",{className:"bg-white/80 rounded-lg p-2",children:[t.jsxs("div",{className:"text-eco-600 font-bold text-lg",children:[V,"æœˆ"]}),t.jsx("div",{className:"text-mountain-500 text-xs",children:"ç«¹å­åˆ†è§£æ—¶é—´"})]})]}),t.jsxs("div",{className:"mt-3 text-xs text-eco-700 bg-white/60 rounded-lg p-2",children:[t.jsx(E,{className:"w-4 h-4 inline mr-1"}),"ç«¹å­å¯å†ç”Ÿ",J,"æ¬¡ï¼Œæ¯å…¬é¡·ç«¹æ—å¹´å›ºç¢³",Y,"å¨"]})]}),Se&&t.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-4 mb-4 border border-amber-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-2xl",children:$[Se.productStyle].icon}),t.jsxs("div",{className:"text-left",children:[t.jsx("p",{className:"font-bold text-amber-800",children:Se.uniqueTitle}),t.jsxs("p",{className:"text-xs text-amber-600",children:["ç¼–ç»‡DNA #",je.seed.toString(16).toUpperCase()]})]})]}),t.jsx("div",{className:"px-3 py-1 bg-amber-500 text-white rounded-full text-sm font-bold",children:Se.craftLevel})]}),t.jsxs("div",{className:"grid grid-cols-4 gap-2 mb-3",children:[t.jsxs("div",{className:"bg-white/80 rounded-lg p-2 text-center",children:[t.jsx("div",{className:"text-amber-600 font-bold",children:Math.round(Se.smoothness)}),t.jsx("div",{className:"text-[10px] text-amber-500",children:"å¹³æ»‘åº¦"})]}),t.jsxs("div",{className:"bg-white/80 rounded-lg p-2 text-center",children:[t.jsx("div",{className:"text-amber-600 font-bold",children:Math.round(Se.creativity)}),t.jsx("div",{className:"text-[10px] text-amber-500",children:"åˆ›æ„åº¦"})]}),t.jsxs("div",{className:"bg-white/80 rounded-lg p-2 text-center",children:[t.jsx("div",{className:"text-amber-600 font-bold",children:Math.round(Se.persistence)}),t.jsx("div",{className:"text-[10px] text-amber-500",children:"åšæŒåº¦"})]}),t.jsxs("div",{className:"bg-white/80 rounded-lg p-2 text-center",children:[t.jsxs("div",{className:"text-amber-600 font-bold",children:[Math.round(Se.totalTime),"s"]}),t.jsx("div",{className:"text-[10px] text-amber-500",children:"ç”¨æ—¶"})]})]}),t.jsxs("div",{className:"bg-white/60 rounded-lg p-2 text-center",children:[t.jsxs("p",{className:"text-sm text-amber-700",children:["ğŸ ä½ çš„ä¸“å±æˆå“ï¼š",t.jsx("span",{className:"font-bold",children:$[Se.productStyle].name})]}),t.jsx("p",{className:"text-xs text-amber-500",children:$[Se.productStyle].desc})]})]}),t.jsx("div",{className:"bg-paper-100 rounded-xl p-3 mb-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-10 h-10 bg-eco-500 rounded-lg flex items-center justify-center",children:t.jsx(P,{className:"w-5 h-5 text-white"})}),t.jsxs("div",{className:"text-left",children:[t.jsxs("p",{className:"font-bold text-mountain-800 text-sm",children:["+",b.bamboo_weaving.baseSaving,"g ç¢³å‡æ’"]}),t.jsxs("p",{className:"text-xs text-mountain-500",children:["+",50+(Se?Math.floor(.3*Se.smoothness+.2*Se.creativity):0)," ç»¿è‰²ç§¯åˆ†"]})]})]}),t.jsx("div",{className:"w-10 h-10 bg-palace-500 rounded-lg flex items-center justify-center",children:t.jsx(B,{className:"w-5 h-5 text-white"})})]})}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(v,{variant:"heritage",className:"w-full",onClick:()=>{o(0),m(!1),p(!1),l(!0)},children:[t.jsx(F,{className:"w-4 h-4 mr-2"}),"å†æ¥ä¸€æ¬¡"]}),t.jsxs(v,{variant:"outline-heritage",className:"w-full flex items-center justify-center gap-2",onClick:()=>{if(n("bamboo_forest"),Re.current){const e=Re.current.querySelector("canvas");if(e)try{const t=e.toDataURL("image/png");localStorage.setItem("weavingProductImage",t),localStorage.setItem("weavingProductTime",Date.now().toString())}catch(r){}}const e=je.colorScheme?`&primary=${encodeURIComponent(je.colorScheme.primary)}&secondary=${encodeURIComponent(je.colorScheme.secondary)}&accent=${encodeURIComponent(je.colorScheme.accent)}&highlight=${encodeURIComponent(je.colorScheme.highlight)}`:"",t=`&shape=${je.productShape}`,s=Se?`&title=${encodeURIComponent(Se.uniqueTitle)}&level=${encodeURIComponent(Se.craftLevel)}&product=${Se.productStyle}&smooth=${Math.round(Se.smoothness)}&creative=${Math.round(Se.creativity)}`:"";a(`/experience/ai-polaroid?scene=bamboo_forest&design=${je.seed}${s}${e}${t}&render3d=true`)},children:[t.jsx(k,{className:"w-4 h-4"}),"ç”Ÿæˆä¸“å±æ‹ç«‹å¾—"]}),t.jsxs(v,{variant:"ghost",className:"w-full flex items-center justify-center gap-2 text-mountain-600",onClick:()=>de(!0),children:[t.jsx(G,{className:"w-4 h-4"}),"åˆ†äº«åˆ°ç¤¾äº¤åª’ä½“"]}),t.jsx(v,{variant:"ghost",className:"w-full text-mountain-500",onClick:Ke,children:"è¿”å›é€‰æ‹©"})]})]})})}),t.jsx(C,{children:ue&&t.jsx(T.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 flex items-center justify-center bg-black/60 z-50 p-4 overflow-y-auto",children:t.jsxs(T.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-white rounded-2xl p-4 max-w-md w-full max-h-[90vh] overflow-y-auto relative",children:[t.jsx("button",{onClick:()=>de(!1),className:"absolute top-3 right-3 p-2 rounded-full hover:bg-gray-100 transition-colors",children:t.jsx(L,{className:"w-5 h-5 text-gray-500"})}),t.jsx("h3",{className:"text-lg font-bold text-center mb-4 text-mountain-800",children:"ğŸ‹ åˆ†äº«ä½ çš„ç¯ä¿æˆæœ"}),t.jsx(g,{customMessage:`æˆ‘åˆšå®Œæˆäº†è—¤ç¼–ä½“éªŒï¼Œäº†è§£åˆ°ä»¥ç«¹ä»£å¡‘å¯å‡å°‘${Z}%ç¢³æ’æ”¾ï¼`,onShare:()=>de(!1)})]})})}),t.jsx("div",{className:"absolute left-[15%] top-1/2 -translate-y-1/2 z-5",children:t.jsxs("div",{className:"flex items-center gap-3",style:{writingMode:"vertical-rl",textOrientation:"mixed"},children:[t.jsx(D,{className:"w-5 h-5 text-eco-400"}),t.jsxs("div",{className:"text-white/90 text-sm leading-relaxed",children:[t.jsx("p",{className:"font-bold text-eco-300 text-base",children:"ğŸ‹ ä»¥ç«¹ä»£å¡‘ Â· ç»¿è‰²æ™ºæ…§"}),t.jsx("p",{className:"text-sm text-white/70 mt-3",children:"ç«¹å­æ˜¯åœ°çƒä¸Šç”Ÿé•¿æœ€å¿«çš„æ¤ç‰©ä¹‹ä¸€"}),t.jsxs("p",{className:"text-sm text-white/70 mt-2",children:[H,"å¹´å³å¯æˆæ"]}),t.jsxs("p",{className:"text-sm text-white/70 mt-2",children:["å‡å°‘",t.jsxs("span",{className:"text-eco-300 font-bold",children:[Z,"%"]}),"ç¢³æ’æ”¾"]}),t.jsxs("p",{className:"text-sm text-white/70 mt-2",children:[t.jsxs("span",{className:"text-eco-300 font-bold",children:[V,"ä¸ªæœˆ"]}),"è‡ªç„¶åˆ†è§£"]})]})]})}),t.jsx("div",{className:"absolute right-[15%] top-1/2 -translate-y-1/2 z-5",children:t.jsxs("div",{className:"flex items-center gap-3",style:{writingMode:"vertical-rl",textOrientation:"mixed"},children:[t.jsx(_,{className:"w-5 h-5 text-gold-400"}),t.jsxs("div",{className:"text-white/90 text-sm leading-relaxed",children:[t.jsx("p",{className:"font-bold text-gold-300 text-base",children:"å®‰æºªè—¤é“å·¥è‰º"}),t.jsx("p",{className:"text-sm text-white/70 mt-3",children:"å›½å®¶çº§éç‰©è´¨æ–‡åŒ–é—äº§"}),t.jsx("p",{className:"text-sm text-white/70 mt-2",children:"ä»¥é“ä¸ä¸ºéª¨æ¶"}),t.jsx("p",{className:"text-sm text-white/70 mt-2",children:"ç”¨è—¤æ¡ç¼ ç»•ç¼–ç»‡"}),t.jsx("p",{className:"text-sm text-white/70 mt-2",children:"åˆ›é€ ç²¾ç¾å·¥è‰ºå“"}),t.jsx("p",{className:"text-sm text-gold-300 font-bold mt-2",children:'"æŒ‡å°–ä¸Šçš„è‰ºæœ¯"'})]})]})})]})}export{le as default};
