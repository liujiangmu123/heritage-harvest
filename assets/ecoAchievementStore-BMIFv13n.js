import{c as e}from"./core-vendor-Csnc5NqJ.js";import{p as n,k as t,u as o}from"./index-BZ3c0gis.js";const c=e()(n((e,n)=>({achievements:t.map(e=>({...e})),unlockedIds:[],achievementProgress:{},recentUnlocks:[],quizCorrectCount:0,experienceCompleteCount:{},shareCount:0,polaroidCount:0,pledgeCount:0,timelineViewed:!1,knowledgeGraphProgress:0,seasonalActivityCount:0,checkAndUnlockAchievement:t=>{const c=n();if(c.unlockedIds.includes(t))return!1;const r=c.achievements.find(e=>e.id===t);if(!r)return!1;const i=(new Date).toISOString(),s={...r,unlocked:!0,unlockedAt:i};return e(e=>({unlockedIds:[...e.unlockedIds,t],achievements:e.achievements.map(e=>e.id===t?s:e),recentUnlocks:[{achievement:s,timestamp:i},...e.recentUnlocks.slice(0,9)]})),r.pointsReward>0&&o.getState().addPoints({type:"learn",points:r.pointsReward,description:`解锁成就: ${r.name}`,relatedId:t}),!0},updateProgress:(t,o)=>{const c=n().achievements.find(e=>e.id===t);if(!c||!c.maxProgress)return!1;const r=Math.min(o,c.maxProgress);return e(e=>({achievementProgress:{...e.achievementProgress,[t]:r},achievements:e.achievements.map(e=>e.id===t?{...e,progress:r}:e)})),r>=c.maxProgress&&n().checkAndUnlockAchievement(t)},incrementQuizCorrect:()=>{e(e=>({quizCorrectCount:e.quizCorrectCount+1}));const t=n();1===t.quizCorrectCount&&t.checkAndUnlockAchievement("eco-learner"),t.quizCorrectCount>=50&&t.checkAndUnlockAchievement("eco-scholar")},recordExperienceComplete:t=>{e(e=>({experienceCompleteCount:{...e.experienceCompleteCount,[t]:(e.experienceCompleteCount[t]||0)+1}}));const o=n(),c={hani_terrace:"terrace-explorer",bamboo_weaving:"bamboo-advocate",paper_cutting:"paper-artist",clay_sculpture:"clay-craftsman",shadow_puppet:"shadow-master"};c[t]&&o.checkAndUnlockAchievement(c[t]);["hani_terrace","bamboo_weaving","paper_cutting","clay_sculpture","shadow_puppet"].filter(e=>o.experienceCompleteCount[e]).length>=5&&o.checkAndUnlockAchievement("all-experiences")},recordShare:()=>{e(e=>({shareCount:e.shareCount+1}));const t=n();t.shareCount>=3&&t.checkAndUnlockAchievement("eco-sharer")},recordPolaroid:()=>{e(e=>({polaroidCount:e.polaroidCount+1}));const t=n();t.polaroidCount>=5&&t.checkAndUnlockAchievement("polaroid-collector")},recordPledge:()=>{e(e=>({pledgeCount:e.pledgeCount+1}));const t=n();1===t.pledgeCount&&t.checkAndUnlockAchievement("pledge-maker")},recordTimelineView:()=>{e({timelineViewed:!0}),n().checkAndUnlockAchievement("eco-historian")},updateKnowledgeGraphProgress:t=>{e({knowledgeGraphProgress:t}),t>=50&&n().checkAndUnlockAchievement("knowledge-explorer")},recordSeasonalActivity:()=>{e(e=>({seasonalActivityCount:e.seasonalActivityCount+1}));const t=n();t.seasonalActivityCount>=3&&t.checkAndUnlockAchievement("seasonal-participant")},getAchievement:e=>{const t=n(),o=t.achievements.find(n=>n.id===e);if(o)return{...o,progress:t.achievementProgress[e]||o.progress}},getUnlockedAchievements:()=>{const e=n();return e.achievements.filter(n=>e.unlockedIds.includes(n.id))},getLockedAchievements:()=>{const e=n();return e.achievements.filter(n=>!e.unlockedIds.includes(n.id))},getAchievementsByCategory:e=>n().achievements.filter(n=>n.category===e),getRecentUnlocks:(e=5)=>n().recentUnlocks.slice(0,e),getCompletionPercentage:()=>{const e=n();return Math.round(e.unlockedIds.length/e.achievements.length*100)},resetAchievements:()=>{e({achievements:t.map(e=>({...e,unlocked:!1,unlockedAt:void 0})),unlockedIds:[],achievementProgress:{},recentUnlocks:[],quizCorrectCount:0,experienceCompleteCount:{},shareCount:0,polaroidCount:0,pledgeCount:0,timelineViewed:!1,knowledgeGraphProgress:0,seasonalActivityCount:0})}}),{name:"eco-achievement-storage",version:1}));export{c as u};
