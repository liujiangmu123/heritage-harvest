import{r as e,j as a}from"./three-vendor-BoyHWg1a.js";import{e as t,a as s}from"./core-vendor-Csnc5NqJ.js";import{C as i,u as n,a as l,g as r,j as o,P as c,i as d,c as x}from"./index-DkRoqGlp.js";import{u as m}from"./artworkStore-DQwkUevd.js";import{X as u,A as g,m as h,o as p,L as b}from"./ui-vendor-BCOa7pYq.js";const v={hani_terrace:{name:"å“ˆå°¼æ¢¯ç”°",description:"äº‘é›¾ç¼­ç»•çš„åƒå¹´æ¢¯ç”°",bgGradient:"from-eco-400 via-bamboo-300 to-sky-400",icon:"ğŸ”ï¸",carbonSaving:i.hani_terrace.baseSaving},tea_garden:{name:"ç”Ÿæ€èŒ¶å›­",description:"äº‘é›¾å±±é—´çš„æœ‰æœºèŒ¶å›­",bgGradient:"from-eco-500 via-eco-400 to-bamboo-300",icon:"ğŸµ",carbonSaving:i.tea_ceremony.baseSaving},bamboo_forest:{name:"ç«¹æµ·æ·±å¤„",description:"ç¿ ç«¹æ‘‡æ›³çš„ç»¿è‰²æµ·æ´‹",bgGradient:"from-bamboo-500 via-eco-400 to-bamboo-300",icon:"ğŸ‹",carbonSaving:i.bamboo_weaving.baseSaving},batik_workshop:{name:"èœ¡æŸ“å·¥åŠ",description:"é›è“é£˜é¦™çš„ä¼ ç»Ÿå·¥åŠ",bgGradient:"from-blue-600 via-indigo-400 to-blue-300",icon:"ğŸ¨",carbonSaving:i.batik.baseSaving},paper_cutting:{name:"å‰ªçº¸å·¥åŠ",description:"çº¢çº¸é£èˆçš„è‰ºæœ¯ç©ºé—´",bgGradient:"from-heritage-500 via-primary-400 to-heritage-300",icon:"âœ‚ï¸",carbonSaving:i.paper_cutting.baseSaving},clay_studio:{name:"æ³¥å¡‘å·¥åŠ",description:"é»„åœŸèŠ¬èŠ³çš„åˆ›ä½œå¤©åœ°",bgGradient:"from-clay-500 via-terrace-400 to-clay-300",icon:"ğŸº",carbonSaving:i.clay_sculpture.baseSaving}};function f({result:e,coords:t,weavingDNA:s}){var i,n,l;const r=(null==(i=null==s?void 0:s.colorScheme)?void 0:i.primary)||"#8B5E34",o=(null==(n=null==s?void 0:s.colorScheme)?void 0:n.secondary)||"#D4A574",c=(null==(l=null==s?void 0:s.colorScheme)?void 0:l.accent)||"#C4956A";return a.jsxs(h.div,{className:"fixed inset-0 z-[60] pointer-events-none",initial:{opacity:1},animate:{opacity:1},exit:{opacity:0},transition:{duration:.25},children:[a.jsx(h.div,{className:"absolute left-0 right-0 top-0 h-1/2 bg-black",initial:{y:"-100%"},animate:{y:["-100%","0%","-100%"]},transition:{duration:.65,times:[0,.25,1],ease:"easeInOut"}}),a.jsx(h.div,{className:"absolute left-0 right-0 bottom-0 h-1/2 bg-black",initial:{y:"100%"},animate:{y:["100%","0%","100%"]},transition:{duration:.65,times:[0,.25,1],ease:"easeInOut"}}),a.jsx(h.div,{className:"absolute inset-0 bg-white",initial:{opacity:0},animate:{opacity:[0,1,0]},transition:{delay:.2,duration:.25,times:[0,.1,1],ease:"easeOut"}}),a.jsx(h.div,{className:"absolute left-0 top-0",initial:{x:t.fromX,y:t.fromY+80,rotate:-10,opacity:0,scale:.95},animate:{x:[t.fromX,t.fromX,t.toX],y:[t.fromY+80,t.fromY-120,t.toY],rotate:[-10,-10,2],opacity:[0,1,1],scale:[.95,.98,1]},transition:{delay:.25,duration:.95,ease:[.2,.8,.2,1]},children:a.jsxs("div",{className:"w-80 bg-white p-1 pb-20 rounded-sm relative",style:{boxShadow:"0 30px 70px rgba(0,0,0,0.45)"},children:[a.jsx("div",{className:"absolute inset-0 rounded-sm",style:{background:`\n                repeating-linear-gradient(\n                  0deg,\n                  transparent,\n                  transparent 2px,\n                  ${r}15 2px,\n                  ${r}15 4px\n                ),\n                repeating-linear-gradient(\n                  90deg,\n                  transparent,\n                  transparent 2px,\n                  ${o}15 2px,\n                  ${o}15 4px\n                )\n              `,border:`3px solid ${r}`,borderRadius:"4px"}}),a.jsxs("div",{className:"aspect-square overflow-hidden bg-gray-100 rounded m-1 relative",children:[a.jsx("img",{src:e.imageDataUrl,alt:e.sceneName,className:"w-full h-full object-cover",style:e.imageDataUrl.startsWith("data:image")?{transform:"scale(1.25)",transformOrigin:"center",objectPosition:"50% 35%"}:void 0}),a.jsx(h.div,{className:"absolute inset-0 bg-neutral-900",initial:{y:0},animate:{y:"-100%"},transition:{delay:1.2,duration:1.15,ease:"easeOut"}}),a.jsx(h.div,{className:"absolute inset-0 pointer-events-none",initial:{opacity:0},animate:{opacity:1},transition:{delay:1.15,duration:.6,ease:"easeOut"},style:{background:`radial-gradient(circle at 30% 20%, ${c}22, transparent 55%), linear-gradient(to bottom, rgba(0,0,0,0), rgba(0,0,0,0.25))`}})]}),a.jsxs("div",{className:"absolute bottom-3 left-3 right-3",children:[a.jsx("p",{className:"text-gray-700 text-lg",style:{fontFamily:"Comic Sans MS, cursive"},children:(null==s?void 0:s.uniqueTitle)||e.sceneName}),a.jsx("p",{className:"text-xs text-gray-400",children:e.date})]})]})})]})}const y=["æ¯ä¸€æ¬¡äº‘æ¸¸ï¼Œéƒ½æ˜¯å¯¹åœ°çƒçš„æ¸©æŸ”å®ˆæŠ¤ ğŸŒ","ä¼ æ‰¿éé—ï¼Œå®ˆæŠ¤ç»¿è‰²å®¶å›­ ğŸŒ¿","ä½ç¢³å‡ºè¡Œï¼Œä»äº‘æ¸¸å¼€å§‹ â˜ï¸","æ–‡åŒ–ä¸ç”Ÿæ€ï¼Œå’Œè°å…±ç”Ÿ ğŸ‹","ç”¨å¿ƒæ„Ÿå—ï¼Œç”¨è¡ŒåŠ¨å®ˆæŠ¤ ğŸ’š","åƒå¹´æ™ºæ…§ï¼Œç»¿è‰²ä¼ æ‰¿ ğŸ”ï¸","æ¯ä¸€ä»½å‡ç¢³ï¼Œéƒ½æ˜¯å¯¹æœªæ¥çš„æ‰¿è¯º ğŸŒ±","æ¢ç´¢ä¹¡æ‘ï¼Œå‘ç°ç”Ÿæ€ä¹‹ç¾ ğŸ¦‹"];function j({onClick:e,isCapturing:t}){return a.jsxs(h.div,{className:"relative cursor-pointer select-none",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:e,children:[a.jsxs("div",{className:"relative w-80 h-64 mx-auto",children:[a.jsxs("div",{className:"absolute inset-0 rounded-2xl shadow-2xl overflow-hidden",style:{background:"linear-gradient(145deg, #f5f0e6 0%, #e8e0d0 50%, #d4ccc0 100%)",boxShadow:"0 25px 50px rgba(0,0,0,0.4), inset 0 2px 0 rgba(255,255,255,0.6), inset 0 -2px 4px rgba(0,0,0,0.1)"},children:[a.jsx("div",{className:"absolute inset-0 opacity-10",style:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0h20v20H0z' fill='%23000' fill-opacity='0.05'/%3E%3Ccircle cx='10' cy='10' r='1' fill='%23000' fill-opacity='0.1'/%3E%3C/svg%3E\")",backgroundSize:"4px 4px"}}),a.jsx("div",{className:"absolute top-0 left-0 right-0 h-4 rounded-t-2xl",style:{background:"linear-gradient(to bottom, #8B4513 0%, #654321 50%, #5D3A1A 100%)",boxShadow:"inset 0 1px 2px rgba(255,255,255,0.2), inset 0 -1px 2px rgba(0,0,0,0.3)"},children:a.jsx("div",{className:"absolute top-1/2 left-4 right-4 h-px",style:{background:"repeating-linear-gradient(90deg, #3a2a1a 0px, #3a2a1a 4px, transparent 4px, transparent 8px)"}})}),a.jsx(h.div,{className:"absolute top-8 left-6 w-14 h-14 rounded-full",animate:t?{boxShadow:["0 0 0 rgba(255,255,255,0)","0 0 80px rgba(255,255,255,1)","0 0 0 rgba(255,255,255,0)"]}:{},transition:{duration:.3},style:{background:"linear-gradient(145deg, #e8e8e8, #a0a0a0)",boxShadow:"inset 0 3px 6px rgba(255,255,255,0.6), inset 0 -2px 4px rgba(0,0,0,0.2), 0 4px 8px rgba(0,0,0,0.3)"},children:a.jsx("div",{className:"absolute inset-1.5 rounded-full",style:{background:"linear-gradient(145deg, #d0d0d0, #909090)"},children:a.jsx("div",{className:"absolute inset-1.5 rounded-full",style:{background:"radial-gradient(circle at 30% 30%, #ffffff, #c0c0c0, #808080)"},children:a.jsx("div",{className:"absolute top-1 left-2 w-2 h-1 rounded-full bg-white opacity-80"})})})}),a.jsx("div",{className:"absolute top-6 right-6 w-8 h-6 rounded-sm",style:{background:"linear-gradient(145deg, #2a2a2a, #1a1a1a)",boxShadow:"inset 0 1px 2px rgba(0,0,0,0.5)"},children:a.jsx("div",{className:"absolute inset-1 rounded-sm bg-gradient-to-br from-blue-900 to-blue-950"})}),a.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 mt-1",children:a.jsx("div",{className:"w-32 h-32 rounded-full flex items-center justify-center p-1",style:{background:"linear-gradient(145deg, #e8d4c4, #c9b8a8)",boxShadow:"0 6px 12px rgba(0,0,0,0.3), inset 0 2px 4px rgba(255,255,255,0.4)"},children:a.jsx("div",{className:"w-full h-full rounded-full flex items-center justify-center",style:{background:"linear-gradient(145deg, #4a4a4a, #2a2a2a, #1a1a1a)",boxShadow:"inset 0 3px 6px rgba(255,255,255,0.15), inset 0 -2px 4px rgba(0,0,0,0.4)"},children:a.jsx("div",{className:"w-24 h-24 rounded-full flex items-center justify-center",style:{background:"repeating-radial-gradient(circle at center, #3a3a3a 0px, #2a2a2a 2px, #3a3a3a 4px)",boxShadow:"inset 0 4px 8px rgba(0,0,0,0.5)"},children:a.jsxs(h.div,{className:"w-16 h-16 rounded-full relative overflow-hidden",animate:t?{scale:[1,.92,1]}:{},transition:{duration:.2},style:{background:"radial-gradient(circle at 35% 35%, #5a7fa5, #2a4a6a, #1a2a3a, #0a1520)",boxShadow:"inset 0 0 25px rgba(0,0,0,0.6), 0 0 15px rgba(74,111,165,0.4)"},children:[a.jsx("div",{className:"absolute top-1 left-2 w-6 h-3 rounded-full opacity-50",style:{background:"linear-gradient(135deg, transparent, rgba(255,255,255,0.8), transparent)"}}),a.jsx("div",{className:"absolute bottom-3 right-2 w-4 h-2 rounded-full opacity-30",style:{background:"radial-gradient(ellipse, rgba(255,255,255,0.6), transparent)"}}),a.jsx("div",{className:"absolute inset-3 rounded-full",style:{background:"radial-gradient(circle at 40% 40%, #3a5a7a, #1a2a3a)",opacity:.5}})]})})})})}),a.jsx("div",{className:"absolute bottom-5 left-1/2 -translate-x-1/2",children:a.jsx("span",{className:"font-serif text-base tracking-[0.3em] font-medium",style:{background:"linear-gradient(135deg, #d4a574, #8b7355, #d4a574)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textShadow:"0 1px 1px rgba(255,255,255,0.3)"},children:"ä¹¡é—è¯†"})}),a.jsx(h.div,{className:"absolute -right-4 top-1/2 -translate-y-1/2 w-7 h-14 rounded-full cursor-pointer",whileHover:{x:-2,scale:1.02},whileTap:{x:3,scale:.98},style:{background:"linear-gradient(to right, #dc3545, #c41e3a, #8b0000)",boxShadow:"3px 0 6px rgba(0,0,0,0.4), inset 1px 0 2px rgba(255,255,255,0.2)"},children:a.jsx("div",{className:"absolute inset-x-1 top-1/2 -translate-y-1/2 h-6 rounded-full",style:{background:"linear-gradient(to right, rgba(0,0,0,0.2), transparent)"}})}),a.jsx("div",{className:"absolute -left-2 top-1/3 w-3 h-16 rounded-l-lg",style:{background:"linear-gradient(to left, #d4ccc0, #c4b8a8)",boxShadow:"-2px 0 4px rgba(0,0,0,0.2)"}})]}),a.jsx("div",{className:"absolute -bottom-2 left-1/2 -translate-x-1/2 w-48 h-4 rounded-b-lg",style:{background:"linear-gradient(to bottom, #2a2a2a, #1a1a1a)",boxShadow:"0 2px 4px rgba(0,0,0,0.3)"}})]}),a.jsx("p",{className:"text-center text-ink-500 mt-4 text-sm",children:"ç‚¹å‡»ç›¸æœºæ‹ç…§"})]})}function w({photos:e,weavingDNA:t,onPhotoClick:s,activeIndex:i,onFlip:n,isFlipped:l}){if(0===e.length)return null;const r=[-8,5,-3,7,-5,4,-6,8];return a.jsx("div",{className:"relative h-[550px] flex items-center justify-center",children:e.map((o,c)=>{var d,x,m,u,g,p,v,f,y,j,w,N,S;const k=c===i,C=r[c%r.length],D=30*(c-i),E=15*(c-i);return a.jsx(h.div,{className:"absolute cursor-pointer",initial:{opacity:0,scale:.8,rotate:0},animate:{opacity:1,x:D,y:E,rotate:k?0:C,scale:k?1.1:1,zIndex:k?100:e.length-Math.abs(c-i)},transition:{type:"spring",stiffness:200,damping:25},onClick:()=>s(c),whileHover:{scale:k?1.12:1.05,zIndex:99},children:a.jsxs(h.div,{className:"relative preserve-3d",animate:{rotateY:k&&l?180:0},transition:{duration:.6,type:"spring",stiffness:100},style:{transformStyle:"preserve-3d"},children:[a.jsxs("div",{className:"w-80 bg-white p-1 pb-20 rounded-sm backface-hidden relative",style:{backfaceVisibility:"hidden",boxShadow:k?"0 25px 50px rgba(0,0,0,0.35)":"0 15px 30px rgba(0,0,0,0.25)"},children:[a.jsx("div",{className:"absolute inset-0 rounded-sm pointer-events-none",style:{background:`\n                      repeating-linear-gradient(\n                        0deg,\n                        transparent,\n                        transparent 2px,\n                        ${(null==(d=null==t?void 0:t.colorScheme)?void 0:d.primary)||"#8B5E34"}15 2px,\n                        ${(null==(x=null==t?void 0:t.colorScheme)?void 0:x.primary)||"#8B5E34"}15 4px\n                      ),\n                      repeating-linear-gradient(\n                        90deg,\n                        transparent,\n                        transparent 2px,\n                        ${(null==(m=null==t?void 0:t.colorScheme)?void 0:m.secondary)||"#D4A574"}15 2px,\n                        ${(null==(u=null==t?void 0:t.colorScheme)?void 0:u.secondary)||"#D4A574"}15 4px\n                      )\n                    `,border:`3px solid ${(null==(g=null==t?void 0:t.colorScheme)?void 0:g.primary)||"#8B5E34"}`,borderRadius:"4px"}}),a.jsx("div",{className:"absolute top-0 left-0 w-6 h-6",children:a.jsxs("svg",{viewBox:"0 0 24 24",className:"w-full h-full",children:[a.jsx("path",{d:"M0,0 Q12,0 12,12 Q12,0 24,0",fill:"none",stroke:(null==(p=null==t?void 0:t.colorScheme)?void 0:p.accent)||"#C4956A",strokeWidth:"2"}),a.jsx("path",{d:"M0,0 Q0,12 12,12 Q0,12 0,24",fill:"none",stroke:(null==(v=null==t?void 0:t.colorScheme)?void 0:v.accent)||"#C4956A",strokeWidth:"2"})]})}),a.jsx("div",{className:"absolute top-0 right-0 w-6 h-6 rotate-90",children:a.jsx("svg",{viewBox:"0 0 24 24",className:"w-full h-full",children:a.jsx("path",{d:"M0,0 Q12,0 12,12 Q12,0 24,0",fill:"none",stroke:(null==(f=null==t?void 0:t.colorScheme)?void 0:f.accent)||"#C4956A",strokeWidth:"2"})})}),a.jsxs("div",{className:"aspect-square overflow-hidden bg-gray-100 rounded m-2 relative",children:[o.imageDataUrl.startsWith("data:image")?a.jsx("img",{src:o.imageDataUrl,alt:o.sceneName,className:"w-full h-full object-cover",style:{transform:"scale(1.25)",transformOrigin:"center",objectPosition:"50% 35%"}}):a.jsx("img",{src:o.imageDataUrl,alt:o.sceneName,className:"w-full h-full object-cover"}),a.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-5",style:{backgroundImage:`\n                        repeating-linear-gradient(\n                          45deg,\n                          ${(null==(y=null==t?void 0:t.colorScheme)?void 0:y.primary)||"#8B5E34"} 0px,\n                          transparent 1px,\n                          transparent 10px\n                        ),\n                        repeating-linear-gradient(\n                          -45deg,\n                          ${(null==(j=null==t?void 0:t.colorScheme)?void 0:j.secondary)||"#D4A574"} 0px,\n                          transparent 1px,\n                          transparent 10px\n                        )\n                      `}})]}),a.jsxs("div",{className:"absolute bottom-3 left-3 right-3",children:[a.jsx("p",{className:"text-gray-700 text-lg",style:{fontFamily:"Comic Sans MS, cursive"},children:(null==t?void 0:t.uniqueTitle)||o.sceneName}),a.jsx("p",{className:"text-xs text-gray-400",children:o.date})]}),k&&a.jsx(h.div,{className:"absolute top-2 right-2 flex gap-1",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:a.jsx("button",{onClick:e=>{e.stopPropagation(),n(c)},className:"px-3 py-1.5 bg-eco-500 hover:bg-eco-600 text-white rounded-full text-xs font-bold shadow-lg transition-all",children:"â†»"})})]}),a.jsxs("div",{className:"absolute inset-0 w-80 bg-gradient-to-br from-eco-50 to-bamboo-50 p-4 rounded-sm backface-hidden flex flex-col",style:{backfaceVisibility:"hidden",transform:"rotateY(180deg)",boxShadow:"0 25px 50px rgba(0,0,0,0.35)"},children:[a.jsx("div",{className:"absolute inset-3 rounded pointer-events-none",style:{border:"2px dashed",borderColor:(null==(w=null==t?void 0:t.colorScheme)?void 0:w.primary)||"#2D5A27"}}),a.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-2",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(b,{className:"w-5 h-5 text-eco-500"}),a.jsx("span",{className:"text-eco-700 font-bold text-sm",children:"ä»¥ç«¹ä»£å¡‘ Â· ç»¿è‰²æ•°æ®"})]}),a.jsxs("div",{className:"w-full space-y-2 text-sm",children:[a.jsxs("div",{className:"bg-white/80 rounded-lg p-2 flex items-center justify-between",children:[a.jsx("span",{className:"text-eco-600",children:"ğŸŒ± ç¢³å‡æ’"}),a.jsxs("span",{className:"text-eco-700 font-bold",children:[o.carbonSaved,"g"]})]}),a.jsxs("div",{className:"bg-white/80 rounded-lg p-2 flex items-center justify-between",children:[a.jsx("span",{className:"text-eco-600",children:"â™»ï¸ å‡å¡‘æ–™"}),a.jsx("span",{className:"text-eco-700 font-bold",children:"150g"})]}),a.jsxs("div",{className:"bg-white/80 rounded-lg p-2",children:[a.jsxs("div",{className:"flex justify-between mb-1",children:[a.jsx("span",{className:"text-eco-600",children:"ğŸ‹ ç«¹åˆ†è§£"}),a.jsx("span",{className:"text-eco-700 font-bold",children:"3-6æœˆ"})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-red-400",children:"ğŸ›¢ï¸ å¡‘åˆ†è§£"}),a.jsx("span",{className:"text-red-500 font-bold",children:"450å¹´"})]})]}),(null==t?void 0:t.uniqueTitle)&&a.jsx("div",{className:"rounded-lg p-2 text-center",style:{backgroundColor:(null==(N=t.colorScheme)?void 0:N.secondary)||"#E8F5E0"},children:a.jsxs("p",{className:"text-xs",style:{color:null==(S=t.colorScheme)?void 0:S.primary},children:["ğŸ‹ ",t.uniqueTitle]})})]})]}),a.jsx("div",{className:"text-center text-xs text-eco-500",children:"ğŸŒ å®ˆæŠ¤ç»¿è‰²åœ°çƒ"}),a.jsx(h.div,{className:"absolute top-2 right-2",initial:{opacity:0},animate:{opacity:1},children:a.jsx("button",{onClick:e=>{e.stopPropagation(),n(c)},className:"px-3 py-1.5 bg-eco-500 hover:bg-eco-600 text-white rounded-full text-xs font-bold shadow-lg",children:"â†»"})})]})]})},o.id)})})}function N({onComplete:i,onClose:b,className:N,weavingDNA:S}){var k,C;const[D]=t(),E=s(),M=e.useRef(null),A=e.useRef(null),F=e.useRef(null),B=e.useRef(null),T=e.useRef([]),$=e.useMemo(()=>{if(S)return S;const e=D.get("title"),a=D.get("level"),t=D.get("product"),s=D.get("smooth"),i=D.get("creative"),n=D.get("design");if(!e&&!a)return;const l=n?parseInt(n):Date.now(),r=l%6;return{uniqueTitle:e||void 0,craftLevel:a||void 0,productStyle:t||void 0,smoothness:s?parseInt(s):void 0,creativity:i?parseInt(i):void 0,colorScheme:[{primary:"#8B5E34",secondary:"#D4A574",accent:"#C4956A",highlight:"#F5E6D3"},{primary:"#2D5A27",secondary:"#6B8E23",accent:"#9ACD32",highlight:"#E8F5E0"},{primary:"#4A90A4",secondary:"#7CB9D8",accent:"#B8D4E8",highlight:"#E6F3F8"},{primary:"#8B4513",secondary:"#D2691E",accent:"#F4A460",highlight:"#FAEBD7"},{primary:"#6B4C3B",secondary:"#A67B5B",accent:"#C19A6B",highlight:"#F5DEB3"},{primary:"#556B2F",secondary:"#8FBC8F",accent:"#98FB98",highlight:"#F0FFF0"}][r],seed:l}},[S,D]),I=D.get("scene");D.get("render3d"),D.get("shape")||null==$||$.productStyle,e.useMemo(()=>{const e=D.get("primary"),a=D.get("secondary"),t=D.get("accent"),s=D.get("highlight");return e&&a&&t&&s?{primary:e,secondary:a,accent:t,highlight:s}:null==$?void 0:$.colorScheme},[D,null==$?void 0:$.colorScheme]);const[_,L]=e.useState("camera"),[q,z]=e.useState(I&&v[I]?I:"hani_terrace"),[R,O]=e.useState(null),[P,U]=e.useState(null),[W,G]=e.useState([]),[Y,H]=e.useState(!1),[Q,X]=e.useState(!1),[V,J]=e.useState(!1),[K,Z]=e.useState(!1),[ee,ae]=e.useState(0),[te,se]=e.useState(null);e.useEffect(()=>()=>{T.current.forEach(e=>clearTimeout(e)),T.current=[]},[]);const{currentLevel:ie}=n(),{addCarbonSaving:ne}=l(),le=v[q],[re,oe]=e.useState(()=>{const e=localStorage.getItem("weavingProductImage"),a=localStorage.getItem("weavingProductTime");if(e&&a){if(Date.now()-parseInt(a)<36e5&&e.length>5e4)return e}return null});e.useEffect(()=>{var e,a;if(!re)return;const t=(null==$?void 0:$.uniqueTitle)||"è—¤ç¼–ä½œå“",s={id:r(),imageDataUrl:re,scene:"bamboo_forest",sceneName:t,date:(new Date).toLocaleDateString("zh-CN"),ecoLevel:ie,pointsEarned:c.polaroid_create,carbonSaved:500,ecoMessage:"ä»¥ç«¹ä»£å¡‘ï¼Œä¼ æ‰¿éé—ï¼Œå®ˆæŠ¤ç»¿è‰²åœ°çƒ",filter:o},i=null==(e=F.current)?void 0:e.getBoundingClientRect(),n=null==(a=B.current)?void 0:a.getBoundingClientRect(),l=window.innerWidth/2-160,d=window.innerHeight/2-210,x={fromX:i?i.left+i.width/2-160:l,fromY:i?i.top+.55*i.height:d,toX:n?n.left+n.width/2-160:l,toY:n?n.top+n.height/2-210:d};se({result:s,coords:x});const m=window.setTimeout(()=>J(!0),220),u=window.setTimeout(()=>J(!1),430),g=window.setTimeout(()=>{G([s]),U(s),ae(0),se(null)},2100);return T.current=[m,u,g],()=>{T.current.forEach(e=>clearTimeout(e)),T.current=[]}},[re]),e.useEffect(()=>("capture"===_&&M.current&&navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:640,height:480}}).then(e=>{M.current&&(M.current.srcObject=e,X(!0))}).catch(e=>{}),()=>{var e;if(null==(e=M.current)?void 0:e.srcObject){M.current.srcObject.getTracks().forEach(e=>e.stop())}}),[_]);const ce=e.useCallback(()=>{M.current&&A.current&&(J(!0),setTimeout(()=>{const e=M.current,a=A.current,t=a.getContext("2d");if(!t)return;a.width=e.videoWidth,a.height=e.videoHeight,t.translate(a.width,0),t.scale(-1,1),t.drawImage(e,0,0),de(t,a.width,a.height);const s=a.toDataURL("image/png");O(s),J(!1),Z(!0);const i={id:r(),imageDataUrl:s,scene:q,sceneName:le.name,date:(new Date).toLocaleDateString("zh-CN"),ecoLevel:ie,pointsEarned:c.polaroid_create,carbonSaved:le.carbonSaving,ecoMessage:y[Math.floor(Math.random()*y.length)],filter:o};d(`ç”Ÿæˆ${le.name}æ‹ç«‹å¾—`,c.polaroid_create),ne({type:"cloud_tour",carbonSaved:le.carbonSaving,description:`äº‘æ¸¸${le.name}`,experienceId:q}),m.getState().addPolaroidArtwork({image:s,scene:q,sceneName:le.name,ecoMessage:i.ecoMessage,carbonSaved:le.carbonSaving,pointsEarned:c.polaroid_create}),U(i),G(e=>[...e,i]),ae(W.length),setTimeout(()=>{Z(!1),L("camera")},1500)},300))},[q,le,ie,ne,W.length]),de=(e,a,t)=>{const s=e.getImageData(0,0,a,t),i=s.data,n=o;for(let l=0;l<i.length;l+=4){i[l]=Math.min(255,i[l]+20*n.warmth),i[l+2]=Math.max(0,i[l+2]-10*n.warmth);const e=(i[l]+i[l+1]+i[l+2])/3;i[l]=i[l]+(e-i[l])*n.fadeLevel,i[l+1]=i[l+1]+(e-i[l+1])*n.fadeLevel,i[l+2]=i[l+2]+(e-i[l+2])*n.fadeLevel;const a=(Math.random()-.5)*n.grain*50;i[l]=Math.min(255,Math.max(0,i[l]+a)),i[l+1]=Math.min(255,Math.max(0,i[l+1]+a)),i[l+2]=Math.min(255,Math.max(0,i[l+2]+a))}if(e.putImageData(s,0,0),n.vignette>0){const s=e.createRadialGradient(a/2,t/2,0,a/2,t/2,Math.max(a,t)/2);s.addColorStop(.5,"rgba(0,0,0,0)"),s.addColorStop(1,`rgba(0,0,0,${n.vignette})`),e.fillStyle=s,e.fillRect(0,0,a,t)}};e.useCallback(()=>{if(!R)return;const e={id:r(),imageDataUrl:R,scene:q,sceneName:le.name,date:(new Date).toLocaleDateString("zh-CN"),ecoLevel:ie,pointsEarned:c.polaroid_create,carbonSaved:le.carbonSaving,ecoMessage:y[Math.floor(Math.random()*y.length)],filter:o};d(`ç”Ÿæˆ${le.name}æ‹ç«‹å¾—`,c.polaroid_create),ne({type:"cloud_tour",carbonSaved:le.carbonSaving,description:`äº‘æ¸¸${le.name}`,experienceId:q}),U(e),G(a=>[...a,e]),L("result"),null==i||i(e)},[R,q,le,ie,ne,i]);const xe=e.useCallback(()=>{if(!P)return;const e=document.createElement("a");e.download=`ä¹¡é—è¯†-${le.name}-${Date.now()}.png`,e.href=P.imageDataUrl,e.click()},[P,le]);e.useCallback(()=>{O(null),U(null),H(!1),L("capture")},[]);const me=e.useCallback(()=>{O(null),U(null),H(!1),L("camera")},[]);return a.jsxs("div",{className:x("min-h-screen",N),style:{background:"radial-gradient(circle at center, #f5f5f0 0%, #e8e8e0 100%)"},children:[a.jsxs("div",{className:"fixed top-4 left-4 right-4 z-50 flex items-center justify-between",children:[a.jsx("div",{className:"flex items-center gap-2",children:(null==$?void 0:$.uniqueTitle)?a.jsxs("div",{className:"px-4 py-2 rounded-full text-white text-sm font-medium shadow-lg",style:{background:`linear-gradient(135deg, ${(null==(k=$.colorScheme)?void 0:k.primary)||"#2D5A27"}, ${(null==(C=$.colorScheme)?void 0:C.accent)||"#6B8E23"})`,border:"2px solid white"},children:["ğŸ‹ ",$.uniqueTitle]}):a.jsx("div",{className:"px-4 py-2 bg-eco-500 text-white rounded-full text-sm font-medium shadow-lg border-2 border-white",children:"ğŸŒ¿ ä¹¡é—è¯†æ‹ç«‹å¾—"})}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:xe,disabled:0===W.length,className:"px-4 py-2 bg-eco-600 hover:bg-eco-700 text-white rounded-full text-sm font-bold shadow-lg border-2 border-white disabled:opacity-50 transition-all",style:{fontFamily:"Comic Sans MS, cursive"},children:"DOWNLOAD"}),a.jsx("button",{onClick:me,className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-full text-sm font-bold shadow-lg border-2 border-white transition-all",style:{fontFamily:"Comic Sans MS, cursive"},children:"RESET"}),a.jsx("button",{onClick:b,className:"p-2 bg-white/80 hover:bg-white rounded-full shadow-lg transition-all",children:a.jsx(u,{className:"w-5 h-5 text-gray-600"})})]})]}),a.jsx("div",{className:"min-h-screen flex items-center justify-center px-8 py-20",children:a.jsxs("div",{className:"flex items-center gap-16 max-w-6xl w-full",children:[a.jsx("div",{className:"flex-shrink-0",ref:F,children:a.jsx(j,{onClick:()=>{L("capture")},isCapturing:V})}),a.jsx("div",{className:"flex-1 min-h-[400px] relative",ref:B,children:W.length>0?a.jsx(w,{photos:W,weavingDNA:$,onPhotoClick:e=>{U(W[e]),ae(e)},activeIndex:ee,onFlip:e=>{ee===e&&H(!Y)},isFlipped:Y}):a.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400 relative",children:[a.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:a.jsxs("div",{className:"relative",children:[a.jsxs("div",{className:"absolute -left-8 -top-4 w-32 h-40 bg-white rounded shadow-lg transform -rotate-12",style:{boxShadow:"0 4px 15px rgba(0,0,0,0.2)"},children:[a.jsx("div",{className:"w-full h-28 bg-gradient-to-br from-amber-100 to-amber-200 rounded-t flex items-center justify-center",children:a.jsx("span",{className:"text-4xl",children:"ğŸ®"})}),a.jsxs("div",{className:"p-1 text-center",children:[a.jsx("p",{className:"text-[8px] text-gray-600 font-bold",children:"è—¤ç¼–ç¯ç¬¼"}),a.jsx("p",{className:"text-[6px] text-gray-400",children:"2025/12/20"})]})]}),a.jsxs("div",{className:"absolute left-4 top-0 w-32 h-40 bg-white rounded shadow-lg transform rotate-6 z-10",style:{boxShadow:"0 4px 15px rgba(0,0,0,0.2)"},children:[a.jsx("div",{className:"w-full h-28 bg-gradient-to-br from-eco-100 to-eco-200 rounded-t flex items-center justify-center",children:a.jsx("span",{className:"text-4xl",children:"ğŸ§º"})}),a.jsxs("div",{className:"p-1 text-center",children:[a.jsx("p",{className:"text-[8px] text-gray-600 font-bold",children:"æ”¶çº³èŠ±ç¯®"}),a.jsx("p",{className:"text-[6px] text-gray-400",children:"2025/12/20"})]})]}),a.jsxs("div",{className:"absolute left-16 -top-2 w-32 h-40 bg-white rounded shadow-lg transform rotate-15 z-20",style:{boxShadow:"0 4px 15px rgba(0,0,0,0.2)"},children:[a.jsx("div",{className:"w-full h-28 bg-gradient-to-br from-heritage-100 to-heritage-200 rounded-t flex items-center justify-center",children:a.jsx("span",{className:"text-4xl",children:"ğŸ‹"})}),a.jsxs("div",{className:"p-1 text-center",children:[a.jsx("p",{className:"text-[8px] text-gray-600 font-bold",children:"ç»å…¸èŠ±ç“¶"}),a.jsx("p",{className:"text-[6px] text-gray-400",children:"2025/12/20"})]})]})]})}),a.jsxs("div",{className:"relative z-30 mt-48 text-center",children:[a.jsx("p",{className:"text-lg text-gray-500",style:{fontFamily:"Comic Sans MS, cursive"},children:"ç‚¹å‡»ç›¸æœºæ‹æ‘„ä½ çš„ç¬¬ä¸€å¼ ç…§ç‰‡"}),(null==$?void 0:$.uniqueTitle)&&a.jsxs("p",{className:"text-sm mt-2 text-eco-500",children:["è®°å½•ä½ çš„ç¼–ç»‡ä½œå“ï¼š",$.productStyle]})]})]})})]})}),a.jsx(g,{mode:"wait",children:te&&a.jsx(f,{result:te.result,coords:te.coords,weavingDNA:$},"auto-weaving-fx")}),a.jsxs("div",{className:"fixed bottom-4 left-4 right-4 flex items-center justify-between text-sm",children:[a.jsx("div",{className:"px-4 py-2 bg-amber-700 text-white rounded-full cursor-pointer hover:bg-amber-800 transition-all shadow-lg",style:{fontFamily:"Comic Sans MS, cursive"},onClick:()=>E("/gallery"),children:"ğŸ“Œ æŸ¥çœ‹ç»¿è‰²å…¬ç›Šç”»å»Š"}),a.jsx("div",{className:"text-gray-500",style:{fontFamily:"Comic Sans MS, cursive"},children:"ä»¥ç«¹ä»£å¡‘ï¼Œå®ˆæŠ¤åœ°çƒ ğŸŒ"})]}),a.jsx(g,{children:"capture"===_&&a.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-8",children:a.jsxs(h.div,{initial:{scale:.9},animate:{scale:1},exit:{scale:.9},className:"bg-white rounded-2xl p-6 max-w-lg w-full space-y-4",children:[a.jsxs("div",{className:"relative aspect-square rounded-2xl overflow-hidden bg-ink-900 shadow-2xl",children:[a.jsx("video",{ref:M,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover scale-x-[-1]"}),a.jsx("div",{className:x("absolute inset-0 opacity-20 bg-gradient-to-br pointer-events-none",le.bgGradient)}),a.jsxs("div",{className:"absolute top-4 left-4 px-3 py-1 bg-black/50 rounded-full text-white text-sm flex items-center gap-2",children:[a.jsx("span",{children:le.icon}),le.name]}),a.jsx("div",{className:"absolute inset-0 border-8 border-white pointer-events-none rounded-lg"}),!Q&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-ink-900",children:a.jsx("p",{className:"text-white",children:"æ­£åœ¨å¯åŠ¨æ‘„åƒå¤´..."})}),a.jsx(g,{children:V&&a.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-white"})})]}),a.jsx("canvas",{ref:A,className:"hidden"}),a.jsx(g,{children:K&&R&&a.jsx(h.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:-50,opacity:0},className:"absolute bottom-20 left-1/2 -translate-x-1/2 w-32 bg-white p-1 pb-6 rounded-sm shadow-xl",children:a.jsx("img",{src:R,alt:"é¢„è§ˆ",className:"w-full aspect-square object-cover"})})}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:me,className:"flex-1 py-3 bg-white hover:bg-amber-50 text-amber-700 rounded-xl font-medium transition-colors",children:"è¿”å›"}),a.jsxs("button",{onClick:ce,disabled:!Q||V,className:"flex-1 py-3 bg-amber-500 hover:bg-amber-600 text-white rounded-xl font-medium flex items-center justify-center gap-2 transition-colors disabled:opacity-50",children:[a.jsx(p,{className:"w-5 h-5"}),V?"æ‹æ‘„ä¸­...":"æ‹æ‘„"]})]})]})},"capture-modal")})]})}export{N as default};
