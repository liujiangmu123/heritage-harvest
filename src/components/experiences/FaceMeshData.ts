/**
 * MediaPipe FaceMesh 三角剖分数据
 * 468个关键点构成的三角形索引
 * 用于构建3D人脸网格
 */

// FaceMesh 三角剖分索引（精简版 - 脸部核心区域）
// 完整版本有 468 个点和 ~900 个三角形
export const FACE_MESH_TRIANGULATION = [
  // 额头区域
  10, 338, 297, 10, 297, 332, 10, 332, 284, 10, 284, 251,
  10, 251, 389, 10, 389, 356, 10, 356, 454, 10, 454, 323,
  10, 323, 361, 10, 361, 288, 10, 288, 397, 10, 397, 365,
  10, 365, 379, 10, 379, 378, 10, 378, 400, 10, 400, 377,
  10, 377, 152, 10, 152, 148, 10, 148, 176, 10, 176, 149,
  10, 149, 150, 10, 150, 136, 10, 136, 172, 10, 172, 58,
  10, 58, 132, 10, 132, 93, 10, 93, 234, 10, 234, 127,
  10, 127, 162, 10, 162, 21, 10, 21, 54, 10, 54, 103,
  10, 103, 67, 10, 67, 109, 10, 109, 10,
  
  // 左眼区域
  33, 7, 163, 33, 163, 144, 33, 144, 145, 33, 145, 153,
  33, 153, 154, 33, 154, 155, 33, 155, 133, 33, 133, 173,
  33, 173, 157, 33, 157, 158, 33, 158, 159, 33, 159, 160,
  33, 160, 161, 33, 161, 246, 33, 246, 33,
  
  // 右眼区域
  263, 249, 390, 263, 390, 373, 263, 373, 374, 263, 374, 380,
  263, 380, 381, 263, 381, 382, 263, 382, 362, 263, 362, 398,
  263, 398, 384, 263, 384, 385, 263, 385, 386, 263, 386, 387,
  263, 387, 388, 263, 388, 466, 263, 466, 263,
  
  // 鼻子区域
  1, 2, 98, 1, 98, 327, 1, 327, 2,
  2, 326, 327, 2, 327, 294, 2, 294, 278,
  2, 278, 344, 2, 344, 440, 2, 440, 275,
  98, 97, 2, 97, 99, 2, 99, 60, 2,
  60, 166, 2, 166, 219, 2, 219, 48,
  
  // 嘴巴区域  
  0, 267, 269, 0, 269, 270, 0, 270, 409, 0, 409, 291,
  0, 291, 375, 0, 375, 321, 0, 321, 405, 0, 405, 314,
  0, 314, 17, 0, 17, 84, 0, 84, 181, 0, 181, 91,
  0, 91, 146, 0, 146, 61, 0, 61, 185, 0, 185, 40,
  0, 40, 39, 0, 39, 37, 0, 37, 0,
  
  // 左脸颊
  234, 93, 132, 234, 132, 58, 234, 58, 172, 234, 172, 136,
  234, 136, 150, 234, 150, 149, 234, 149, 176, 234, 176, 148,
  
  // 右脸颊
  454, 323, 361, 454, 361, 288, 454, 288, 397, 454, 397, 365,
  454, 365, 379, 454, 379, 378, 454, 378, 400, 454, 400, 377,
  
  // 下巴区域
  152, 377, 400, 152, 400, 378, 152, 378, 379, 152, 379, 365,
  152, 365, 397, 152, 397, 288, 152, 288, 361, 152, 361, 323,
  152, 148, 176, 152, 176, 149, 152, 149, 150, 152, 150, 136,
  152, 136, 172, 152, 172, 58, 152, 58, 132, 152, 132, 93,
];

// UV坐标映射 - 基于标准人脸模型
// 每个关键点对应纹理图片上的UV坐标 (0-1范围)
export const FACE_MESH_UV: { [key: number]: [number, number] } = {
  // 额头中心
  10: [0.5, 0.1],
  
  // 左眉毛
  67: [0.32, 0.22], 103: [0.25, 0.25], 54: [0.2, 0.28], 21: [0.18, 0.3],
  
  // 右眉毛  
  297: [0.68, 0.22], 332: [0.75, 0.25], 284: [0.8, 0.28], 251: [0.82, 0.3],
  
  // 左眼
  33: [0.28, 0.35], 133: [0.35, 0.35], 159: [0.32, 0.33], 145: [0.32, 0.37],
  
  // 右眼
  263: [0.72, 0.35], 362: [0.65, 0.35], 386: [0.68, 0.33], 374: [0.68, 0.37],
  
  // 鼻子
  1: [0.5, 0.55], 2: [0.5, 0.45], 98: [0.45, 0.5], 327: [0.55, 0.5],
  4: [0.5, 0.4], 5: [0.5, 0.42], 6: [0.5, 0.38],
  
  // 嘴巴
  0: [0.5, 0.7], 17: [0.5, 0.75], 61: [0.35, 0.68], 291: [0.65, 0.68],
  13: [0.5, 0.65], 14: [0.5, 0.72], 78: [0.4, 0.68], 308: [0.6, 0.68],
  
  // 脸颊
  234: [0.15, 0.5], 454: [0.85, 0.5],
  127: [0.18, 0.6], 356: [0.82, 0.6],
  132: [0.22, 0.45], 361: [0.78, 0.45],
  
  // 下巴
  152: [0.5, 0.95], 148: [0.4, 0.9], 377: [0.6, 0.9],
  172: [0.3, 0.85], 397: [0.7, 0.85],
  
  // 太阳穴
  93: [0.12, 0.4], 323: [0.88, 0.4],
  
  // 下颌
  58: [0.2, 0.65], 288: [0.8, 0.65],
  136: [0.25, 0.75], 365: [0.75, 0.75],
  150: [0.35, 0.82], 379: [0.65, 0.82],
  149: [0.38, 0.85], 378: [0.62, 0.85],
  176: [0.42, 0.88], 400: [0.58, 0.88],
};

// 获取UV坐标（如果没有预定义，则基于关键点位置计算）
export function getUV(index: number, landmark?: { x: number, y: number }): [number, number] {
  if (FACE_MESH_UV[index]) {
    return FACE_MESH_UV[index];
  }
  // 使用关键点位置作为UV（归一化坐标）
  if (landmark) {
    return [landmark.x, landmark.y];
  }
  return [0.5, 0.5];
}

// 核心面部区域的关键点索引（用于简化网格）
export const CORE_FACE_LANDMARKS = [
  // 脸部轮廓 (顺时针)
  10, 109, 67, 103, 54, 21, 162, 127, 234, 93, 132, 58, 172, 136, 150, 149, 176, 148, 152,
  377, 400, 378, 379, 365, 397, 288, 361, 323, 454, 356, 389, 251, 284, 332, 297, 338,
  
  // 眼睛
  33, 7, 163, 144, 145, 153, 154, 155, 133, 173, 157, 158, 159, 160, 161, 246,
  263, 249, 390, 373, 374, 380, 381, 382, 362, 398, 384, 385, 386, 387, 388, 466,
  
  // 眉毛
  70, 63, 105, 66, 107, 55, 65, 52, 53,
  300, 293, 334, 296, 336, 285, 295, 282, 283,
  
  // 鼻子
  1, 2, 98, 327, 4, 5, 6, 168, 195, 94, 141, 370,
  
  // 嘴巴
  0, 267, 269, 270, 409, 291, 375, 321, 405, 314, 17, 84, 181, 91, 146, 61, 185, 40, 39, 37,
  13, 312, 311, 310, 415, 308, 324, 318, 402, 317, 14, 87, 178, 88, 95, 78, 191, 80, 81, 82,
];
